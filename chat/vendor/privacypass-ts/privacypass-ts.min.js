var Is=Object.create;var Ht=Object.defineProperty;var Ms=Object.getOwnPropertyDescriptor;var Ns=Object.getOwnPropertyNames;var Os=Object.getPrototypeOf,zs=Object.prototype.hasOwnProperty;var Fs=(r,e,t)=>e in r?Ht(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Zi=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var j=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),oi=(r,e)=>{for(var t in e)Ht(r,t,{get:e[t],enumerable:!0})},Ds=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ns(e))!zs.call(r,n)&&n!==t&&Ht(r,n,{get:()=>e[n],enumerable:!(i=Ms(e,n))||i.enumerable});return r};var Xi=(r,e,t)=>(t=r!=null?Is(Os(r)):{},Ds(e||!r||!r.__esModule?Ht(t,"default",{value:r,enumerable:!0}):t,r));var b=(r,e,t)=>Fs(r,typeof e!="symbol"?e+"":e,t);var tn=j(rt=>{"use strict";var js="[object ArrayBuffer]",_e=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===js}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let i=r.toUint8Array(e),n=r.toUint8Array(t);if(i.length!==n.byteLength)return!1;for(let s=0;s<i.length;s++)if(i[s]!==n[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let i=0;for(let o of t)i+=o.byteLength;let n=new Uint8Array(i),s=0;for(let o of t){let a=this.toUint8Array(o);n.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}},ui="string",Ks=/^[0-9a-f\s]+$/i,$s=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Gs=/^[a-zA-Z0-9-_]+$/,qt=class{static fromString(e){let t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i.buffer}static toString(e){let t=_e.toUint8Array(e),i="";for(let s=0;s<t.length;s++)i+=String.fromCharCode(t[s]);return decodeURIComponent(escape(i))}},ae=class{static toString(e,t=!1){let i=_e.toArrayBuffer(e),n=new DataView(i),s="";for(let o=0;o<i.byteLength;o+=2){let a=n.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){let i=new ArrayBuffer(e.length*2),n=new DataView(i);for(let s=0;s<e.length;s++)n.setUint16(s*2,e.charCodeAt(s),t);return i}},jt=class r{static isHex(e){return typeof e===ui&&Ks.test(e)}static isBase64(e){return typeof e===ui&&$s.test(e)}static isBase64Url(e){return typeof e===ui&&Gs.test(e)}static ToString(e,t="utf8"){let i=_e.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(i);case"binary":return this.ToBinary(i);case"hex":return this.ToHex(i);case"base64":return this.ToBase64(i);case"base64url":return this.ToBase64Url(i);case"utf16le":return ae.toString(i,!0);case"utf16":case"utf16be":return ae.toString(i);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return ae.fromString(e,!0);case"utf16":case"utf16be":return ae.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=_e.toUint8Array(e);if(typeof btoa<"u"){let i=this.ToString(t,"binary");return btoa(i)}else return Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return qt.fromString(e);case"utf16":case"utf16be":return ae.fromString(e);case"utf16le":case"usc2":return ae.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return qt.toString(e);case"utf16":case"utf16be":return ae.toString(e);case"utf16le":case"usc2":return ae.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,i=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=e.charCodeAt(n);return i.buffer}static ToBinary(e){let t=_e.toUint8Array(e),i="";for(let n=0;n<t.length;n++)i+=String.fromCharCode(t[n]);return i}static ToHex(e){let t=_e.toUint8Array(e),i="",n=t.length;for(let s=0;s<n;s++){let o=t[s];o<16&&(i+="0"),i+=o.toString(16)}return i}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let i=new Uint8Array(t.length/2);for(let n=0;n<t.length;n=n+2){let s=t.slice(n,n+2);i[n/2]=parseInt(s,16)}return i.buffer}static ToUtf16String(e,t=!1){return ae.toString(e,t)}static FromUtf16String(e,t=!1){return ae.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let i=0;i<t;i++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};jt.DEFAULT_UTF8_ENCODING="utf8";function Ws(r,...e){let t=arguments[0];for(let i=1;i<arguments.length;i++){let n=arguments[i];for(let s in n)t[s]=n[s]}return t}function Js(...r){let e=r.map(n=>n.byteLength).reduce((n,s)=>n+s),t=new Uint8Array(e),i=0;return r.map(n=>new Uint8Array(n)).forEach(n=>{for(let s of n)t[i++]=s}),t.buffer}function Ys(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),i=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)if(t[n]!==i[n])return!1;return!0}rt.BufferSourceConverter=_e;rt.Convert=jt;rt.assign=Ws;rt.combine=Js;rt.isEqual=Ys});var $r=j(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.GROUP=void 0;Tt.errBadGroup=Ao;Tt.GROUP={P256:"P-256",P384:"P-384",P521:"P-521",RISTRETTO255:"ristretto255",DECAF448:"decaf448"};function Ao(r){return new Error(`group: bad group name ${r}.`)}});var Ye=j(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.joinAll=_o;q.xor=Bo;q.ctEqual=Eo;q.zip=xo;q.to16bits=Gr;q.toU16LenPrefix=Zn;q.toU16LenPrefixUint8Array=So;q.toU16LenPrefixClass=ko;q.fromU16LenPrefix=Xn;q.fromU16LenPrefixDes=Ro;q.fromU16LenPrefixUint8Array=To;q.checkSize=Lo;q.errDeserialization=Co;q.errGroup=Qn;q.compat=Po;function _o(r){let e=0;for(let n of r)e+=n.length;let t=new Uint8Array(new ArrayBuffer(e)),i=0;for(let n of r)t.set(n,i),i+=n.length;return t}function Bo(r,e){if(r.length!==e.length||r.length===0)throw new Error("arrays of different length");let t=r.length,i=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=r[n]^e[n];return i}function Eo(r,e){if(r.length!==e.length||r.length===0)return!1;let t=r.length,i=0;for(let n=0;n<t;n++)i|=r[n]^e[n];return i===0}function xo(r,e){return r.map((t,i)=>[t,e[i]])}function Gr(r){if(!(r>=0&&r<65535))throw new Error("number bigger than 2^16");return new Uint8Array([r>>8&255,r&255])}function Zn(r){return[Gr(r.length),r]}function So(r){return[Gr(r.length),...r.flatMap(e=>Zn(e))]}function ko(r){return[Gr(r.length),...r.map(e=>e.serialize())]}function Xn(r){if(r.length<2)throw new Error("buffer shorter than expected");let e=r[0]<<8|r[1];if(r.length<2+e)throw new Error("buffer shorter than expected");let t=r.subarray(2,2+e),i=r.subarray(2+e);return{head:t,tail:i}}function Ro(r,e){if(e.length<2)throw new Error("buffer shorter than expected");let t=e[0]<<8|e[1],i=r.size();if(e.length<2+t*i)throw new Error("buffer shorter than expected");let n=[];for(let o=0;o<t;o++)n.push(r.deserialize(e.subarray(2+o*i,2+(o+1)*i)));let s=e.subarray(2+t*i);return{head:n,tail:s}}function To(r){if(r.length<2)throw new Error("buffer shorter than expected");let e=r[0]<<8|r[1],t=r.subarray(2),i=[];for(let n=0;n<e;n++){let{head:s,tail:o}=Xn(t);i.push(s),t=o}return{head:i,tail:t}}function Lo(r,e,t){if(r.length<e.size(t))throw new Error(`error deserializing ${e.name}: buffer shorter than expected`)}function Co(r){return new Error(`group: deserialization of ${r.name} failed.`)}function Qn(r,e){return new Error(`group: mismatch between groups ${r} and ${e}.`)}function Po(r,e){if(r.g.id!==e.g.id)throw Qn(r.g.id,e.g.id)}});var es=j(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.LABELS=Ne.SUITE=Ne.MODE=void 0;Ne.MODE={OPRF:0,VOPRF:1,POPRF:2};Ne.SUITE={P256_SHA256:"P256-SHA256",P384_SHA384:"P384-SHA384",P521_SHA512:"P521-SHA512",RISTRETTO255_SHA512:"ristretto255-SHA512",DECAF448_SHAKE256:"decaf448-SHAKE256"};Ne.LABELS={Version:"OPRFV1-",FinalizeDST:"Finalize",HashToGroupDST:"HashToGroup-",HashToScalarDST:"HashToScalar-",DeriveKeyPairDST:"DeriveKeyPair",InfoLabel:"Info"}});var at=j(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.FinalizeData=fe.EvaluationRequest=fe.Evaluation=fe.Oprf=void 0;fe.getOprfParams=Ct;fe.getSupportedSuites=Uo;var ts=Pt(),Lt=$r(),D=Ye(),Li=es(),Ze=Jr();function Ci(r,e){throw new Error(`unexpected ${r} identifier: ${e}`)}function Ct(r){switch(r){case P.Suite.P256_SHA256:return[P.Suite.P256_SHA256,Lt.GROUP.P256,"SHA-256",32];case P.Suite.P384_SHA384:return[P.Suite.P384_SHA384,Lt.GROUP.P384,"SHA-384",48];case P.Suite.P521_SHA512:return[P.Suite.P521_SHA512,Lt.GROUP.P521,"SHA-512",64];case P.Suite.RISTRETTO255_SHA512:return[P.Suite.RISTRETTO255_SHA512,Lt.GROUP.RISTRETTO255,"SHA-512",64];case P.Suite.DECAF448_SHAKE256:return[P.Suite.DECAF448_SHAKE256,Lt.GROUP.DECAF448,"SHAKE256",64];default:Ci("Oprf.Suite",r)}}function Uo(r){return Object.values(P.Suite).filter(e=>r.supportedGroups.includes(Ct(e)[1]))}var P=class r{static set Crypto(e){(0,Ze.setCryptoProvider)(e)}static get Crypto(){return(0,Ze.getCryptoProvider)()}static validateMode(e){switch(e){case r.Mode.OPRF:case r.Mode.VOPRF:case r.Mode.POPRF:return e;default:Ci("Oprf.Mode",e)}}static getGroup(e,...t){return(0,Ze.getSuiteGroup)(e,t)}static getHash(e){return Ct(e)[2]}static getOprfSize(e){return Ct(e)[3]}static getDST(e,t,i){let n=r.validateMode(e),s=new TextEncoder;return(0,D.joinAll)([s.encode(i+r.LABELS.Version),Uint8Array.of(n),s.encode("-"+t)])}constructor(e,t,...i){let[n,s,o]=Ct(t);this.crypto=(0,Ze.getCrypto)(i),this.group=this.crypto.Group.get(s),this.suite=n,this.hashID=o,this.mode=r.validateMode(e)}getDLEQParams(){return{group:this.group.id,hash:this.hashID,dst:this.getDST("")}}getDST(e){return r.getDST(this.mode,this.suite,e)}async coreFinalize(e,t,i){let n=[];this.mode===r.Mode.POPRF&&(n=(0,D.toU16LenPrefix)(i));let s=(0,D.joinAll)([...(0,D.toU16LenPrefix)(e),...n,...(0,D.toU16LenPrefix)(t),new TextEncoder().encode(r.LABELS.FinalizeDST)]);return await this.crypto.hash(this.hashID,s)}scalarFromInfo(e){if(e.length>=65536)throw new Error("invalid info length");let t=new TextEncoder,i=(0,D.joinAll)([t.encode(r.LABELS.InfoLabel),...(0,D.toU16LenPrefix)(e)]);return this.group.hashToScalar(i,this.getDST(r.LABELS.HashToScalarDST))}};fe.Oprf=P;P.Mode=Li.MODE;P.Suite=Li.SUITE;P.LABELS=Li.LABELS;var Ri=class r{constructor(e,t,i){this.mode=e,this.evaluated=t,this.proof=i}serialize(){let e=new Uint8Array;return this.proof&&(this.mode==P.Mode.VOPRF||this.mode==P.Mode.POPRF)&&(e=this.proof.serialize()),(0,D.joinAll)([...(0,D.toU16LenPrefixClass)(this.evaluated),Uint8Array.from([this.mode]),e])}isEqual(e){if(this.mode!==e.mode||this.proof&&!e.proof||!this.proof&&e.proof)return!1;let t=this.evaluated.every((i,n)=>i.isEqual(e.evaluated[n]));return this.proof&&e.proof&&t&&(t=this.proof.isEqual(e.proof)),t}static deserialize(e,t,...i){let n=(0,Ze.getSuiteGroup)(e,i),{head:s,tail:o}=(0,D.fromU16LenPrefixDes)(n.eltDes,t),a,l=ts.DLEQProof.size(n),c=o.subarray(1,1+l),h=o[0];switch(h){case P.Mode.OPRF:break;case P.Mode.VOPRF:case P.Mode.POPRF:a=ts.DLEQProof.deserialize(n.id,c,...i);break;default:Ci("Oprf.Mode",h)}return new r(h,s,a)}};fe.Evaluation=Ri;var Wr=class r{constructor(e){this.blinded=e}serialize(){return(0,D.joinAll)((0,D.toU16LenPrefixClass)(this.blinded))}isEqual(e){return this.blinded.every((t,i)=>t.isEqual(e.blinded[i]))}static deserialize(e,t,...i){let n=(0,Ze.getSuiteGroup)(e,i),{head:s}=(0,D.fromU16LenPrefixDes)(n.eltDes,t);return new r(s)}};fe.EvaluationRequest=Wr;var Ti=class r{constructor(e,t,i){this.inputs=e,this.blinds=t,this.evalReq=i}serialize(){return(0,D.joinAll)([...(0,D.toU16LenPrefixUint8Array)(this.inputs),...(0,D.toU16LenPrefixClass)(this.blinds),this.evalReq.serialize()])}isEqual(e){return this.inputs.every((t,i)=>t.toString()===e.inputs[i].toString())&&this.blinds.every((t,i)=>t.isEqual(e.blinds[i]))&&this.evalReq.isEqual(e.evalReq)}static deserialize(e,t,...i){let n=(0,Ze.getSuiteGroup)(e,i),{head:s,tail:o}=(0,D.fromU16LenPrefixUint8Array)(t),{head:a,tail:l}=(0,D.fromU16LenPrefixDes)(n.scalarDes,o),c=Wr.deserialize(e,l,...i);return new r(s,a,c)}};fe.FinalizeData=Ti});var rs=j((Yr,Pi)=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});var u={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(r){this.toString=function(){return"CORRUPT: "+this.message},this.message=r},invalid:function(r){this.toString=function(){return"INVALID: "+this.message},this.message=r},bug:function(r){this.toString=function(){return"BUG: "+this.message},this.message=r},notReady:function(r){this.toString=function(){return"NOT READY: "+this.message},this.message=r}}};u.cipher.aes=function(r){this._tables[0][0][0]||this._precompute();var e,t,i,n,s,o=this._tables[0][4],a=this._tables[1],l=r.length,c=1;if(l!==4&&l!==6&&l!==8)throw new u.exception.invalid("invalid aes key size");for(this._key=[n=r.slice(0),s=[]],e=l;e<4*l+28;e++)i=n[e-1],(e%l===0||l===8&&e%l===4)&&(i=o[i>>>24]<<24^o[i>>16&255]<<16^o[i>>8&255]<<8^o[i&255],e%l===0&&(i=i<<8^i>>>24^c<<24,c=c<<1^(c>>7)*283)),n[e]=n[e-l]^i;for(t=0;e;t++,e--)i=n[t&3?e:e-4],e<=4||t<4?s[t]=i:s[t]=a[0][o[i>>>24]]^a[1][o[i>>16&255]]^a[2][o[i>>8&255]]^a[3][o[i&255]]};u.cipher.aes.prototype={encrypt:function(r){return this._crypt(r,0)},decrypt:function(r){return this._crypt(r,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var r=this._tables[0],e=this._tables[1],t=r[4],i=e[4],n,s,o,a=[],l=[],c,h,f,p,m,g;for(n=0;n<256;n++)l[(a[n]=n<<1^(n>>7)*283)^n]=n;for(s=o=0;!t[s];s^=c||1,o=l[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^p&255^99,t[s]=p,i[p]=s,f=a[h=a[c=a[s]]],g=f*16843009^h*65537^c*257^s*16843008,m=a[p]*257^p*16843008,n=0;n<4;n++)r[n][s]=m=m<<24^m>>>8,e[n][p]=g=g<<24^g>>>8;for(n=0;n<5;n++)r[n]=r[n].slice(0),e[n]=e[n].slice(0)},_crypt:function(r,e){if(r.length!==4)throw new u.exception.invalid("invalid aes block size");var t=this._key[e],i=r[0]^t[0],n=r[e?3:1]^t[1],s=r[2]^t[2],o=r[e?1:3]^t[3],a,l,c,h=t.length/4-2,f,p=4,m=[0,0,0,0],g=this._tables[e],v=g[0],_=g[1],B=g[2],A=g[3],k=g[4];for(f=0;f<h;f++)a=v[i>>>24]^_[n>>16&255]^B[s>>8&255]^A[o&255]^t[p],l=v[n>>>24]^_[s>>16&255]^B[o>>8&255]^A[i&255]^t[p+1],c=v[s>>>24]^_[o>>16&255]^B[i>>8&255]^A[n&255]^t[p+2],o=v[o>>>24]^_[i>>16&255]^B[n>>8&255]^A[s&255]^t[p+3],p+=4,i=a,n=l,s=c;for(f=0;f<4;f++)m[e?3&-f:f]=k[i>>>24]<<24^k[n>>16&255]<<16^k[s>>8&255]<<8^k[o&255]^t[p++],a=i,i=n,n=s,s=o,o=a;return m}};u.bitArray={bitSlice:function(r,e,t){return r=u.bitArray._shiftRight(r.slice(e/32),32-(e&31)).slice(1),t===void 0?r:u.bitArray.clamp(r,t-e)},extract:function(r,e,t){var i,n=Math.floor(-e-t&31);return(e+t-1^e)&-32?i=r[e/32|0]<<32-n^r[e/32+1|0]>>>n:i=r[e/32|0]>>>n,i&(1<<t)-1},concat:function(r,e){if(r.length===0||e.length===0)return r.concat(e);var t=r[r.length-1],i=u.bitArray.getPartial(t);return i===32?r.concat(e):u.bitArray._shiftRight(e,i,t|0,r.slice(0,r.length-1))},bitLength:function(r){var e=r.length,t;return e===0?0:(t=r[e-1],(e-1)*32+u.bitArray.getPartial(t))},clamp:function(r,e){if(r.length*32<e)return r;r=r.slice(0,Math.ceil(e/32));var t=r.length;return e=e&31,t>0&&e&&(r[t-1]=u.bitArray.partial(e,r[t-1]&2147483648>>e-1,1)),r},partial:function(r,e,t){return r===32?e:(t?e|0:e<<32-r)+r*1099511627776},getPartial:function(r){return Math.round(r/1099511627776)||32},equal:function(r,e){if(u.bitArray.bitLength(r)!==u.bitArray.bitLength(e))return!1;var t=0,i;for(i=0;i<r.length;i++)t|=r[i]^e[i];return t===0},_shiftRight:function(r,e,t,i){var n,s=0,o;for(i===void 0&&(i=[]);e>=32;e-=32)i.push(t),t=0;if(e===0)return i.concat(r);for(n=0;n<r.length;n++)i.push(t|r[n]>>>e),t=r[n]<<32-e;return s=r.length?r[r.length-1]:0,o=u.bitArray.getPartial(s),i.push(u.bitArray.partial(e+o&31,e+o>32?t:i.pop(),1)),i},_xor4:function(r,e){return[r[0]^e[0],r[1]^e[1],r[2]^e[2],r[3]^e[3]]},byteswapM:function(r){var e,t,i=65280;for(e=0;e<r.length;++e)t=r[e],r[e]=t>>>24|t>>>8&i|(t&i)<<8|t<<24;return r}};u.codec.utf8String={fromBits:function(r){var e="",t=u.bitArray.bitLength(r),i,n;for(i=0;i<t/8;i++)(i&3)===0&&(n=r[i/4]),e+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(e))},toBits:function(r){r=unescape(encodeURIComponent(r));var e=[],t,i=0;for(t=0;t<r.length;t++)i=i<<8|r.charCodeAt(t),(t&3)===3&&(e.push(i),i=0);return t&3&&e.push(u.bitArray.partial(8*(t&3),i)),e}};u.codec.hex={fromBits:function(r){var e="",t;for(t=0;t<r.length;t++)e+=((r[t]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,u.bitArray.bitLength(r)/4)},toBits:function(r){var e,t=[],i;for(r=r.replace(/\s|0x/g,""),i=r.length,r=r+"00000000",e=0;e<r.length;e+=8)t.push(parseInt(r.substr(e,8),16)^0);return u.bitArray.clamp(t,i*4)}};u.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(r,e,t){var i="",n,s=0,o=u.codec.base64._chars,a=0,l=u.bitArray.bitLength(r);for(t&&(o=o.substr(0,62)+"-_"),n=0;i.length*6<l;)i+=o.charAt((a^r[n]>>>s)>>>26),s<6?(a=r[n]<<6-s,s+=26,n++):(a<<=6,s-=6);for(;i.length&3&&!e;)i+="=";return i},toBits:function(r,e){r=r.replace(/\s|=/g,"");var t=[],i,n=0,s=u.codec.base64._chars,o=0,a;for(e&&(s=s.substr(0,62)+"-_"),i=0;i<r.length;i++){if(a=s.indexOf(r.charAt(i)),a<0)throw new u.exception.invalid("this isn't base64!");n>26?(n-=26,t.push(o^a>>>n),o=a<<32-n):(n+=6,o^=a<<32-n)}return n&56&&t.push(u.bitArray.partial(n&56,o,1)),t}};u.codec.base64url={fromBits:function(r){return u.codec.base64.fromBits(r,1,1)},toBits:function(r){return u.codec.base64.toBits(r,1)}};u.codec.bytes={fromBits:function(r){var e=[],t=u.bitArray.bitLength(r),i,n;for(i=0;i<t/8;i++)(i&3)===0&&(n=r[i/4]),e.push(n>>>24),n<<=8;return e},toBits:function(r){var e=[],t,i=0;for(t=0;t<r.length;t++)i=i<<8|r[t],(t&3)===3&&(e.push(i),i=0);return t&3&&e.push(u.bitArray.partial(8*(t&3),i)),e}};u.hash.sha256=function(r){this._key[0]||this._precompute(),r?(this._h=r._h.slice(0),this._buffer=r._buffer.slice(0),this._length=r._length):this.reset()};u.hash.sha256.hash=function(r){return new u.hash.sha256().update(r).finalize()};u.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(r){typeof r=="string"&&(r=u.codec.utf8String.toBits(r));var e,t=this._buffer=u.bitArray.concat(this._buffer,r),i=this._length,n=this._length=i+u.bitArray.bitLength(r);if(n>9007199254740991)throw new u.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var s=new Uint32Array(t),o=0;for(e=512+i-(512+i&511);e<=n;e+=512)this._block(s.subarray(16*o,16*(o+1))),o+=1;t.splice(0,16*o)}else for(e=512+i-(512+i&511);e<=n;e+=512)this._block(t.splice(0,16));return this},finalize:function(){var r,e=this._buffer,t=this._h;for(e=u.bitArray.concat(e,[u.bitArray.partial(1,1)]),r=e.length+2;r&15;r++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(this._length|0);e.length;)this._block(e.splice(0,16));return this.reset(),t},_init:[],_key:[],_precompute:function(){var r=0,e=2,t,i;function n(s){return(s-Math.floor(s))*4294967296|0}for(;r<64;e++){for(i=!0,t=2;t*t<=e;t++)if(e%t===0){i=!1;break}i&&(r<8&&(this._init[r]=n(Math.pow(e,1/2))),this._key[r]=n(Math.pow(e,1/3)),r++)}},_block:function(r){var e,t,i,n,s=this._h,o=this._key,a=s[0],l=s[1],c=s[2],h=s[3],f=s[4],p=s[5],m=s[6],g=s[7];for(e=0;e<64;e++)e<16?t=r[e]:(i=r[e+1&15],n=r[e+14&15],t=r[e&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+r[e&15]+r[e+9&15]|0),t=t+g+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(m^f&(p^m))+o[e],g=m,m=p,p=f,f=h+t|0,h=c,c=l,l=a,a=t+(l&c^h&(l^c))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+a|0,s[1]=s[1]+l|0,s[2]=s[2]+c|0,s[3]=s[3]+h|0,s[4]=s[4]+f|0,s[5]=s[5]+p|0,s[6]=s[6]+m|0,s[7]=s[7]+g|0}};u.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:function(r){u.mode.ccm._progressListeners.push(r)},unListenProgress:function(r){var e=u.mode.ccm._progressListeners.indexOf(r);e>-1&&u.mode.ccm._progressListeners.splice(e,1)},_callProgressListener:function(r){var e=u.mode.ccm._progressListeners.slice(),t;for(t=0;t<e.length;t+=1)e[t](r)},encrypt:function(r,e,t,i,n){var s,o=e.slice(0),a,l=u.bitArray,c=l.bitLength(t)/8,h=l.bitLength(o)/8;if(n=n||64,i=i||[],c<7)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&h>>>8*s;s++);return s<15-c&&(s=15-c),t=l.clamp(t,8*(15-s)),a=u.mode.ccm._computeTag(r,e,t,i,n,s),o=u.mode.ccm._ctrMode(r,o,t,a,n,s),l.concat(o.data,o.tag)},decrypt:function(r,e,t,i,n){n=n||64,i=i||[];var s,o=u.bitArray,a=o.bitLength(t)/8,l=o.bitLength(e),c=o.clamp(e,l-n),h=o.bitSlice(e,l-n),f;if(l=(l-n)/8,a<7)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&l>>>8*s;s++);if(s<15-a&&(s=15-a),t=o.clamp(t,8*(15-s)),c=u.mode.ccm._ctrMode(r,c,t,h,n,s),f=u.mode.ccm._computeTag(r,c.data,t,i,n,s),!o.equal(c.tag,f))throw new u.exception.corrupt("ccm: tag doesn't match");return c.data},_macAdditionalData:function(r,e,t,i,n,s){var o,a,l,c=[],h=u.bitArray,f=h._xor4;if(o=[h.partial(8,(e.length?64:0)|i-2<<2|s-1)],o=h.concat(o,t),o[3]|=n,o=r.encrypt(o),e.length)for(a=h.bitLength(e)/8,a<=65279?c=[h.partial(16,a)]:a<=4294967295&&(c=h.concat([h.partial(16,65534)],[a])),c=h.concat(c,e),l=0;l<c.length;l+=4)o=r.encrypt(f(o,c.slice(l,l+4).concat([0,0,0])));return o},_computeTag:function(r,e,t,i,n,s){var o,a,l=u.bitArray,c=l._xor4;if(n/=8,n%2||n<4||n>16)throw new u.exception.invalid("ccm: invalid tag length");if(i.length>4294967295||e.length>4294967295)throw new u.exception.bug("ccm: can't deal with 4GiB or more data");for(o=u.mode.ccm._macAdditionalData(r,i,t,n,l.bitLength(e)/8,s),a=0;a<e.length;a+=4)o=r.encrypt(c(o,e.slice(a,a+4).concat([0,0,0])));return l.clamp(o,n*8)},_ctrMode:function(r,e,t,i,n,s){var o,a,l=u.bitArray,c=l._xor4,h,f=e.length,p=l.bitLength(e),m=f/50,g=m;if(h=l.concat([l.partial(8,s-1)],t).concat([0,0,0]).slice(0,4),i=l.bitSlice(c(i,r.encrypt(h)),0,n),!f)return{tag:i,data:[]};for(a=0;a<f;a+=4)a>m&&(u.mode.ccm._callProgressListener(a/f),m+=g),h[3]++,o=r.encrypt(h),e[a]^=o[0],e[a+1]^=o[1],e[a+2]^=o[2],e[a+3]^=o[3];return{tag:i,data:l.clamp(e,p)}}};u.misc.hmac=function(r,e){this._hash=e=e||u.hash.sha256;var t=[[],[]],i,n=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],r.length>n&&(r=e.hash(r)),i=0;i<n;i++)t[0][i]=r[i]^909522486,t[1][i]=r[i]^1549556828;this._baseHash[0].update(t[0]),this._baseHash[1].update(t[1]),this._resultHash=new e(this._baseHash[0])};u.misc.hmac.prototype.encrypt=u.misc.hmac.prototype.mac=function(r){if(this._updated)throw new u.exception.invalid("encrypt on already updated hmac called!");return this.update(r),this.digest(r)};u.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1};u.misc.hmac.prototype.update=function(r){this._updated=!0,this._resultHash.update(r)};u.misc.hmac.prototype.digest=function(){var r=this._resultHash.finalize(),e=new this._hash(this._baseHash[1]).update(r).finalize();return this.reset(),e};u.misc.pbkdf2=function(r,e,t,i,n){if(t=t||1e4,i<0||t<0)throw new u.exception.invalid("invalid params to pbkdf2");typeof r=="string"&&(r=u.codec.utf8String.toBits(r)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),n=n||u.misc.hmac;var s=new n(r),o,a,l,c,h,f=[],p=u.bitArray;for(h=1;32*f.length<(i||1);h++){for(o=a=s.encrypt(p.concat(e,[h])),l=1;l<t;l++)for(a=s.encrypt(a),c=0;c<a.length;c++)o[c]^=a[c];f=f.concat(o)}return i&&(f=p.clamp(f,i)),f};u.prng=function(r){this._pools=[new u.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=r,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80};u.prng.prototype={randomWords:function(r,e){var t=[],i,n=this.isReady(e),s;if(n===this._NOT_READY)throw new u.exception.notReady("generator isn't seeded");for(n&this._REQUIRES_RESEED&&this._reseedFromPools(!(n&this._READY)),i=0;i<r;i+=4)(i+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),s=this._gen4words(),t.push(s[0],s[1],s[2],s[3]);return this._gate(),t.slice(0,r)},setDefaultParanoia:function(r,e){if(r===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new u.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=r},addEntropy:function(r,e,t){t=t||"user";var i,n,s,o=new Date().valueOf(),a=this._robins[t],l=this.isReady(),c=0,h;switch(i=this._collectorIds[t],i===void 0&&(i=this._collectorIds[t]=this._collectorIdNext++),a===void 0&&(a=this._robins[t]=0),this._robins[t]=(this._robins[t]+1)%this._pools.length,typeof r){case"number":e===void 0&&(e=1),this._pools[a].update([i,this._eventId++,1,e,o,1,r|0]);break;case"object":if(h=Object.prototype.toString.call(r),h==="[object Uint32Array]"){for(s=[],n=0;n<r.length;n++)s.push(r[n]);r=s}else for(h!=="[object Array]"&&(c=1),n=0;n<r.length&&!c;n++)typeof r[n]!="number"&&(c=1);if(!c){if(e===void 0)for(e=0,n=0;n<r.length;n++)for(s=r[n];s>0;)e++,s=s>>>1;this._pools[a].update([i,this._eventId++,2,e,o,r.length].concat(r))}break;case"string":e===void 0&&(e=r.length),this._pools[a].update([i,this._eventId++,3,e,o,r.length]),this._pools[a].update(r);break;default:c=1}if(c)throw new u.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(r){var e=this._PARANOIA_LEVELS[r!==void 0?r:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&new Date().valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(r){var e=this._PARANOIA_LEVELS[r||this._defaultParanoia];return this._strength>=e||this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new u.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(r,e){this._callbacks[r][this._callbackI++]=e},removeEventListener:function(r,e){var t,i,n=this._callbacks[r],s=[];for(i in n)n.hasOwnProperty(i)&&n[i]===e&&s.push(i);for(t=0;t<s.length;t++)i=s[t],delete n[i]},_bind:function(r){var e=this;return function(){r.apply(e,arguments)}},_gen4words:function(){for(var r=0;r<4&&(this._counter[r]=this._counter[r]+1|0,!this._counter[r]);r++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new u.cipher.aes(this._key)},_reseed:function(r){this._key=u.hash.sha256.hash(this._key.concat(r)),this._cipher=new u.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(r){var e=[],t=0,i;for(this._nextReseed=e[0]=new Date().valueOf()+this._MILLISECONDS_PER_RESEED,i=0;i<16;i++)e.push(Math.random()*4294967296|0);for(i=0;i<this._pools.length&&(e=e.concat(this._pools[i].finalize()),t+=this._poolEntropy[i],this._poolEntropy[i]=0,!(!r&&this._reseedCount&1<<i));i++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new u.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=t,t>this._strength&&(this._strength=t),this._reseedCount++,this._reseed(e)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(r){var e,t;try{e=r.x||r.clientX||r.offsetX||0,t=r.y||r.clientY||r.offsetY||0}catch{e=0,t=0}e!=0&&t!=0&&this.addEntropy([e,t],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(r){var e=r.touches[0]||r.changedTouches[0],t=e.pageX||e.clientX,i=e.pageY||e.clientY;this.addEntropy([t,i],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(r){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?this.addEntropy(window.performance.now(),r,"loadtime"):this.addEntropy(new Date().valueOf(),r,"loadtime")},_accelerometerCollector:function(r){var e=r.accelerationIncludingGravity.x||r.accelerationIncludingGravity.y||r.accelerationIncludingGravity.z;if(window.orientation){var t=window.orientation;typeof t=="number"&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(r,e){var t,i=u.random._callbacks[r],n=[];for(t in i)i.hasOwnProperty(t)&&n.push(i[t]);for(t=0;t<n.length;t++)n[t](e)}};u.random=new u.prng(6);(function(){function r(){try{return Zi("crypto")}catch{return null}}try{var e,t,i;if(typeof Pi<"u"&&Pi.exports&&(t=r())&&t.randomBytes)e=t.randomBytes(1024/8),e=new Uint32Array(new Uint8Array(e).buffer),u.random.addEntropy(e,1024,"crypto.randomBytes");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(i=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(i);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(i);else return;u.random.addEntropy(i,1024,"crypto.getRandomValues")}}catch(n){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(n))}})();u.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(r,e,t,i){t=t||{},i=i||{};var n=u.json,s=n._add({iv:u.random.randomWords(4,0)},n.defaults),o,a,l;if(n._add(s,t),l=s.adata,typeof s.salt=="string"&&(s.salt=u.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=u.codec.base64.toBits(s.iv)),!u.mode[s.mode]||!u.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||s.iv.length<2||s.iv.length>4)throw new u.exception.invalid("json encrypt: invalid parameters");return typeof r=="string"?(o=u.misc.cachedPbkdf2(r,s),r=o.key.slice(0,s.ks/32),s.salt=o.salt):u.ecc&&r instanceof u.ecc.elGamal.publicKey&&(o=r.kem(),s.kemtag=o.tag,r=o.key.slice(0,s.ks/32)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),typeof l=="string"&&(s.adata=l=u.codec.utf8String.toBits(l)),a=new u.cipher[s.cipher](r),n._add(i,s),i.key=r,s.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&e instanceof ArrayBuffer?s.ct=u.arrayBuffer.ccm.encrypt(a,e,s.iv,l,s.ts):s.ct=u.mode[s.mode].encrypt(a,e,s.iv,l,s.ts),s},encrypt:function(r,e,t,i){var n=u.json,s=n._encrypt.apply(n,arguments);return n.encode(s)},_decrypt:function(r,e,t,i){t=t||{},i=i||{};var n=u.json,s=n._add(n._add(n._add({},n.defaults),e),t,!0),o,a,l,c=s.adata;if(typeof s.salt=="string"&&(s.salt=u.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=u.codec.base64.toBits(s.iv)),!u.mode[s.mode]||!u.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||!s.iv||s.iv.length<2||s.iv.length>4)throw new u.exception.invalid("json decrypt: invalid parameters");return typeof r=="string"?(a=u.misc.cachedPbkdf2(r,s),r=a.key.slice(0,s.ks/32),s.salt=a.salt):u.ecc&&r instanceof u.ecc.elGamal.secretKey&&(r=r.unkem(u.codec.base64.toBits(s.kemtag)).slice(0,s.ks/32)),typeof c=="string"&&(c=u.codec.utf8String.toBits(c)),l=new u.cipher[s.cipher](r),s.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&s.ct instanceof ArrayBuffer?o=u.arrayBuffer.ccm.decrypt(l,s.ct,s.iv,s.tag,c,s.ts):o=u.mode[s.mode].decrypt(l,s.ct,s.iv,c,s.ts),n._add(i,s),i.key=r,t.raw===1?o:u.codec.utf8String.fromBits(o)},decrypt:function(r,e,t,i){var n=u.json;return n._decrypt(r,n.decode(e),t,i)},encode:function(r){var e,t="{",i="";for(e in r)if(r.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new u.exception.invalid("json encode: invalid property name");switch(t+=i+'"'+e+'":',i=",",typeof r[e]){case"number":case"boolean":t+=r[e];break;case"string":t+='"'+escape(r[e])+'"';break;case"object":t+='"'+u.codec.base64.fromBits(r[e],0)+'"';break;default:throw new u.exception.bug("json encode: unsupported type")}}return t+"}"},decode:function(r){if(r=r.replace(/\s/g,""),!r.match(/^\{.*\}$/))throw new u.exception.invalid("json decode: this isn't json!");var e=r.replace(/^\{|\}$/g,"").split(/,/),t={},i,n;for(i=0;i<e.length;i++){if(!(n=e[i].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new u.exception.invalid("json decode: this isn't json!");n[3]!=null?t[n[2]]=parseInt(n[3],10):n[4]!=null?t[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?u.codec.base64.toBits(n[4]):unescape(n[4]):n[5]!=null&&(t[n[2]]=n[5]==="true")}return t},_add:function(r,e,t){if(r===void 0&&(r={}),e===void 0)return r;var i;for(i in e)if(e.hasOwnProperty(i)){if(t&&r[i]!==void 0&&r[i]!==e[i])throw new u.exception.invalid("required parameter overridden");r[i]=e[i]}return r},_subtract:function(r,e){var t={},i;for(i in r)r.hasOwnProperty(i)&&r[i]!==e[i]&&(t[i]=r[i]);return t},_filter:function(r,e){var t={},i;for(i=0;i<e.length;i++)r[e[i]]!==void 0&&(t[e[i]]=r[e[i]]);return t}};u.encrypt=u.json.encrypt;u.decrypt=u.json.decrypt;u.misc._pbkdf2Cache={};u.misc.cachedPbkdf2=function(r,e){var t=u.misc._pbkdf2Cache,i,n,s,o,a;return e=e||{},a=e.iter||1e3,n=t[r]=t[r]||{},i=n[a]=n[a]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):u.random.randomWords(2,0)},o=e.salt===void 0?i.firstSalt:e.salt,i[o]=i[o]||u.misc.pbkdf2(r,o,e.iter),{key:i[o].slice(0),salt:o.slice(0)}};u.bn=function(r){this.initWith(r)};u.bn.prototype={radix:24,maxMul:8,_class:u.bn,copy:function(){return new this._class(this)},initWith:function(r){var e=0,t;switch(typeof r){case"object":this.limbs=r.limbs.slice(0);break;case"number":this.limbs=[r],this.normalize();break;case"string":for(r=r.replace(/^0x/,""),this.limbs=[],t=this.radix/4,e=0;e<r.length;e+=t)this.limbs.push(parseInt(r.substring(Math.max(r.length-e-t,0),r.length-e),16));break;default:this.limbs=[0]}return this},equals:function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t;for(this.fullReduce(),r.fullReduce(),t=0;t<this.limbs.length||t<r.limbs.length;t++)e|=this.getLimb(t)^r.getLimb(t);return e===0},getLimb:function(r){return r>=this.limbs.length?0:this.limbs[r]},greaterEquals:function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t=0,i,n,s;for(i=Math.max(this.limbs.length,r.limbs.length)-1;i>=0;i--)n=this.getLimb(i),s=r.getLimb(i),t|=s-n&~e,e|=n-s&~t;return(t|~e)>>>31},toString:function(){this.fullReduce();var r="",e,t,i=this.limbs;for(e=0;e<this.limbs.length;e++){for(t=i[e].toString(16);e<this.limbs.length-1&&t.length<6;)t="0"+t;r=t+r}return"0x"+r},addM:function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,i=r.limbs;for(e=t.length;e<i.length;e++)t[e]=0;for(e=0;e<i.length;e++)t[e]+=i[e];return this},doubleM:function(){var r,e=0,t,i=this.radix,n=this.radixMask,s=this.limbs;for(r=0;r<s.length;r++)t=s[r],t=t+t+e,s[r]=t&n,e=t>>i;return e&&s.push(e),this},halveM:function(){var r,e=0,t,i=this.radix,n=this.limbs;for(r=n.length-1;r>=0;r--)t=n[r],n[r]=t+e>>1,e=(t&1)<<i;return n[n.length-1]||n.pop(),this},subM:function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,i=r.limbs;for(e=t.length;e<i.length;e++)t[e]=0;for(e=0;e<i.length;e++)t[e]-=i[e];return this},mod:function(r){var e=!this.greaterEquals(new u.bn(0));r=new u.bn(r).normalize();var t=new u.bn(this).normalize(),i=0;for(e&&(t=new u.bn(0).subM(t).normalize());t.greaterEquals(r);i++)r.doubleM();for(e&&(t=r.sub(t).normalize());i>0;i--)r.halveM(),t.greaterEquals(r)&&t.subM(r).normalize();return t.trim()},inverseMod:function(r){var e=new u.bn(1),t=new u.bn(0),i=new u.bn(this),n=new u.bn(r),s,o,a=1;if(!(r.limbs[0]&1))throw new u.exception.invalid("inverseMod: p must be odd");do for(i.limbs[0]&1&&(i.greaterEquals(n)||(s=i,i=n,n=s,s=e,e=t,t=s),i.subM(n),i.normalize(),e.greaterEquals(t)||e.addM(r),e.subM(t)),i.halveM(),e.limbs[0]&1&&e.addM(r),e.normalize(),e.halveM(),o=a=0;o<i.limbs.length;o++)a|=i.limbs[o];while(a);if(!n.equals(1))throw new u.exception.invalid("inverseMod: p and x must be relatively prime");return t},add:function(r){return this.copy().addM(r)},sub:function(r){return this.copy().subM(r)},mul:function(r){typeof r=="number"?r=new this._class(r):r.normalize(),this.normalize();var e,t,i=this.limbs,n=r.limbs,s=i.length,o=n.length,a=new this._class,l=a.limbs,c,h=this.maxMul;for(e=0;e<this.limbs.length+r.limbs.length+1;e++)l[e]=0;for(e=0;e<s;e++){for(c=i[e],t=0;t<o;t++)l[e+t]+=c*n[t];--h||(h=this.maxMul,a.cnormalize())}return a.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(r){r=new u.bn(r).normalize().trim().limbs;var e,t,i=new this._class(1),n=this;for(e=0;e<r.length;e++)for(t=0;t<this.radix&&(r[e]&1<<t&&(i=i.mul(n)),!(e==r.length-1&&r[e]>>t+1==0));t++)n=n.square();return i},mulmod:function(r,e){return this.mod(e).mul(r.mod(e)).mod(e)},powermod:function(r,e){if(r=new u.bn(r),e=new u.bn(e),(e.limbs[0]&1)==1){var t=this.montpowermod(r,e);if(t!=!1)return t}var i,n,s=r.normalize().trim().limbs,o=new this._class(1),a=this;for(i=0;i<s.length;i++)for(n=0;n<this.radix&&(s[i]&1<<n&&(o=o.mulmod(a,e)),!(i==s.length-1&&s[i]>>n+1==0));n++)a=a.mulmod(a,e);return o},montpowermod:function(r,e){r=new u.bn(r).normalize().trim(),e=new u.bn(e);var t,i,n=this.radix,s=new this._class(1),o=this.copy(),a,l,c,h=r.bitLength();for(a=new u.bn({limbs:e.copy().normalize().trim().limbs.map(function(){return 0})}),l=this.radix;l>0;l--)if((e.limbs[e.limbs.length-1]>>l&1)==1){a.limbs[a.limbs.length-1]=1<<l;break}if(h==0)return this;h<18?c=1:h<48?c=3:h<144?c=4:h<768?c=5:c=6;for(var f=a.copy(),p=e.copy(),m=new u.bn(1),g=new u.bn(0),v=a.copy();v.greaterEquals(1);)v.halveM(),(m.limbs[0]&1)==0?(m.halveM(),g.halveM()):(m.addM(p),m.halveM(),g.halveM(),g.addM(f));m=m.normalize(),g=g.normalize(),f.doubleM();var _=f.mulmod(f,e);if(!f.mul(m).sub(e.mul(g)).equals(1))return!1;var B=function(C){return A(C,_)},A=function(C,V){var x,re,N,S,Ve=(1<<l+1)-1;for(re=C.mul(V),N=re.mul(g),N.limbs=N.limbs.slice(0,a.limbs.length),N.limbs.length==a.limbs.length&&(N.limbs[a.limbs.length-1]&=Ve),N=N.mul(e),S=re.add(N).normalize().trim(),S.limbs=S.limbs.slice(a.limbs.length-1),x=0;x<S.limbs.length;x++)x>0&&(S.limbs[x-1]|=(S.limbs[x]&Ve)<<n-l-1),S.limbs[x]=S.limbs[x]>>l+1;return S.greaterEquals(e)&&S.subM(e),S},k=function(C){return A(C,1)};o=B(o),s=B(s);var R,T={},Y=(1<<c-1)-1;for(T[1]=o.copy(),T[2]=A(o,o),R=1;R<=Y;R++)T[2*R+1]=A(T[2*R-1],T[2]);var z=function(C,V){var x=V%C.radix;return(C.limbs[Math.floor(V/C.radix)]&1<<x)>>x};for(t=r.bitLength()-1;t>=0;)if(z(r,t)==0)s=A(s,s),t=t-1;else{for(var te=t-c+1;z(r,te)==0;)te++;var de=0;for(i=te;i<=t;i++)de+=z(r,i)<<i-te,s=A(s,s);s=A(s,T[de]),t=te-1}return k(s)},trim:function(){var r=this.limbs,e;do e=r.pop();while(r.length&&e===0);return r.push(e),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var r=0,e,t=this.placeVal,i=this.ipv,n,s,o=this.limbs,a=o.length,l=this.radixMask;for(e=0;e<a||r!==0&&r!==-1;e++)n=(o[e]||0)+r,s=o[e]=n&l,r=(n-s)*i;return r===-1&&(o[e-1]-=t),this.trim(),this},cnormalize:function(){var r=0,e,t=this.ipv,i,n,s=this.limbs,o=s.length,a=this.radixMask;for(e=0;e<o-1;e++)i=s[e]+r,n=s[e]=i&a,r=(i-n)*t;return s[e]+=r,this},toBits:function(r){this.fullReduce(),r=r||this.exponent||this.bitLength();var e=Math.floor((r-1)/24),t=u.bitArray,i=(r+7&-8)%this.radix||this.radix,n=[t.partial(i,this.getLimb(e))];for(e--;e>=0;e--)n=t.concat(n,[t.partial(Math.min(this.radix,r),this.getLimb(e))]),r-=this.radix;return n},bitLength:function(){this.fullReduce();for(var r=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>>=1)r++;return r+7&-8}};u.bn.fromBits=function(r){var e=this,t=new e,i=[],n=u.bitArray,s=this.prototype,o=Math.min(this.bitLength||4294967296,n.bitLength(r)),a=o%s.radix||s.radix;for(i[0]=n.extract(r,0,a);a<o;a+=s.radix)i.unshift(n.extract(r,a,s.radix));return t.limbs=i,t};u.bn.prototype.ipv=1/(u.bn.prototype.placeVal=Math.pow(2,u.bn.prototype.radix));u.bn.prototype.radixMask=(1<<u.bn.prototype.radix)-1;u.bn.pseudoMersennePrime=function(r,e){function t(a){this.initWith(a)}var i=t.prototype=new u.bn,n,s,o;for(o=i.modOffset=Math.ceil(s=r/i.radix),i.exponent=r,i.offset=[],i.factor=[],i.minOffset=o,i.fullMask=0,i.fullOffset=[],i.fullFactor=[],i.modulus=t.modulus=new u.bn(Math.pow(2,r)),i.fullMask=0|-Math.pow(2,r%i.radix),n=0;n<e.length;n++)i.offset[n]=Math.floor(e[n][0]/i.radix-s),i.fullOffset[n]=Math.floor(e[n][0]/i.radix)-o+1,i.factor[n]=e[n][1]*Math.pow(1/2,r-e[n][0]+i.offset[n]*i.radix),i.fullFactor[n]=e[n][1]*Math.pow(1/2,r-e[n][0]+i.fullOffset[n]*i.radix),i.modulus.addM(new u.bn(Math.pow(2,e[n][0])*e[n][1])),i.minOffset=Math.min(i.minOffset,-i.offset[n]);return i._class=t,i.modulus.cnormalize(),i.reduce=function(){var a,l,c,h=this.modOffset,f=this.limbs,p=this.offset,m=this.offset.length,g=this.factor,v;for(a=this.minOffset;f.length>h;){for(c=f.pop(),v=f.length,l=0;l<m;l++)f[v+p[l]]-=g[l]*c;a--,a||(f.push(0),this.cnormalize(),a=this.minOffset)}return this.cnormalize(),this},i._strongReduce=i.fullMask===-1?i.reduce:function(){var a=this.limbs,l=a.length-1,c,h;if(this.reduce(),l===this.modOffset-1){for(h=a[l]&this.fullMask,a[l]-=h,c=0;c<this.fullOffset.length;c++)a[l+this.fullOffset[c]]-=this.fullFactor[c]*h;this.normalize()}},i.fullReduce=function(){var a,l;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),l=this.limbs.length;l<this.modOffset;l++)this.limbs[l]=0;for(a=this.greaterEquals(this.modulus),l=0;l<this.limbs.length;l++)this.limbs[l]-=this.modulus.limbs[l]*a;return this.cnormalize(),this},i.inverse=function(){return this.power(this.modulus.sub(2))},t.fromBits=u.bn.fromBits,t};var ye=u.bn.pseudoMersennePrime;u.bn.prime={p127:ye(127,[[0,-1]]),p25519:ye(255,[[0,-19]]),p192k:ye(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:ye(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:ye(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:ye(192,[[0,-1],[64,-1]]),p224:ye(224,[[0,1],[96,-1]]),p256:ye(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:ye(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:ye(521,[[0,-1]])};u.bn.random=function(r,e){typeof r!="object"&&(r=new u.bn(r));for(var t,i,n=r.limbs.length,s=r.limbs[n-1]+1,o=new u.bn;;){do t=u.random.randomWords(n,e),t[n-1]<0&&(t[n-1]+=4294967296);while(Math.floor(t[n-1]/s)===Math.floor(4294967296/s));for(t[n-1]%=s,i=0;i<n-1;i++)t[i]&=r.radixMask;if(o.limbs=t,!o.greaterEquals(r))return o}};u.ecc={};u.ecc.point=function(r,e,t){e===void 0?this.isIdentity=!0:(e instanceof u.bn&&(e=new r.field(e)),t instanceof u.bn&&(t=new r.field(t)),this.x=e,this.y=t,this.isIdentity=!1),this.curve=r};u.ecc.point.prototype={toJac:function(){return new u.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(r){return this.toJac().mult(r,this).toAffine()},mult2:function(r,e,t){return this.toJac().mult2(r,this,e,t).toAffine()},multiples:function(){var r,e,t;if(this._multiples===void 0)for(t=this.toJac().doubl(),r=this._multiples=[new u.ecc.point(this.curve),this,t.toAffine()],e=3;e<16;e++)t=t.add(this),r.push(t.toAffine());return this._multiples},negate:function(){var r=new this.curve.field(0).sub(this.y).normalize().reduce();return new u.ecc.point(this.curve,this.x,r)},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return u.bitArray.concat(this.x.toBits(),this.y.toBits())}};u.ecc.pointJac=function(r,e,t,i){e===void 0?this.isIdentity=!0:(this.x=e,this.y=t,this.z=i,this.isIdentity=!1),this.curve=r};u.ecc.pointJac.prototype={add:function(r){var e=this,t,i,n,s,o,a,l,c,h,f,p;if(e.curve!==r.curve)throw new u.exception.invalid("sjcl.ecc.add(): Points must be on the same curve to add them!");return e.isIdentity?r.toJac():r.isIdentity?e:(t=e.z.square(),i=r.x.mul(t).subM(e.x),i.equals(0)?e.y.equals(r.y.mul(t.mul(e.z)))?e.doubl():new u.ecc.pointJac(e.curve):(n=r.y.mul(t.mul(e.z)).subM(e.y),s=i.square(),o=n.square(),a=i.square().mul(i).addM(e.x.add(e.x).mul(s)),l=o.subM(a),c=e.x.mul(s).subM(l).mul(n),h=e.y.mul(i.square().mul(i)),f=c.subM(h),p=e.z.mul(i),new u.ecc.pointJac(this.curve,l,f,p)))},doubl:function(){if(this.isIdentity)return this;var r=this.y.square(),e=r.mul(this.x.mul(4)),t=r.square().mul(8),i=this.z.square(),n=this.curve.a.toString()==new u.bn(-3).toString()?this.x.sub(i).mul(3).mul(this.x.add(i)):this.x.square().mul(3).add(i.square().mul(this.curve.a)),s=n.square().subM(e).subM(e),o=e.sub(s).mul(n).subM(t),a=this.y.add(this.y).mul(this.z);return new u.ecc.pointJac(this.curve,s,o,a)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new u.ecc.point(this.curve);var r=this.z.inverse(),e=r.square();return new u.ecc.point(this.curve,this.x.mul(e).fullReduce(),this.y.mul(e.mul(r)).fullReduce())},mult:function(r,e){typeof r=="number"?r=[r]:r.limbs!==void 0&&(r=r.normalize().limbs);var t,i,n=new u.ecc.point(this.curve).toJac(),s=e.multiples();for(t=r.length-1;t>=0;t--)for(i=u.bn.prototype.radix-4;i>=0;i-=4)n=n.doubl().doubl().doubl().doubl().add(s[r[t]>>i&15]);return n},mult2:function(r,e,t,i){typeof r=="number"?r=[r]:r.limbs!==void 0&&(r=r.normalize().limbs),typeof t=="number"?t=[t]:t.limbs!==void 0&&(t=t.normalize().limbs);var n,s,o=new u.ecc.point(this.curve).toJac(),a=e.multiples(),l=i.multiples(),c,h;for(n=Math.max(r.length,t.length)-1;n>=0;n--)for(c=r[n]|0,h=t[n]|0,s=u.bn.prototype.radix-4;s>=0;s-=4)o=o.doubl().doubl().doubl().doubl().add(a[c>>s&15]).add(l[h>>s&15]);return o},negate:function(){return this.toAffine().negate().toJac()},isValid:function(){var r=this.z.square(),e=r.square(),t=e.mul(r);return this.y.square().equals(this.curve.b.mul(t).add(this.x.mul(this.curve.a.mul(e).add(this.x.square()))))}};u.ecc.curve=function(r,e,t,i,n,s){this.field=r,this.r=new u.bn(e),this.a=new r(t),this.b=new r(i),this.G=new u.ecc.point(this,new r(n),new r(s))};u.ecc.curve.prototype.fromBits=function(r){var e=u.bitArray,t=this.field.prototype.exponent+7&-8,i=new u.ecc.point(this,this.field.fromBits(e.bitSlice(r,0,t)),this.field.fromBits(e.bitSlice(r,t,2*t)));if(!i.isValid())throw new u.exception.corrupt("not on the curve!");return i};u.ecc.curves={c192:new u.ecc.curve(u.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new u.ecc.curve(u.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new u.ecc.curve(u.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new u.ecc.curve(u.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),c521:new u.ecc.curve(u.bn.prime.p521,"0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409",-3,"0x051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","0xC6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","0x11839296A789A3BC0045C8A5FB42C7D1BD998F54449579B446817AFBD17273E662C97EE72995EF42640C550B9013FAD0761353C7086A272C24088BE94769FD16650"),k192:new u.ecc.curve(u.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new u.ecc.curve(u.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new u.ecc.curve(u.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")};u.ecc.curveName=function(r){var e;for(e in u.ecc.curves)if(u.ecc.curves.hasOwnProperty(e)&&u.ecc.curves[e]===r)return e;throw new u.exception.invalid("no such curve")};u.ecc.deserialize=function(r){var e=["elGamal","ecdsa"];if(!r||!r.curve||!u.ecc.curves[r.curve])throw new u.exception.invalid("invalid serialization");if(e.indexOf(r.type)===-1)throw new u.exception.invalid("invalid type");var t=u.ecc.curves[r.curve];if(r.secretKey){if(!r.exponent)throw new u.exception.invalid("invalid exponent");var i=new u.bn(r.exponent);return new u.ecc[r.type].secretKey(t,i)}else{if(!r.point)throw new u.exception.invalid("invalid point");var n=t.fromBits(u.codec.hex.toBits(r.point));return new u.ecc[r.type].publicKey(t,n)}};u.ecc.basicKey={publicKey:function(r,e){this._curve=r,this._curveBitLength=r.r.bitLength(),e instanceof Array?this._point=r.fromBits(e):this._point=e,this.serialize=function(){var t=u.ecc.curveName(r);return{type:this.getType(),secretKey:!1,point:u.codec.hex.fromBits(this._point.toBits()),curve:t}},this.get=function(){var t=this._point.toBits(),i=u.bitArray.bitLength(t),n=u.bitArray.bitSlice(t,0,i/2),s=u.bitArray.bitSlice(t,i/2);return{x:n,y:s}}},secretKey:function(r,e){this._curve=r,this._curveBitLength=r.r.bitLength(),this._exponent=e,this.serialize=function(){var t=this.get(),i=u.ecc.curveName(r);return{type:this.getType(),secretKey:!0,exponent:u.codec.hex.fromBits(t),curve:i}},this.get=function(){return this._exponent.toBits()}}};u.ecc.basicKey.generateKeys=function(r){return function(t,i,n){if(t=t||256,typeof t=="number"&&(t=u.ecc.curves["c"+t],t===void 0))throw new u.exception.invalid("no such curve");n=n||u.bn.random(t.r,i);var s=t.G.mult(n);return{pub:new u.ecc[r].publicKey(t,s),sec:new u.ecc[r].secretKey(t,n)}}};u.ecc.elGamal={generateKeys:u.ecc.basicKey.generateKeys("elGamal"),publicKey:function(r,e){u.ecc.basicKey.publicKey.apply(this,arguments)},secretKey:function(r,e){u.ecc.basicKey.secretKey.apply(this,arguments)}};u.ecc.elGamal.publicKey.prototype={kem:function(r){var e=u.bn.random(this._curve.r,r),t=this._curve.G.mult(e).toBits(),i=u.hash.sha256.hash(this._point.mult(e).toBits());return{key:i,tag:t}},getType:function(){return"elGamal"}};u.ecc.elGamal.secretKey.prototype={unkem:function(r){return u.hash.sha256.hash(this._curve.fromBits(r).mult(this._exponent).toBits())},dh:function(r){return u.hash.sha256.hash(r._point.mult(this._exponent).toBits())},dhJavaEc:function(r){return r._point.mult(this._exponent).x.toBits()},getType:function(){return"elGamal"}};u.ecc.ecdsa={generateKeys:u.ecc.basicKey.generateKeys("ecdsa")};u.ecc.ecdsa.publicKey=function(r,e){u.ecc.basicKey.publicKey.apply(this,arguments)};u.ecc.ecdsa.publicKey.prototype={verify:function(r,e,t){u.bitArray.bitLength(r)>this._curveBitLength&&(r=u.bitArray.clamp(r,this._curveBitLength));var i=u.bitArray,n=this._curve.r,s=this._curveBitLength,o=u.bn.fromBits(i.bitSlice(e,0,s)),a=u.bn.fromBits(i.bitSlice(e,s,2*s)),l=t?a:a.inverseMod(n),c=u.bn.fromBits(r).mul(l).mod(n),h=o.mul(l).mod(n),f=this._curve.G.mult2(c,h,this._point).x;if(o.equals(0)||a.equals(0)||o.greaterEquals(n)||a.greaterEquals(n)||!f.equals(o)){if(t===void 0)return this.verify(r,e,!0);throw new u.exception.corrupt("signature didn't check out")}return!0},getType:function(){return"ecdsa"}};u.ecc.ecdsa.secretKey=function(r,e){u.ecc.basicKey.secretKey.apply(this,arguments)};u.ecc.ecdsa.secretKey.prototype={sign:function(r,e,t,i){u.bitArray.bitLength(r)>this._curveBitLength&&(r=u.bitArray.clamp(r,this._curveBitLength));var n=this._curve.r,s=n.bitLength(),o=i||u.bn.random(n.sub(1),e).add(1),a=this._curve.G.mult(o).x.mod(n),l=u.bn.fromBits(r).add(a.mul(this._exponent)),c=t?l.inverseMod(n).mul(o).mod(n):l.mul(o.inverseMod(n)).mod(n);return u.bitArray.concat(a.toBits(s),c.toBits(s))},getType:function(){return"ecdsa"}};typeof ArrayBuffer>"u"&&(function(r){"use strict";r.ArrayBuffer=function(){},r.DataView=function(){}})(Yr);u.codec.arrayBuffer={fromBits:function(r,e,t){var i,n,s,o,a;if(e=e??!0,t=t||8,r.length===0)return new ArrayBuffer(0);if(s=u.bitArray.bitLength(r)/8,u.bitArray.bitLength(r)%8!==0)throw new u.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(e&&s%t!==0&&(s+=t-s%t),o=new DataView(new ArrayBuffer(r.length*4)),n=0;n<r.length;n++)o.setUint32(n*4,r[n]<<32);if(i=new DataView(new ArrayBuffer(s)),i.byteLength===o.byteLength)return o.buffer;for(a=o.byteLength<i.byteLength?o.byteLength:i.byteLength,n=0;n<a;n++)i.setUint8(n,o.getUint8(n));return i.buffer},toBits:function(r){var e,t=[],i,n,s;if(r.byteLength===0)return[];n=new DataView(r),i=n.byteLength-n.byteLength%4;for(var e=0;e<i;e+=4)t.push(n.getUint32(e));if(n.byteLength%4!=0){s=new DataView(new ArrayBuffer(4));for(var e=0,o=n.byteLength%4;e<o;e++)s.setUint8(e+4-o,n.getUint8(i+e));t.push(u.bitArray.partial(n.byteLength%4*8,s.getUint32(0)))}return t},hexDumpBuffer:function(r){for(var e=new DataView(r),t="",i=function(s,o){return s=s+"",s.length>=o?s:new Array(o-s.length+1).join("0")+s},n=0;n<e.byteLength;n+=2)n%16==0&&(t+=`
`+n.toString(16)+"	"),t+=i(e.getUint16(n).toString(16),4)+" ";typeof console===void 0&&(console=console||{log:function(){}}),console.log(t.toUpperCase())}};Yr.default=u});var as=j(Oe=>{"use strict";var Io=Oe&&Oe.__classPrivateFieldGet||function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},Mo=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},is,ns;Object.defineProperty(Oe,"__esModule",{value:!0});Oe.GroupConsSjcl=void 0;var I=Ye(),U=Mo(rs()),M=$r();function No(r){switch(r){case"SHA-1":return{outLenBytes:20,blockLenBytes:64};case"SHA-256":return{outLenBytes:32,blockLenBytes:64};case"SHA-384":return{outLenBytes:48,blockLenBytes:128};case"SHA-512":return{outLenBytes:64,blockLenBytes:128};default:throw new Error(`invalid hash name: ${r}`)}}async function ss(r,e,t,i){let{outLenBytes:n,blockLenBytes:s}=No(r),o=Math.ceil(i/n);if(o>255)throw new Error("too big");let a=t;if(t.length>255){let v=new TextEncoder,_=(0,I.joinAll)([v.encode("H2C-OVERSIZE-DST-"),t]);a=new Uint8Array(await crypto.subtle.digest(r,_))}a=(0,I.joinAll)([a,new Uint8Array([a.length])]);let l=new Uint8Array(s),c=new Uint8Array(2);c[0]=i>>8&255,c[1]=i&255;let h=(0,I.joinAll)([l,e,c,new Uint8Array([0]),a]),f=new Uint8Array(await crypto.subtle.digest(r,h)),p=(0,I.joinAll)([f,new Uint8Array([1]),a]),m=new Uint8Array(await crypto.subtle.digest(r,p)),g=(0,I.joinAll)([m]);for(let v=2;v<=o;v++){let _=(0,I.joinAll)([(0,I.xor)(m,f),new Uint8Array([v]),a]);m=new Uint8Array(await crypto.subtle.digest(r,_)),g=(0,I.joinAll)([g,m])}return g.slice(0,i)}function ve(r){switch(r){case M.GROUP.P256:return U.default.ecc.curves.c256;case M.GROUP.P384:return U.default.ecc.curves.c384;case M.GROUP.P521:return U.default.ecc.curves.c521;case M.GROUP.DECAF448:case M.GROUP.RISTRETTO255:throw new Error("group: non-supported ciphersuite");default:throw(0,M.errBadGroup)(r)}}var Te=class r{constructor(e,t){this.g=e,this.k=t,this.order=ve(this.g.id).r}static create(e){return new r(e,new U.default.bn(0))}isEqual(e){return this.k.equals(e.k)}isZero(){return this.k.equals(0)}add(e){(0,I.compat)(this,e);let t=this.k.add(e.k).mod(this.order);return t.normalize(),new r(this.g,t)}sub(e){(0,I.compat)(this,e);let t=this.k.sub(e.k).mod(this.order);return t.normalize(),new r(this.g,t)}mul(e){(0,I.compat)(this,e);let t=this.k.mulmod(e.k,this.order);return t.normalize(),new r(this.g,t)}inv(){return new r(this.g,this.k.inverseMod(this.order))}serialize(){let e=this.k.mod(this.order);e.normalize();let t=U.default.codec.arrayBuffer.fromBits(e.toBits(),!1),i=new Uint8Array(t),n=new Uint8Array(this.g.size);return n.set(i,this.g.size-i.length),n}static size(e){return e.size}static deserialize(e,t){(0,I.checkSize)(t,r,e);let i=Array.from(t.subarray(0,e.size)),n=U.default.bn.fromBits(U.default.codec.bytes.toBits(i));if(n.normalize(),n.greaterEquals(ve(e.id).r))throw(0,I.errDeserialization)(r);return new r(e,n)}static async hash(e,t,i){let{hash:n,L:s}=os(e.id),o=await ss(n,t,i,s),a=Array.from(o),l=U.default.codec.bytes.toBits(a),c=U.default.bn.fromBits(l).mod(ve(e.id).r);return new r(e,c)}};function Oo(r){let e=ve(r),t,i;switch(r){case M.GROUP.P256:t=-10,i="0x25ac71c31e27646736870398ae7f554d8472e008b3aa2a49d332cbd81bcc3b80";break;case M.GROUP.P384:t=-12,i="0x2accb4a656b0249c71f0500e83da2fdd7f98e383d68b53871f872fcb9ccb80c53c0de1f8a80f7e1914e2ec69f5a626b3";break;case M.GROUP.P521:t=-4,i="0x2";break;default:throw(0,M.errBadGroup)(r)}let s=e.field.modulus.sub(new U.default.bn(3)).halveM().halveM();return t=new e.field(t),i=new e.field(i),{Z:t,c1:s,c2:i}}function os(r){switch(r){case M.GROUP.P256:return{hash:"SHA-256",L:48};case M.GROUP.P384:return{hash:"SHA-384",L:72};case M.GROUP.P521:return{hash:"SHA-512",L:98};default:throw(0,M.errBadGroup)(r)}}var we=class r{constructor(e,t){this.g=e,this.p=t}static create(e){return new r(e,new U.default.ecc.point(ve(e.id)))}static gen(e){return new r(e,ve(e.id).G)}isIdentity(){return this.p.isIdentity}isEqual(e){if((0,I.compat)(this,e),this.p.isIdentity&&e.p.isIdentity)return!0;if(this.p.isIdentity||e.p.isIdentity)return!1;let{x:t,y:i}=this.p,{x:n,y:s}=e.p;return t.equals(n)&&i.equals(s)}neg(){return this.p.negate()}add(e){return(0,I.compat)(this,e),new r(this.g,this.p.toJac().add(e.p).toAffine())}mul(e){return(0,I.compat)(this,e),new r(this.g,this.p.mult(e.k))}mul2(e,t,i){return(0,I.compat)(this,e),(0,I.compat)(this,i),(0,I.compat)(this,t),new r(this.g,this.p.mult2(e.k,i.k,t.p))}serUnComp(e){let t=U.default.codec.arrayBuffer.fromBits(e.toBits(),!1),i=new Uint8Array(t);if(i.length!==2*this.g.size)throw new Error("error serializing element");let n=new Uint8Array(1+2*this.g.size);return n[0]=4,n.set(i,1),n}serComp(e){let t=new Uint8Array(U.default.codec.arrayBuffer.fromBits(e.x.toBits(null),!1)),i=new Uint8Array(1+this.g.size);return i[0]=2|e.y.getLimb(0)&1,i.set(t,1+this.g.size-t.length),i}serialize(e=!0){if(this.p.isIdentity)return Uint8Array.from([0]);let t=this.p;return t.x.fullReduce(),t.y.fullReduce(),e?this.serComp(t):this.serUnComp(t)}static size(e,t=!0){return 1+(t?e.size:e.size*2)}static deserComp(e,t){let i=Array.from(t.subarray(1)),n=U.default.codec.bytes.toBits(i),s=ve(e.id),o=new s.field(U.default.bn.fromBits(n)),a=s.field.modulus,l=a.add(new U.default.bn(1)).halveM().halveM(),c=o.square().add(s.a).mul(o).add(s.b).power(l);c.fullReduce(),(t[0]&1)!==(c.getLimb(0)&1)&&(c=a.sub(c).mod(a));let h=new U.default.ecc.point(s,new s.field(o),new s.field(c));if(!h.isValid())throw(0,I.errDeserialization)(r);return new r(e,h)}static deserUnComp(e,t){let i=Array.from(t.subarray(1)),n=U.default.codec.bytes.toBits(i),o=ve(e.id).fromBits(n);return o.x.fullReduce(),o.y.fullReduce(),new r(e,o)}static deserialize(e,t){let i=t.length;switch(!0){case(i===1&&t[0]===0):return e.identity();case(i===1+e.size&&(t[0]===2||t[0]===3)):return r.deserComp(e,t);case(i===1+2*e.size&&t[0]===4):return r.deserUnComp(e,t);default:throw(0,I.errDeserialization)(r)}}static async hashToField(e,t,i,n){let s=ve(e.id),{hash:o,L:a}=os(e.id),l=await ss(o,t,i,n*a),c=new Array;for(let h=0;h<n;h++){let f=h*a,p=Array.from(l.slice(f,f+a)),m=U.default.codec.bytes.toBits(p);c.push(new s.field(U.default.bn.fromBits(m)))}return c}static sswu(e,t){let i=ve(e.id),{a:n,b:s}=i,{Z:o,c1:a,c2:l}=Oo(e.id),c=new i.field(0),h=new i.field(1);function f(V){return V.fullReduce(),V.getLimb(0)&1}function p(V,x,re){return re?x:V}function m(V,x){let re=x.square(),N=V.mul(x);re=re.mul(N);let S=re.power(a);S=S.mul(N);let Ve=S.mul(l),si=S.square();si=si.mul(x);let Yi=si.equals(V),Us=p(Ve,S,Yi);return{isQR:Yi,root:Us}}let g=t.square();g=o.mul(g);let v=g.square();v=v.add(g);let _=v.add(h);_=s.mul(_);let B=p(o,c.sub(v),!v.equals(c));B=n.mul(B),v=_.square();let A=B.square(),k=n.mul(A);v=v.add(k),v=v.mul(_),A=A.mul(B),k=s.mul(A),v=v.add(k);let R=g.mul(_),{isQR:T,root:Y}=m(v,A),z=g.mul(t);z=z.mul(Y),R=p(R,_,T),z=p(z,Y,T);let te=f(t)===f(z);z=p(c.sub(z),z,te);let de=B;R=R.mul(de),g=de.square(),g=g.mul(de),z=z.mul(g);let C=new U.default.ecc.pointJac(i,R,z,de).toAffine();if(!C.isValid())throw new Error("point not in curve");return new r(e,C)}static async hash(e,t,i){let n=await r.hashToField(e,t,i,2),s=r.sswu(e,n[0]),o=r.sswu(e,n[1]);return s.add(o)}},Ut=class{static get(e){var t,i;return(t=Io(this,is,"f",ns))[i=`${e}`]??(t[i]=new this(e))}constructor(e){switch(e){case M.GROUP.P256:this.size=32;break;case M.GROUP.P384:this.size=48;break;case M.GROUP.P521:this.size=66;break;default:throw(0,M.errBadGroup)(e)}this.id=e}newScalar(){return Te.create(this)}newElt(){return this.identity()}identity(){return we.create(this)}generator(){return we.gen(this)}mulGen(e){return we.gen(this).mul(e)}randomScalar(){let e=crypto.getRandomValues(new Uint8Array(this.size));return Te.hash(this,e,new Uint8Array)}hashToGroup(e,t){return we.hash(this,e,t)}hashToScalar(e,t){return Te.hash(this,e,t)}get eltDes(){return{size:e=>we.size(this,e),deserialize:e=>we.deserialize(this,e)}}get scalarDes(){return{size:()=>Te.size(this),deserialize:e=>Te.deserialize(this,e)}}desElt(e){return we.deserialize(this,e)}desScalar(e){return Te.deserialize(this,e)}eltSize(e){return we.size(this,e)}scalarSize(){return Te.size(this)}};is=Ut;Ut.supportedGroups=[M.GROUP.P256,M.GROUP.P384,M.GROUP.P521];ns={value:{}};Oe.GroupConsSjcl=Ut});var ls=j(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.CryptoSjcl=void 0;var zo=as();Zr.CryptoSjcl={id:"sjcl",Group:zo.GroupConsSjcl,async hash(r,e){return new Uint8Array(await crypto.subtle.digest(r,e))}}});var cs=j(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.DEFAULT_CRYPTO_PROVIDER=lt.CRYPTO_PROVIDER_ARG_REQUIRED=void 0;var Fo=ls();lt.CRYPTO_PROVIDER_ARG_REQUIRED=!1;lt.DEFAULT_CRYPTO_PROVIDER=Fo.CryptoSjcl});var Jr=j(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.getCrypto=fs;Xe.getGroup=hs;Xe.getSuiteGroup=Ho;Xe.setCryptoProvider=qo;Xe.getCryptoProvider=jo;var Do=at(),us=cs(),Vo=us.CRYPTO_PROVIDER_ARG_REQUIRED,Ui=us.DEFAULT_CRYPTO_PROVIDER;function fs(r){let[e]=r;if(!e&&Vo)throw new Error("Undefined crypto arg");return e??Ui}function hs(r,e){return fs(e).Group.get(r)}function Ho(r,e){return hs((0,Do.getOprfParams)(r)[1],e)}function qo(r){Ui=r}function jo(){return Ui}});var Pt=j(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.DLEQProver=ze.DLEQVerifier=ze.DLEQProof=void 0;var $=Ye(),Mi=Jr(),It={Seed:"Seed-",Challenge:"Challenge",Composite:"Composite",HashToScalar:"HashToScalar-"};async function ds(r,e,t,i,...n){let s=(0,Mi.getCrypto)(n),o=s.Group.get(r.group),a=new TextEncoder,l=e.serialize(),c=(0,$.joinAll)([a.encode(It.Seed),r.dst]),h=(0,$.joinAll)([...(0,$.toU16LenPrefix)(l),...(0,$.toU16LenPrefix)(c)]),f=await s.hash(r.hash,h),p=a.encode(It.Composite),m=(0,$.joinAll)([a.encode(It.HashToScalar),r.dst]),g=o.identity(),v=o.identity(),_=0;for(let[B,A]of t){let k=B.serialize(),R=A.serialize(),T=(0,$.joinAll)([...(0,$.toU16LenPrefix)(f),(0,$.to16bits)(_++),...(0,$.toU16LenPrefix)(k),...(0,$.toU16LenPrefix)(R),p]),Y=await o.hashToScalar(T,m);g=g.add(B.mul(Y)),i||(v=v.add(A.mul(Y)))}return i&&(v=g.mul(i)),{M:g,Z:v}}function ps(r,e,t){let i=new Uint8Array;for(let o of t){let a=o.serialize();i=(0,$.joinAll)([i,...(0,$.toU16LenPrefix)(a)])}let n=new TextEncoder;i=(0,$.joinAll)([i,n.encode(It.Challenge)]);let s=(0,$.joinAll)([n.encode(It.HashToScalar),e.dst]);return r.hashToScalar(i,s)}var Xr=class r{constructor(e,t){this.c=e,this.s=t}isEqual(e){return this.c.isEqual(e.c)&&this.s.isEqual(e.s)}serialize(){return(0,$.joinAll)([this.c.serialize(),this.s.serialize()])}static size(e){return 2*e.scalarSize()}static deserialize(e,t,...i){let n=(0,Mi.getGroup)(e,i);(0,$.checkSize)(t,r,n);let s=n.scalarSize(),o=n.desScalar(t.subarray(0,s)),a=n.desScalar(t.subarray(s,2*s));return new r(o,a)}};ze.DLEQProof=Xr;var Qr=class{constructor(e,...t){this.params=e,this.crypto=(0,Mi.getCrypto)(t),this.group=this.crypto.Group.get(e.group)}verify(e,t,i){return this.verify_batch(e,[t],i)}async verify_batch(e,t,i){let{M:n,Z:s}=await ds(this.params,e[1],t,void 0,this.crypto),o=e[0].mul2(i.s,e[1],i.c),a=n.mul2(i.s,s,i.c),l=await ps(this.group,this.params,[e[1],n,s,o,a]);return i.c.isEqual(l)}};ze.DLEQVerifier=Qr;var Ii=class extends Qr{prove(e,t,i,n){return this.prove_batch(e,t,[i],n)}randomScalar(){return this.group.randomScalar()}async prove_batch(e,t,i,n){let s=n||await this.randomScalar(),{M:o,Z:a}=await ds(this.params,t[1],i,e,this.crypto),l=t[0].mul(s),c=o.mul(s),h=await ps(this.group,this.params,[t[1],o,a,l,c]),f=s.sub(h.mul(e));return new Xr(h,f)}};ze.DLEQProver=Ii});var bs=j(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.POPRFClient=Fe.VOPRFClient=Fe.OPRFClient=void 0;var Qe=at(),gs=Ye(),ms=Pt(),Mt=class extends Qe.Oprf{randomBlinder(){return this.group.randomScalar()}async blind(e){let t=[],i=[];for(let o of e){let a=await this.randomBlinder(),l=await this.group.hashToGroup(o,this.getDST(Qe.Oprf.LABELS.HashToGroupDST));if(l.isIdentity())throw new Error("InvalidInputError");t.push(l.mul(a)),i.push(a)}let n=new Qe.EvaluationRequest(t);return[new Qe.FinalizeData(e,i,n),n]}async doFinalize(e,t,i=new Uint8Array(0)){let n=e.inputs.length;if(e.blinds.length!==n||t.evaluated.length!==n)throw new Error("mismatched lengths");let s=[];for(let o=0;o<n;o++){let a=e.blinds[o].inv(),c=t.evaluated[o].mul(a).serialize();s.push(await this.coreFinalize(e.inputs[o],c,i))}return s}},Ni=class extends Mt{constructor(e,...t){super(Qe.Oprf.Mode.OPRF,e,...t)}finalize(e,t){return super.doFinalize(e,t)}};Fe.OPRFClient=Ni;var Oi=class extends Mt{constructor(e,t,...i){super(Qe.Oprf.Mode.VOPRF,e,...i),this.pubKeyServer=t}async finalize(e,t){if(!t.proof)throw new Error("no proof provided");let i=this.group.desElt(this.pubKeyServer),n=e.inputs.length;if(t.evaluated.length!==n)throw new Error("mismatched lengths");if(!await new ms.DLEQVerifier(this.getDLEQParams(),this.crypto).verify_batch([this.group.generator(),i],(0,gs.zip)(e.evalReq.blinded,t.evaluated),t.proof))throw new Error("proof failed");return super.doFinalize(e,t)}};Fe.VOPRFClient=Oi;var zi=class extends Mt{constructor(e,t,...i){super(Qe.Oprf.Mode.POPRF,e,...i),this.pubKeyServer=t}async pointFromInfo(e){let t=await this.scalarFromInfo(e),i=this.group.mulGen(t),s=this.group.desElt(this.pubKeyServer).add(i);if(s.isIdentity())throw new Error("invalid info");return s}async finalize(e,t,i=new Uint8Array(0)){if(!t.proof)throw new Error("no proof provided");let n=await this.pointFromInfo(i),s=e.inputs.length;if(t.evaluated.length!==s)throw new Error("mismatched lengths");if(!await new ms.DLEQVerifier(this.getDLEQParams(),this.crypto).verify_batch([this.group.generator(),n],(0,gs.zip)(t.evaluated,e.evalReq.blinded),t.proof))throw new Error("proof failed");return super.doFinalize(e,t,i)}};Fe.POPRFClient=zi});var ys=j(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.POPRFServer=De.VOPRFServer=De.OPRFServer=void 0;var Ko=Pt(),Le=at(),Nt=Ye(),Ot=class extends Le.Oprf{constructor(e,t,i,...n){super(e,t,...n),this.prover=new Ko.DLEQProver(this.getDLEQParams(),this.crypto),this.supportsWebCryptoOPRF=!1,this.privateKey=i}doBlindEvaluation(e,t){return this.supportsWebCryptoOPRF?this.blindEvaluateWebCrypto(e,t):Promise.resolve(this.blindEvaluateGroup(e,t))}async blindEvaluateWebCrypto(e,t){let i=await crypto.subtle.importKey("raw",t,{name:"OPRF",namedCurve:this.group.id},!0,["sign"]),n=e.serialize(!0),s=new Uint8Array(await crypto.subtle.sign("OPRF",i,n));return this.group.desElt(s)}blindEvaluateGroup(e,t){return e.mul(this.group.desScalar(t))}async secretFromInfo(e){let t=await this.scalarFromInfo(e),i=this.group.desScalar(this.privateKey),n=t.add(i);if(n.isZero())throw new Error("inverse of zero");let s=n.inv();return[n,s]}async doEvaluate(e,t=new Uint8Array(0)){let i=this.privateKey;if(this.mode===Le.Oprf.Mode.POPRF){let[,o]=await this.secretFromInfo(t);i=o.serialize()}let n=await this.group.hashToGroup(e,this.getDST(Le.Oprf.LABELS.HashToGroupDST));if(n.isIdentity())throw new Error("InvalidInputError");let s=await this.doBlindEvaluation(n,i);return this.coreFinalize(e,s.serialize(!0),t)}},Fi=class extends Ot{constructor(e,t,...i){super(Le.Oprf.Mode.OPRF,e,t,...i)}async blindEvaluate(e){return new Le.Evaluation(this.mode,await Promise.all(e.blinded.map(t=>this.doBlindEvaluation(t,this.privateKey))))}async evaluate(e){return this.doEvaluate(e)}async verifyFinalize(e,t){return(0,Nt.ctEqual)(t,await this.doEvaluate(e))}};De.OPRFServer=Fi;var Di=class extends Ot{constructor(e,t,...i){super(Le.Oprf.Mode.VOPRF,e,t,...i)}async blindEvaluate(e){let t=await Promise.all(e.blinded.map(o=>this.doBlindEvaluation(o,this.privateKey))),i=this.group.desScalar(this.privateKey),n=this.group.mulGen(i),s=await this.prover.prove_batch(i,[this.group.generator(),n],(0,Nt.zip)(e.blinded,t));return new Le.Evaluation(this.mode,t,s)}async evaluate(e){return this.doEvaluate(e)}async verifyFinalize(e,t){return(0,Nt.ctEqual)(t,await this.doEvaluate(e))}};De.VOPRFServer=Di;var Vi=class extends Ot{constructor(e,t,...i){super(Le.Oprf.Mode.POPRF,e,t,...i)}async blindEvaluate(e,t=new Uint8Array(0)){let[i,n]=await this.secretFromInfo(t),s=n.serialize(),o=await Promise.all(e.blinded.map(c=>this.doBlindEvaluation(c,s))),a=this.group.mulGen(i),l=await this.prover.prove_batch(i,[this.group.generator(),a],(0,Nt.zip)(o,e.blinded));return new Le.Evaluation(this.mode,o,l)}async evaluate(e,t=new Uint8Array(0)){return this.doEvaluate(e,t)}async verifyFinalize(e,t,i=new Uint8Array(0)){return(0,Nt.ctEqual)(t,await this.doEvaluate(e,i))}};De.POPRFServer=Vi});var _s=j(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.getKeySizes=$o;Ae.validatePrivateKey=Go;Ae.validatePublicKey=Wo;Ae.randomPrivateKey=vs;Ae.derivePrivateKey=As;Ae.generatePublicKey=qi;Ae.generateKeyPair=Jo;Ae.deriveKeyPair=Yo;var ws=at(),Hi=Ye(),ct=Jr();function $o(r,...e){let t=(0,ct.getSuiteGroup)(r,e);return{Nsk:t.scalarSize(),Npk:t.eltSize(!0)}}function Go(r,e,...t){try{return!(0,ct.getSuiteGroup)(r,t).desScalar(e).isZero()}catch{return!1}}function Wo(r,e,...t){try{return!(0,ct.getSuiteGroup)(r,t).desElt(e).isIdentity()}catch{return!1}}async function vs(r,...e){let t;do t=await(0,ct.getSuiteGroup)(r,e).randomScalar();while(t.isZero());return t.serialize()}async function As(r,e,t,i,...n){let s=(0,ct.getSuiteGroup)(e,n),o=(0,Hi.joinAll)([t,...(0,Hi.toU16LenPrefix)(i)]),a=0,l;do{if(a>255)throw new Error("DeriveKeyPairError");let c=(0,Hi.joinAll)([o,Uint8Array.from([a])]);l=await s.hashToScalar(c,ws.Oprf.getDST(r,e,ws.Oprf.LABELS.DeriveKeyPairDST)),a++}while(l.isZero());return l.serialize()}function qi(r,e,...t){let i=(0,ct.getSuiteGroup)(r,t),n=i.desScalar(e);return i.mulGen(n).serialize(!0)}async function Jo(r,...e){let t=await vs(r,...e),i=qi(r,t,...e);return{privateKey:t,publicKey:i}}async function Yo(r,e,t,i,...n){let s=await As(r,e,t,i,...n),o=qi(e,s,...n);return{privateKey:s,publicKey:o}}});var Es=j(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0})});var xs=j(oe=>{"use strict";var Zo=oe&&oe.__createBinding||(Object.create?(function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}):(function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]})),et=oe&&oe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Zo(e,r,t)};Object.defineProperty(oe,"__esModule",{value:!0});et($r(),oe);et(Pt(),oe);et(at(),oe);et(bs(),oe);et(ys(),oe);et(_s(),oe);et(Es(),oe)});function Vs(r,e,t){var i;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var n=0;n<e.chars.length;++n)e.codes[e.chars[n]]=n}if(!t.loose&&r.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var s=r.length;r[s-1]==="=";)if(--s,!t.loose&&!((r.length-s)*e.bits&7))throw new SyntaxError("Invalid padding");for(var o=new((i=t.out)!=null?i:Uint8Array)(s*e.bits/8|0),a=0,l=0,c=0,h=0;h<s;++h){var f=e.codes[r[h]];if(f===void 0)throw new SyntaxError("Invalid character "+r[h]);l=l<<e.bits|f,a+=e.bits,a>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=e.bits||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Hs(r,e,t){t===void 0&&(t={});for(var i=t,n=i.pad,s=n===void 0?!0:n,o=(1<<e.bits)-1,a="",l=0,c=0,h=0;h<r.length;++h)for(c=c<<8|255&r[h],l+=8;l>e.bits;)l-=e.bits,a+=e.chars[o&c>>l];if(l&&(a+=e.chars[o&c<<e.bits-l]),s)for(;a.length*e.bits&7;)a+="=";return a}var Qi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var pe={parse:function(e,t){return Vs(e,Qi,t)},stringify:function(e,t){return Hs(e,Qi,t)}};function en(r,e){let n="!#$%&'*+\\-\\.^_`|~0-9A-Za-z";e&&(n+="=");let o=`[${n}]`,a="[ \\t]*",l=a,f='"(?:[ \\t\\x21\\x23-\\x5B\\x5D-\\x7E\\x80-\\xFF]|\\\\[ \\t\\x21-\\x7E\\x80-\\xFF])*"',p=o+"+",m=`${p}${l}=${l}(?:${p}|${f})`,v=`${p}(?: +(?:${m}(?:${a},${a}${m})*))?`,_=`(?<skip>${a},${a})?(?<challenge>${v})`,B=new RegExp(_,"y"),A=!0,k=!1,R=[],T;for(;T=B.exec(r);){if(A){if(T.groups?.skip)break;A=!1}let Y=T.groups?.challenge;Y&&R.push(Y),k=r.length===B.lastIndex}return k?R:[]}function ai(r){return en(r,!1)}function li(r){return en(r,!0)}function qs(r,e,t){let i=t?'"':"";return e===null?r:`${r}=${i}${e}${i}`}function ci(r,e,t=!1){if(e===void 0)return r;let i=Object.entries(e).map(([n,s])=>qs(n,s,t)).join(",");return`${r} ${i}`}var E=Xi(tn());function He(r,e){let t=0;if(r.length===1)return r[0];for(let i=r.length-1;i>=0;i--)t+=r[r.length-1-i]*Math.pow(2,e*i);return t}function Ce(r,e,t=-1){let i=t,n=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let l;if(i<0)l=new ArrayBuffer(a),s=a;else{if(i<a)return new ArrayBuffer(0);l=new ArrayBuffer(i),s=i}let c=new Uint8Array(l);for(let h=a-1;h>=0;h--){let f=Math.pow(2,h*e);c[s-h-1]=Math.floor(n/f),n-=c[s-h-1]*f}return l}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Kt(...r){let e=0,t=0;for(let s of r)e+=s.length;let i=new ArrayBuffer(e),n=new Uint8Array(i);for(let s of r)n.set(s,t),t+=s.length;return n}function fi(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,l=r[0]===0&&(r[1]&128)===0;(a||l)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let i=He(t,8),n=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(n);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,He(s,8)-i}function rn(r){let e=r<0?r*-1:r,t=128;for(let i=1;i<8;i++){if(e<=t){if(r<0){let o=t-e,a=Ce(o,8,i),l=new Uint8Array(a);return l[0]|=128,a}let n=Ce(e,8,i),s=new Uint8Array(n);if(s[0]&128){let o=n.slice(0),a=new Uint8Array(o);n=new ArrayBuffer(n.byteLength+1),s=new Uint8Array(n);for(let l=0;l<o.byteLength;l++)s[l+1]=a[l];s[0]=0}return n}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function nn(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),i=new Uint8Array(e);for(let n=0;n<t.length;n++)if(t[n]!==i[n])return!1;return!0}function Z(r,e){let t=r.toString(10);if(e<t.length)return"";let i=e-t.length,n=new Array(i);for(let o=0;o<i;o++)n[o]="0";return n.join("").concat(t)}var ga=Math.log(2);function $t(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function pi(r){let e=0,t=0;for(let n=0;n<r.length;n++){let s=r[n];e+=s.byteLength}let i=new Uint8Array(e);for(let n=0;n<r.length;n++){let s=r[n];i.set(new Uint8Array(s),t),t+=s.byteLength}return i.buffer}function xe(r,e,t,i){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):i<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-i<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var gt=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return pi(this.items)}},dt=[new Uint8Array([1])],sn="0123456789",hi="name",on="valueHexView",Xs="isHexOnly",Qs="idBlock",eo="tagClass",to="tagNumber",ro="isConstructed",io="fromBER",no="toBER",so="local",X="",he=new ArrayBuffer(0),gi=new Uint8Array(0),mt="EndOfContent",ln="OCTET STRING",cn="BIT STRING";function Se(r){var e;return e=class extends r{constructor(...i){var n;super(...i);let s=i[0]||{};this.isHexOnly=(n=s.isHexOnly)!==null&&n!==void 0?n:!1,this.valueHexView=s.valueHex?E.BufferSourceConverter.toUint8Array(s.valueHex):gi}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(i){this.valueHexView=new Uint8Array(i)}fromBER(i,n,s){let o=i instanceof ArrayBuffer?new Uint8Array(i):i;if(!xe(this,o,n,s))return-1;let a=n+s;return this.valueHexView=o.subarray(n,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),n)}toBER(i=!1){return this.isHexOnly?i?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",he)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:E.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var Be=class{constructor({blockLength:e=0,error:t=X,warnings:i=[],valueBeforeDecode:n=gi}={}){this.blockLength=e,this.error=t,this.warnings=i,this.valueBeforeDecodeView=E.BufferSourceConverter.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:E.Convert.ToHex(this.valueBeforeDecodeView)}}};Be.NAME="baseBlock";var G=class extends Be{fromBER(e,t,i){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};G.NAME="valueBlock";var Gt=class extends Se(Be){constructor({idBlock:e={}}={}){var t,i,n,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?E.BufferSourceConverter.toUint8Array(e.valueHex):gi,this.tagClass=(i=e.tagClass)!==null&&i!==void 0?i:-1,this.tagNumber=(n=e.tagNumber)!==null&&n!==void 0?n:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",he}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let n=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,n[0]=t}return n.buffer}if(!this.isHexOnly){let n=Ce(this.tagNumber,7),s=new Uint8Array(n),o=n.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let l=0;l<o-1;l++)a[l+1]=s[l]|128;a[o]=s[o-1]}return a.buffer}let i=new Uint8Array(this.valueHexView.byteLength+1);if(i[0]=t|31,!e){let n=this.valueHexView;for(let s=0;s<n.length-1;s++)i[s+1]=n[s]|128;i[this.valueHexView.byteLength]=n[n.length-1]}return i.buffer}fromBER(e,t,i){let n=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,n,t,i))return-1;let s=n.subarray(t,t+i);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;let a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let l=1,c=this.valueHexView=new Uint8Array(255),h=255;for(;s[l]&128;){if(c[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===h){h+=255;let p=new Uint8Array(h);for(let m=0;m<c.length;m++)p[m]=c[m];c=this.valueHexView=new Uint8Array(h)}}this.blockLength=l+1,c[l-1]=s[l]&127;let f=new Uint8Array(l);for(let p=0;p<l;p++)f[p]=c[p];c=this.valueHexView=new Uint8Array(l),c.set(f),this.blockLength<=9?this.tagNumber=He(c,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Gt.NAME="identificationBlock";var Wt=class extends Be{constructor({lenBlock:e={}}={}){var t,i,n;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(i=e.longFormUsed)!==null&&i!==void 0?i:!1,this.length=(n=e.length)!==null&&n!==void 0?n:0}fromBER(e,t,i){let n=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,n,t,i))return-1;let s=n.subarray(t,t+i);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;let o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;let a=t+1,l=n.subarray(a,a+o);return l[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=He(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,i;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=128),t;if(this.longFormUsed){let n=Ce(this.length,8);if(n.byteLength>127)return this.error="Too big length",he;if(t=new ArrayBuffer(n.byteLength+1),e)return t;let s=new Uint8Array(n);i=new Uint8Array(t),i[0]=n.byteLength|128;for(let o=0;o<n.byteLength;o++)i[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};Wt.NAME="lengthBlock";var w={},K=class extends Be{constructor({name:e=X,optional:t=!1,primitiveSchema:i,...n}={},s){super(n),this.name=e,this.optional=t,i&&(this.primitiveSchema=i),this.idBlock=new Gt(n),this.lenBlock=new Wt(n),this.valueBlock=s?new s(n):new G(n)}fromBER(e,t,i){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}toBER(e,t){let i=t||new gt;t||un(this);let n=this.idBlock.toBER(e);if(i.write(n),this.lenBlock.isIndefiniteForm)i.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,i),i.write(new ArrayBuffer(2));else{let s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;let o=this.lenBlock.toBER(e);i.write(o),i.write(s)}return t?he:i.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():E.Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${E.Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let t=this.toBER(),i=e.toBER();return nn(t,i)}};K.NAME="BaseBlock";function un(r){if(r instanceof w.Constructed)for(let e of r.valueBlock.value)un(e)&&(r.lenBlock.isIndefiniteForm=!0);return!!r.lenBlock.isIndefiniteForm}var Jt=class extends K{constructor({value:e=X,...t}={},i){super(t,i),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,i){let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};Jt.NAME="BaseStringBlock";var Yt=class extends Se(G){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}};Yt.NAME="PrimitiveValueBlock";var fn,Zt=class extends K{constructor(e={}){super(e,Yt),this.idBlock.isConstructed=!1}};fn=Zt;w.Primitive=fn;Zt.NAME="PRIMITIVE";function oo(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function _t(r,e=0,t=r.length){let i=e,n=new K({},G),s=new Be;if(!xe(s,r,e,t))return n.error=s.error,{offset:-1,result:n};if(!r.subarray(e,e+t).length)return n.error="Zero buffer length",{offset:-1,result:n};let a=n.idBlock.fromBER(r,e,t);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),a===-1)return n.error=n.idBlock.error,{offset:-1,result:n};if(e=a,t-=n.idBlock.blockLength,a=n.lenBlock.fromBER(r,e,t),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),a===-1)return n.error=n.lenBlock.error,{offset:-1,result:n};if(e=a,t-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let l=K;switch(n.idBlock.tagClass){case 1:if(n.idBlock.tagNumber>=37&&n.idBlock.isHexOnly===!1)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};l=w.EndOfContent;break;case 1:l=w.Boolean;break;case 2:l=w.Integer;break;case 3:l=w.BitString;break;case 4:l=w.OctetString;break;case 5:l=w.Null;break;case 6:l=w.ObjectIdentifier;break;case 10:l=w.Enumerated;break;case 12:l=w.Utf8String;break;case 13:l=w.RelativeObjectIdentifier;break;case 14:l=w.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:l=w.Sequence;break;case 17:l=w.Set;break;case 18:l=w.NumericString;break;case 19:l=w.PrintableString;break;case 20:l=w.TeletexString;break;case 21:l=w.VideotexString;break;case 22:l=w.IA5String;break;case 23:l=w.UTCTime;break;case 24:l=w.GeneralizedTime;break;case 25:l=w.GraphicString;break;case 26:l=w.VisibleString;break;case 27:l=w.GeneralString;break;case 28:l=w.UniversalString;break;case 29:l=w.CharacterString;break;case 30:l=w.BmpString;break;case 31:l=w.DATE;break;case 32:l=w.TimeOfDay;break;case 33:l=w.DateTime;break;case 34:l=w.Duration;break;default:{let c=n.idBlock.isConstructed?new w.Constructed:new w.Primitive;c.idBlock=n.idBlock,c.lenBlock=n.lenBlock,c.warnings=n.warnings,n=c}}break;default:l=n.idBlock.isConstructed?w.Constructed:w.Primitive}return n=oo(n,l),a=n.fromBER(r,e,n.lenBlock.isIndefiniteForm?t:n.lenBlock.length),n.valueBeforeDecodeView=r.subarray(i,i+n.blockLength),{offset:a,result:n}}function ao(r,e){return r?1:e}var ge=class extends G{constructor({value:e=[],isIndefiniteForm:t=!1,...i}={}){super(i),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,i){let n=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,n,t,i))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+i),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;ao(this.isIndefiniteForm,i)>0;){let o=_t(n,s,i);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,i-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===mt)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===mt?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){let i=t||new gt;for(let n=0;n<this.value.length;n++)this.value[n].toBER(e,i);return t?he:i.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}};ge.NAME="ConstructedValueBlock";var hn,le=class extends K{constructor(e={}){super(e,ge),this.idBlock.isConstructed=!0}fromBER(e,t,i){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){let e=[];for(let i of this.valueBlock.value)e.push(i.toString("ascii").split(`
`).map(n=>`  ${n}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};hn=le;w.Constructed=hn;le.NAME="CONSTRUCTED";var Xt=class extends G{fromBER(e,t,i){return t}toBER(e){return he}};Xt.override="EndOfContentValueBlock";var dn,Qt=class extends K{constructor(e={}){super(e,Xt),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};dn=Qt;w.EndOfContent=dn;Qt.NAME=mt;var pn,it=class extends K{constructor(e={}){super(e,G),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,i){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=i,t+i>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+i}toBER(e,t){let i=new ArrayBuffer(2);if(!e){let n=new Uint8Array(i);n[0]=5,n[1]=0}return t&&t.write(i),i}onAsciiEncoding(){return`${this.constructor.NAME}`}};pn=it;w.Null=pn;it.NAME="NULL";var er=class extends Se(G){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=E.BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,i){let n=E.BufferSourceConverter.toUint8Array(e);return xe(this,n,t,i)?(this.valueHexView=n.subarray(t,t+i),i>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,fi.call(this),this.blockLength=i,t+i):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};er.NAME="BooleanValueBlock";var gn,tr=class extends K{constructor(e={}){super(e,er),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};gn=tr;w.Boolean=gn;tr.NAME="BOOLEAN";var rr=class extends Se(ge){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,i){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,n=ge.prototype.fromBER.call(this,e,t,i),n===-1)return n;for(let s=0;s<this.value.length;s++){let o=this.value[s].constructor.NAME;if(o===mt){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==ln)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,i),this.blockLength=i;return n}toBER(e,t){return this.isConstructed?ge.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};rr.NAME="OctetStringValueBlock";var mn,ir=class r extends K{constructor({idBlock:e={},lenBlock:t={},...i}={}){var n,s;(n=i.isConstructed)!==null&&n!==void 0||(i.isConstructed=!!(!((s=i.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},rr),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,i){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,i===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+i);try{if(s.byteLength){let o=_t(s,0,s.byteLength);o.offset!==-1&&o.offset===i&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,i)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?le.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${E.Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof r&&e.push(t.valueBlock.valueHexView);return E.BufferSourceConverter.concat(e)}};mn=ir;w.OctetString=mn;ir.NAME=ln;var nr=class extends Se(ge){constructor({unusedBits:e=0,isConstructed:t=!1,...i}={}){super(i),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,i){if(!i)return t;let n=-1;if(this.isConstructed){if(n=ge.prototype.fromBER.call(this,e,t,i),n===-1)return n;for(let a of this.value){let l=a.constructor.NAME;if(l===mt){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==cn)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let c=a.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}return n}let s=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,s,t,i))return-1;let o=s.subarray(t,t+i);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=o.subarray(1);try{if(a.byteLength){let l=_t(a,0,a.byteLength);l.offset!==-1&&l.offset===i-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+i}toBER(e,t){if(this.isConstructed)return ge.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return he;let i=new Uint8Array(this.valueHexView.length+1);return i[0]=this.unusedBits,i.set(this.valueHexView,1),i.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};nr.NAME="BitStringValueBlock";var bn,qe=class extends K{constructor({idBlock:e={},lenBlock:t={},...i}={}){var n,s;(n=i.isConstructed)!==null&&n!==void 0||(i.isConstructed=!!(!((s=i.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},nr),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,i){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,i)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return le.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let n of t)e.push(n.toString(2).padStart(8,"0"));let i=e.join("");return`${this.constructor.NAME} : ${i.substring(0,i.length-this.valueBlock.unusedBits)}`}}};bn=qe;w.BitString=bn;qe.NAME=cn;var yn;function lo(r,e){let t=new Uint8Array([0]),i=new Uint8Array(r),n=new Uint8Array(e),s=i.slice(0),o=s.length-1,a=n.slice(0),l=a.length-1,c=0,h=l<o?o:l,f=0;for(let p=h;p>=0;p--,f++)!0===f<a.length?c=s[o-f]+a[l-f]+t[0]:c=s[o-f]+t[0],t[0]=c/10,!0===f>=s.length?s=Kt(new Uint8Array([c%10]),s):s[o-f]=c%10;return t[0]>0&&(s=Kt(t,s)),s}function an(r){if(r>=dt.length)for(let e=dt.length;e<=r;e++){let t=new Uint8Array([0]),i=dt[e-1].slice(0);for(let n=i.length-1;n>=0;n--){let s=new Uint8Array([(i[n]<<1)+t[0]]);t[0]=s[0]/10,i[n]=s[0]%10}t[0]>0&&(i=Kt(t,i)),dt.push(i)}return dt[r]}function co(r,e){let t=0,i=new Uint8Array(r),n=new Uint8Array(e),s=i.slice(0),o=s.length-1,a=n.slice(0),l=a.length-1,c,h=0;for(let f=l;f>=0;f--,h++)c=s[o-h]-a[l-h]-t,!0===c<0?(t=1,s[o-h]=c+10):(t=0,s[o-h]=c);if(t>0)for(let f=o-l+1;f>=0;f--,h++)if(c=s[o-h]-t,c<0)t=1,s[o-h]=c+10;else{t=0,s[o-h]=c;break}return s.slice()}var bt=class extends Se(G){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=fi.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(rn(e))}get valueDec(){return this._valueDec}fromDER(e,t,i,n=0){let s=this.fromBER(e,t,i);if(s===-1)return s;let o=this.valueHexView;return o[0]===0&&(o[1]&128)!==0?this.valueHexView=o.subarray(1):n!==0&&o.length<n&&(n-o.length>1&&(n=o.length+1),this.valueHexView=o.subarray(n-o.length)),s}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let i=new Uint8Array(this.valueHexView.length+1);i[0]=0,i.set(t,1),this.valueHexView=i}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,i){let n=super.fromBER(e,t,i);return n===-1||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),i=0,n,s=this.valueHexView,o="",a=!1;for(let l=s.byteLength-1;l>=0;l--){n=s[l];for(let c=0;c<8;c++)(n&1)===1&&(i===e?(t=co(an(i),t),o="-"):t=lo(t,an(i))),i++,n>>=1}for(let l=0;l<t.length;l++)t[l]&&(a=!0),a&&(o+=sn.charAt(t[l]));return a===!1&&(o+=sn.charAt(0)),o}};yn=bt;bt.NAME="IntegerValueBlock";Object.defineProperty(yn.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var wn,je=class r extends K{constructor(e={}){super(e,bt),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return $t(),BigInt(this.valueBlock.toString())}static fromBigInt(e){$t();let t=BigInt(e),i=new gt,n=t.toString(16).replace(/^-/,""),s=new Uint8Array(E.Convert.FromHex(n));if(t<0){let a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;let c=BigInt(`0x${E.Convert.ToHex(a)}`)+t,h=E.BufferSourceConverter.toUint8Array(E.Convert.FromHex(c.toString(16)));h[0]|=128,i.write(h)}else s[0]&128&&i.write(new Uint8Array([0])),i.write(s);return new r({valueHex:i.final()})}convertToDER(){let e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new r({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};wn=je;w.Integer=wn;je.NAME="INTEGER";var vn,sr=class extends je{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};vn=sr;w.Enumerated=vn;sr.NAME="ENUMERATED";var yt=class extends Se(G){constructor({valueDec:e=-1,isFirstSid:t=!1,...i}={}){super(i),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,i){if(!i)return t;let n=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,n,t,i))return-1;let s=n.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=s[a]&127,this.blockLength++,(s[a]&128)!==0);a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=He(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){$t();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let i=new Uint8Array(t.length/7);for(let n=0;n<i.length;n++)i[n]=parseInt(t.slice(n*7,n*7+7),2)+(n+1<i.length?128:0);this.fromBER(i.buffer,0,i.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=n[o]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}let t=Ce(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",he;let i=new Uint8Array(t.byteLength);if(!e){let n=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)i[o]=n[o]|128;i[s]=n[s]}return i}toString(){let e="";if(this.isHexOnly)e=E.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};yt.NAME="sidBlock";var or=class extends G{constructor({value:e=X,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let n=t;for(;i>0;){let s=new yt;if(n=s.fromBER(e,n,i),n===-1)return this.blockLength=0,this.error=s.error,n;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,i-=s.blockLength,this.value.push(s)}return n}toBER(e){let t=[];for(let i=0;i<this.value.length;i++){let n=this.value[i].toBER(e);if(n.byteLength===0)return this.error=this.value[i].error,he;t.push(n)}return pi(t)}fromString(e){this.value=[];let t=0,i=0,n="",s=!1;do if(i=e.indexOf(".",t),i===-1?n=e.substring(t):n=e.substring(t,i),t=i+1,s){let o=this.value[0],a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let l=parseInt(n,10);if(isNaN(l))return;o.valueDec=l+a,s=!1}else{let o=new yt;if(n>Number.MAX_SAFE_INTEGER){$t();let a=BigInt(n);o.valueBigInt=a}else if(o.valueDec=parseInt(n,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(i!==-1)}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let n=this.value[i].toString();i!==0&&(e=`${e}.`),t?(n=`{${n}}`,this.value[i].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};or.NAME="ObjectIdentifierValueBlock";var An,me=class extends K{constructor(e={}){super(e,or),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};An=me;w.ObjectIdentifier=An;me.NAME="OBJECT IDENTIFIER";var wt=class extends Se(Be){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,i){if(i===0)return t;let n=E.BufferSourceConverter.toUint8Array(e);if(!xe(this,n,t,i))return-1;let s=n.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=s[a]&127,this.blockLength++,(s[a]&128)!==0);a++);let o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=He(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=n[o]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}let t=Ce(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",he;let i=new Uint8Array(t.byteLength);if(!e){let n=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)i[o]=n[o]|128;i[s]=n[s]}return i.buffer}toString(){let e="";return this.isHexOnly?e=E.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};wt.NAME="relativeSidBlock";var ar=class extends G{constructor({value:e=X,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let n=t;for(;i>0;){let s=new wt;if(n=s.fromBER(e,n,i),n===-1)return this.blockLength=0,this.error=s.error,n;this.blockLength+=s.blockLength,i-=s.blockLength,this.value.push(s)}return n}toBER(e,t){let i=[];for(let n=0;n<this.value.length;n++){let s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,he;i.push(s)}return pi(i)}fromString(e){this.value=[];let t=0,i=0,n="";do{i=e.indexOf(".",t),i===-1?n=e.substring(t):n=e.substring(t,i),t=i+1;let s=new wt;if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(i!==-1);return!0}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let n=this.value[i].toString();i!==0&&(e=`${e}.`),t&&(n=`{${n}}`),e+=n}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};ar.NAME="RelativeObjectIdentifierValueBlock";var _n,lr=class extends K{constructor(e={}){super(e,ar),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};_n=lr;w.RelativeObjectIdentifier=_n;lr.NAME="RelativeObjectIdentifier";var Bn,H=class extends le{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Bn=H;w.Sequence=Bn;H.NAME="SEQUENCE";var En,cr=class extends le{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};En=cr;w.Set=En;cr.NAME="SET";var ur=class extends Se(G){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=X}toJSON(){return{...super.toJSON(),value:this.value}}};ur.NAME="StringValueBlock";var fr=class extends ur{};fr.NAME="SimpleStringValueBlock";var W=class extends Jt{constructor({...e}={}){super(e,fr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,E.BufferSourceConverter.toUint8Array(e))}fromString(e){let t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=e.charCodeAt(n);this.valueBlock.value=e}};W.NAME="SIMPLE STRING";var hr=class extends W{fromBuffer(e){this.valueBlock.valueHexView=E.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=E.Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=E.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(E.Convert.FromUtf8String(e)),this.valueBlock.value=e}};hr.NAME="Utf8StringValueBlock";var xn,Ee=class extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};xn=Ee;w.Utf8String=xn;Ee.NAME="UTF8String";var dr=class extends W{fromBuffer(e){this.valueBlock.value=E.Convert.ToUtf16String(e),this.valueBlock.valueHexView=E.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(E.Convert.FromUtf16String(e))}};dr.NAME="BmpStringValueBlock";var Sn,pr=class extends dr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Sn=pr;w.BmpString=Sn;pr.NAME="BMPString";var gr=class extends W{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),i=new Uint8Array(t);for(let n=0;n<i.length;n+=4)i[n]=i[n+3],i[n+1]=i[n+2],i[n+2]=0,i[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let n=0;n<t;n++){let s=Ce(e.charCodeAt(n),8),o=new Uint8Array(s);if(o.length>4)continue;let a=4-o.length;for(let l=o.length-1;l>=0;l--)i[n*4+l+a]=o[l]}this.valueBlock.value=e}};gr.NAME="UniversalStringValueBlock";var kn,mr=class extends gr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};kn=mr;w.UniversalString=kn;mr.NAME="UniversalString";var Rn,br=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};Rn=br;w.NumericString=Rn;br.NAME="NumericString";var Tn,yr=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};Tn=yr;w.PrintableString=Tn;yr.NAME="PrintableString";var Ln,wr=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};Ln=wr;w.TeletexString=Ln;wr.NAME="TeletexString";var Cn,vr=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};Cn=vr;w.VideotexString=Cn;vr.NAME="VideotexString";var Pn,Ar=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};Pn=Ar;w.IA5String=Pn;Ar.NAME="IA5String";var Un,_r=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};Un=_r;w.GraphicString=Un;_r.NAME="GraphicString";var In,vt=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};In=vt;w.VisibleString=In;vt.NAME="VisibleString";var Mn,Br=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};Mn=Br;w.GeneralString=Mn;Br.NAME="GeneralString";var Nn,Er=class extends W{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};Nn=Er;w.CharacterString=Nn;Er.NAME="CharacterString";var On,At=class extends vt{constructor({value:e,valueDate:t,...i}={}){if(super(i),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let n=0;n<e.length;n++)this.valueBlock.valueHexView[n]=e.charCodeAt(n)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,E.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let i=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(i===null){this.error="Wrong input string for conversion";return}let n=parseInt(i[1],10);n>=50?this.year=1900+n:this.year=2e3+n,this.month=parseInt(i[2],10),this.day=parseInt(i[3],10),this.hour=parseInt(i[4],10),this.minute=parseInt(i[5],10),this.second=parseInt(i[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=Z(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Z(this.month,2),t[2]=Z(this.day,2),t[3]=Z(this.hour,2),t[4]=Z(this.minute,2),t[5]=Z(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};On=At;w.UTCTime=On;At.NAME="UTCTime";var zn,xr=class extends At{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t=!1,i="",n="",s=0,o,a=0,l=0;if(e[e.length-1]==="Z")i=e.substring(0,e.length-1),t=!0;else{let f=new Number(e[e.length-1]);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");i=e}if(t){if(i.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(i.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let f=1,p=i.indexOf("+"),m="";if(p===-1&&(p=i.indexOf("-"),f=-1),p!==-1){if(m=i.substring(p+1),i=i.substring(0,p),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let g=parseInt(m.substring(0,2),10);if(isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");if(a=f*g,m.length===4){if(g=parseInt(m.substring(2,4),10),isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");l=f*g}}}let c=i.indexOf(".");if(c===-1&&(c=i.indexOf(",")),c!==-1){let f=new Number(`0${i.substring(c)}`);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");s=f.valueOf(),n=i.substring(0,c)}else n=i;switch(!0){case n.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,c!==-1)throw new Error("Wrong input string for conversion");break;case n.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let f=60*s;this.minute=Math.floor(f),f=60*(f-this.minute),this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case n.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let f=60*s;this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case n.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let f=1e3*s;this.millisecond=Math.floor(f)}break;default:throw new Error("Wrong input string for conversion")}let h=o.exec(n);if(h===null)throw new Error("Wrong input string for conversion");for(let f=1;f<h.length;f++)switch(f){case 1:this.year=parseInt(h[f],10);break;case 2:this.month=parseInt(h[f],10);break;case 3:this.day=parseInt(h[f],10);break;case 4:this.hour=parseInt(h[f],10)+a;break;case 5:this.minute=parseInt(h[f],10)+l;break;case 6:this.second=parseInt(h[f],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let f=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=f.getUTCFullYear(),this.month=f.getUTCMonth(),this.day=f.getUTCDay(),this.hour=f.getUTCHours(),this.minute=f.getUTCMinutes(),this.second=f.getUTCSeconds(),this.millisecond=f.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(Z(this.year,4)),t.push(Z(this.month,2)),t.push(Z(this.day,2)),t.push(Z(this.hour,2)),t.push(Z(this.minute,2)),t.push(Z(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Z(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};zn=xr;w.GeneralizedTime=zn;xr.NAME="GeneralizedTime";var Fn,Sr=class extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};Fn=Sr;w.DATE=Fn;Sr.NAME="DATE";var Dn,kr=class extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};Dn=kr;w.TimeOfDay=Dn;kr.NAME="TimeOfDay";var Vn,Rr=class extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};Vn=Rr;w.DateTime=Vn;Rr.NAME="DateTime";var Hn,Tr=class extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};Hn=Tr;w.Duration=Hn;Tr.NAME="Duration";var qn,Lr=class extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};qn=Lr;w.TIME=qn;Lr.NAME="TIME";var nt=class{constructor({name:e=X,optional:t=!1}={}){this.name=e,this.optional=t}},di=class extends nt{constructor({value:e=[],...t}={}){super(t),this.value=e}},Cr=class extends nt{constructor({value:e=new nt,local:t=!1,...i}={}){super(i),this.value=e,this.local=t}};function pt(r,e,t){if(t instanceof di){for(let s=0;s<t.value.length;s++)if(pt(r,e,t.value[s]).verified)return{verified:!0,result:r};{let s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(hi)&&(s.name=t.name),s}}if(t instanceof nt)return t.hasOwnProperty(hi)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Qs in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(io in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(no in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.toBER(!1);if(i.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(i,0,i.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(eo)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(to)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(ro)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(Xs in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(on in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&(r[t.name]=e)),t instanceof w.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof Cr&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let l=!0;for(let c=0;c<t.valueBlock.value.length;c++)l=l&&(t.valueBlock.value[c].optional||!1);return l?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let l=0;l<a;l++)if(l-s>=e.valueBlock.value.length){if(t.valueBlock.value[l].optional===!1){let c={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&(delete r[t.name],c.name=t.name)),c}}else if(t.valueBlock.value[0]instanceof Cr){if(o=pt(r,e.valueBlock.value[l],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&delete r[t.name]),o;if(hi in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let c={};so in t.valueBlock.value[0]&&t.valueBlock.value[0].local?c=e:c=r,typeof c[t.valueBlock.value[0].name]>"u"&&(c[t.valueBlock.value[0].name]=[]),c[t.valueBlock.value[0].name].push(e.valueBlock.value[l])}}else if(o=pt(r,e.valueBlock.value[l-s],t.valueBlock.value[l]),o.verified===!1)if(t.valueBlock.value[l].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&delete r[t.name]),o;if(o.verified===!1){let l={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&(delete r[t.name],l.name=t.name)),l}return{verified:!0,result:r}}if(t.primitiveSchema&&on in e.valueBlock){let s=_t(e.valueBlock.valueHexView);if(s.offset===-1){let o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,X),t.name&&(delete r[t.name],o.name=t.name)),o}return pt(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function mi(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=_t(E.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:pt(t.result,t.result,e)}function Pr(r){let e="1.2.840.113549.1.1.1",t=new H({value:[new H({name:"algorithm"}),new qe({name:"subjectPublicKey"})]}),i=mi(r,t);if(!i.verified)throw new Error("bad parsing RSA-PSS key");let n=new H({value:[new H({value:[new me({value:e}),new it]}),i.result.subjectPublicKey]});return new Uint8Array(n.toBER())}function fo(){let r="1.2.840.113549.1.1.10",e=new H({value:[new le({idBlock:{tagClass:3,tagNumber:0},value:[new H({value:[new me({value:"2.16.840.1.101.3.4.2.2"})]})]}),new le({idBlock:{tagClass:3,tagNumber:1},value:[new H({value:[new me({value:"1.2.840.113549.1.1.8"}),new H({value:[new me({value:"2.16.840.1.101.3.4.2.2"})]})]})]}),new le({idBlock:{tagClass:3,tagNumber:2},value:[new je({value:48})]})]});return new H({value:[new me({value:r}),e]})}function Ur(r){let e=new H({value:[new H({name:"algorithm"}),new qe({name:"subjectPublicKey"})]}),t=mi(r,e);if(!t.verified)throw new Error("bad parsing EncRSA key");let i=fo(),n=new H({value:[i,t.result.subjectPublicKey]});return new Uint8Array(n.toBER())}function J(r){let e=0;for(let s of r)e+=s.byteLength;let t=new ArrayBuffer(e),i=new Uint8Array(t),n=0;for(let s of r)i.set(new Uint8Array(s),n),n+=s.byteLength;return t}var bi=65535,st="PrivateToken",Bt=class Bt{constructor(e,t,i,n){b(this,"tokenType");b(this,"issuerName");b(this,"redemptionContext");b(this,"originInfo");this.tokenType=e,this.issuerName=t,this.redemptionContext=i,this.originInfo=n;let s=65535;if(t.length>s)throw new Error("invalid issuer name size");if(n&&n.join(",").length>s)throw new Error("invalid origin info size");if(!Bt.REDEMPTION_CONTEXT_LENGTH.includes(i.length))throw new Error("invalid redemptionContext size")}static deserialize(e){let t=0,i=new DataView(e.buffer),n=i.getUint16(t);t+=2;let s=i.getUint16(t);t+=2;let o=i.buffer.slice(t,t+s);t+=s;let a=new TextDecoder,l=a.decode(o);s=i.getUint8(t),t+=1;let c=new Uint8Array(i.buffer.slice(t,t+s));t+=s,s=i.getUint16(t),t+=2;let h;if(s>0){let f=i.buffer.slice(t,t+s);h=a.decode(f).split(",")}return new Bt(n,l,c,h)}serialize(){let e=new Array,t=new ArrayBuffer(2);new DataView(t).setUint16(0,this.tokenType),e.push(t);let i=new TextEncoder,n=i.encode(this.issuerName);t=new ArrayBuffer(2),new DataView(t).setUint16(0,n.length),e.push(t),t=n.buffer,e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.redemptionContext.length),e.push(t),t=this.redemptionContext.buffer,e.push(t),t=new ArrayBuffer(2);let s=new Uint8Array(0);if(this.originInfo){let o=this.originInfo.join(",");s=i.encode(o)}return new DataView(t).setUint16(0,s.length),e.push(t),t=s.buffer,e.push(t),new Uint8Array(J(e))}};b(Bt,"REDEMPTION_CONTEXT_LENGTH",[0,32]);var Ke=Bt,ke=class ke{constructor(e,t,i,n,s){b(this,"tokenType");b(this,"nonce");b(this,"challengeDigest");b(this,"tokenKeyId");if(this.tokenType=t,this.nonce=i,this.challengeDigest=n,this.tokenKeyId=s,t!==e.value)throw new Error("mismatch of token type");if(i.length!==ke.NONCE_LENGTH)throw new Error("invalid nonce size");if(n.length!==ke.CHALLENGE_LENGTH)throw new Error("invalid challenge size");if(s.length!==e.Nid)throw new Error("invalid tokenKeyId size");this.tokenType=e.value}static deserialize(e,t,i){let n=0,s=new DataView(t.buffer),o=s.getUint16(n);n+=2;let a=ke.NONCE_LENGTH,l=new Uint8Array(s.buffer.slice(n,n+a));n+=a,a=ke.CHALLENGE_LENGTH;let c=new Uint8Array(s.buffer.slice(n,n+a));n+=a,a=e.Nid;let h=new Uint8Array(s.buffer.slice(n,n+a));return n+=a,i.bytesRead=n,new ke(e,o,l,c,h)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=this.nonce.buffer,e.push(t),t=this.challengeDigest.buffer,e.push(t),t=this.tokenKeyId.buffer,e.push(t),new Uint8Array(J(e))}};b(ke,"NONCE_LENGTH",32),b(ke,"CHALLENGE_LENGTH",32);var $e=ke,Ge=class r{constructor(e,t,i){b(this,"authInput");b(this,"authenticator");if(this.authInput=t,this.authenticator=i,i.length!==e.Nk)throw new Error("invalid authenticator size")}static deserialize(e,t){let i=0,n=new DataView(t.buffer),s={bytesRead:0},o=$e.deserialize(e,t,s);i+=s.bytesRead;let a=e.Nk,l=new Uint8Array(n.buffer.slice(i,i+a));return i+=a,new r(e,o,l)}serialize(){return new Uint8Array(J([this.authInput.serialize().buffer,this.authenticator.buffer]))}},Et=class Et{constructor(e,t){b(this,"extensionType");b(this,"extensionData");if(this.extensionType=e,this.extensionData=t,e<0||e>bi||!Number.isInteger(e))throw new Error("invalid value for extension type, MUST be an integer between 0 and 2^16-1");if(t.length>Et.MAX_EXTENSION_DATA_LENGTH)throw new Error("invalid extension data size. Max size is 2^16-4-1.")}static deserialize(e,t){let i=0,n=new DataView(e.buffer,e.byteOffset,e.length),s=n.getUint16(i);i+=2;let o=n.getUint16(i);i+=2;let a=e.slice(i,i+o);return i+=o,t.bytesRead=i,new Et(s,a)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.extensionType),e.push(t),t=new ArrayBuffer(2),new DataView(t).setUint16(0,this.extensionData.length),e.push(t),t=this.extensionData.buffer,e.push(t),new Uint8Array(J(e))}};b(Et,"MAX_EXTENSION_DATA_LENGTH",bi-4);var yi=Et,xt=class r{constructor(e){b(this,"extensions");this.extensions=e;let t=-1;for(let i of e){if(i.extensionType<t)throw new Error("extensions must be sorted by extension type");t=i.extensionType}}static deserialize(e){let t=0,n=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(t);t+=2;let s=e.subarray(t,t+n),o=0,a=new Array;for(;o<n;){let l={bytesRead:0},c=yi.deserialize(s.subarray(o),l);a.push(c),o+=l.bytesRead}if(o<n)throw new Error(`there are ${n-o} remaining bytes unread`);return new r(a)}serialize(){let e=new Array,t=0;for(let n of this.extensions){let s=n.serialize();t+=s.length,e.push(s)}if(t>bi)throw new Error("Extensions length MUST be less or equal to 2^16-1.");let i=new ArrayBuffer(2);return new DataView(i).setUint16(0,t),new Uint8Array(J([i,...e]))}},Ir=class r{constructor(e,t,i){b(this,"challenge");b(this,"tokenKey");b(this,"maxAge");this.challenge=e,this.tokenKey=t,this.maxAge=i}static parseSingle(e){let t=e.split(","),i,n,s,o;for(let a of t){let l=a.indexOf("="),c=a.substring(0,l),h=a.substring(l+1);switch(h=h.replaceAll('"',""),c=c.trim(),h=h.trim(),c){case"challenge":n=pe.parse(h),i=Ke.deserialize(n);break;case"token-key":s=pe.parse(h);break;case"max-age":o=parseInt(h);break}}if(i===void 0||n===void 0||s===void 0)throw new Error("cannot parse PrivateToken");return new r(i,s,o)}static parseInternal(e,t){let i=t(e),n=new Array;for(let s of i){if(!s.startsWith(`${st} `))continue;let o=s.slice(`${st} `.length),a=r.parseSingle(o);n.push(a)}return n}static parse(e){let t=this.parseInternal(e,ai);return t.length!==0?t:this.parseInternal(e,li)}toString(e=!1){let t={challenge:pe.stringify(this.challenge.serialize()),"token-key":pe.stringify(this.tokenKey)};return this.maxAge&&(t["max-age"]=this.maxAge),ci(st,t,e)}},Mr=class r{constructor(e,t){b(this,"token");b(this,"extensions");this.token=e,this.extensions=t}static parseSingle(e,t){let i=t.split(","),n,s;for(let o of i){let a=o.indexOf("="),l=o.substring(0,a),c=o.substring(a+1);switch(c=c.replaceAll('"',""),l=l.trim(),c=c.trim(),l){case"token":{let h=pe.parse(c);n=Ge.deserialize(e,h);break}case"extensions":{if(e.publicMetadata){let h=pe.parse(c);s=xt.deserialize(h)}break}}}if(n===void 0)throw new Error("cannot parse token");return new r(n,s)}static parseInternal(e,t,i){let n=i(t),s=new Array;for(let o of n){if(!o.startsWith(`${st} `))continue;let a=o.slice(`${st} `.length),l=r.parseSingle(e,a);s.push(l)}return s}static parse(e,t){let i=this.parseInternal(e,t,ai);return i.length!==0?i:this.parseInternal(e,t,li)}toString(e=!1){let t=pe.stringify(this.token.serialize());return ci(st,{token:t},e)}};var Yn={};oi(Yn,{BLIND_RSA:()=>se,BlindRSAMode:()=>Me,Client:()=>Rt,ClientWithMetadata:()=>xi,ExtendedTokenRequest:()=>Hr,Issuer:()=>kt,IssuerWithMetadata:()=>Ei,Origin:()=>Si,OriginWithMetadata:()=>ki,PARTIALLY_BLIND_RSA:()=>ue,PartiallyBlindRSAMode:()=>Bi,TokenRequest:()=>We,TokenResponse:()=>Je,getPublicKeyBytes:()=>Wn});var d={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(r){this.toString=function(){return"CORRUPT: "+this.message},this.message=r},invalid:function(r){this.toString=function(){return"INVALID: "+this.message},this.message=r},bug:function(r){this.toString=function(){return"BUG: "+this.message},this.message=r},notReady:function(r){this.toString=function(){return"NOT READY: "+this.message},this.message=r}}};d.cipher.aes=function(r){this._tables[0][0][0]||this._precompute();var e,t,i,n,s,o=this._tables[0][4],a=this._tables[1],l=r.length,c=1;if(l!==4&&l!==6&&l!==8)throw new d.exception.invalid("invalid aes key size");for(this._key=[n=r.slice(0),s=[]],e=l;e<4*l+28;e++)i=n[e-1],(e%l===0||l===8&&e%l===4)&&(i=o[i>>>24]<<24^o[i>>16&255]<<16^o[i>>8&255]<<8^o[i&255],e%l===0&&(i=i<<8^i>>>24^c<<24,c=c<<1^(c>>7)*283)),n[e]=n[e-l]^i;for(t=0;e;t++,e--)i=n[t&3?e:e-4],e<=4||t<4?s[t]=i:s[t]=a[0][o[i>>>24]]^a[1][o[i>>16&255]]^a[2][o[i>>8&255]]^a[3][o[i&255]]};d.cipher.aes.prototype={encrypt:function(r){return this._crypt(r,0)},decrypt:function(r){return this._crypt(r,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var r=this._tables[0],e=this._tables[1],t=r[4],i=e[4],n,s,o,a=[],l=[],c,h,f,p,m,g;for(n=0;n<256;n++)l[(a[n]=n<<1^(n>>7)*283)^n]=n;for(s=o=0;!t[s];s^=c||1,o=l[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^p&255^99,t[s]=p,i[p]=s,f=a[h=a[c=a[s]]],g=f*16843009^h*65537^c*257^s*16843008,m=a[p]*257^p*16843008,n=0;n<4;n++)r[n][s]=m=m<<24^m>>>8,e[n][p]=g=g<<24^g>>>8;for(n=0;n<5;n++)r[n]=r[n].slice(0),e[n]=e[n].slice(0)},_crypt:function(r,e){if(r.length!==4)throw new d.exception.invalid("invalid aes block size");var t=this._key[e],i=r[0]^t[0],n=r[e?3:1]^t[1],s=r[2]^t[2],o=r[e?1:3]^t[3],a,l,c,h=t.length/4-2,f,p=4,m=[0,0,0,0],g=this._tables[e],v=g[0],_=g[1],B=g[2],A=g[3],k=g[4];for(f=0;f<h;f++)a=v[i>>>24]^_[n>>16&255]^B[s>>8&255]^A[o&255]^t[p],l=v[n>>>24]^_[s>>16&255]^B[o>>8&255]^A[i&255]^t[p+1],c=v[s>>>24]^_[o>>16&255]^B[i>>8&255]^A[n&255]^t[p+2],o=v[o>>>24]^_[i>>16&255]^B[n>>8&255]^A[s&255]^t[p+3],p+=4,i=a,n=l,s=c;for(f=0;f<4;f++)m[e?3&-f:f]=k[i>>>24]<<24^k[n>>16&255]<<16^k[s>>8&255]<<8^k[o&255]^t[p++],a=i,i=n,n=s,s=o,o=a;return m}};d.bitArray={bitSlice:function(r,e,t){return r=d.bitArray._shiftRight(r.slice(e/32),32-(e&31)).slice(1),t===void 0?r:d.bitArray.clamp(r,t-e)},extract:function(r,e,t){var i,n=Math.floor(-e-t&31);return(e+t-1^e)&-32?i=r[e/32|0]<<32-n^r[e/32+1|0]>>>n:i=r[e/32|0]>>>n,i&(1<<t)-1},concat:function(r,e){if(r.length===0||e.length===0)return r.concat(e);var t=r[r.length-1],i=d.bitArray.getPartial(t);return i===32?r.concat(e):d.bitArray._shiftRight(e,i,t|0,r.slice(0,r.length-1))},bitLength:function(r){var e=r.length,t;return e===0?0:(t=r[e-1],(e-1)*32+d.bitArray.getPartial(t))},clamp:function(r,e){if(r.length*32<e)return r;r=r.slice(0,Math.ceil(e/32));var t=r.length;return e=e&31,t>0&&e&&(r[t-1]=d.bitArray.partial(e,r[t-1]&2147483648>>e-1,1)),r},partial:function(r,e,t){return r===32?e:(t?e|0:e<<32-r)+r*1099511627776},getPartial:function(r){return Math.round(r/1099511627776)||32},equal:function(r,e){if(d.bitArray.bitLength(r)!==d.bitArray.bitLength(e))return!1;var t=0,i;for(i=0;i<r.length;i++)t|=r[i]^e[i];return t===0},_shiftRight:function(r,e,t,i){var n,s=0,o;for(i===void 0&&(i=[]);e>=32;e-=32)i.push(t),t=0;if(e===0)return i.concat(r);for(n=0;n<r.length;n++)i.push(t|r[n]>>>e),t=r[n]<<32-e;return s=r.length?r[r.length-1]:0,o=d.bitArray.getPartial(s),i.push(d.bitArray.partial(e+o&31,e+o>32?t:i.pop(),1)),i},_xor4:function(r,e){return[r[0]^e[0],r[1]^e[1],r[2]^e[2],r[3]^e[3]]},byteswapM:function(r){var e,t,i=65280;for(e=0;e<r.length;++e)t=r[e],r[e]=t>>>24|t>>>8&i|(t&i)<<8|t<<24;return r}};d.codec.utf8String={fromBits:function(r){var e="",t=d.bitArray.bitLength(r),i,n;for(i=0;i<t/8;i++)(i&3)===0&&(n=r[i/4]),e+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(e))},toBits:function(r){r=unescape(encodeURIComponent(r));var e=[],t,i=0;for(t=0;t<r.length;t++)i=i<<8|r.charCodeAt(t),(t&3)===3&&(e.push(i),i=0);return t&3&&e.push(d.bitArray.partial(8*(t&3),i)),e}};d.codec.hex={fromBits:function(r){var e="",t;for(t=0;t<r.length;t++)e+=((r[t]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,d.bitArray.bitLength(r)/4)},toBits:function(r){var e,t=[],i;for(r=r.replace(/\s|0x/g,""),i=r.length,r=r+"00000000",e=0;e<r.length;e+=8)t.push(parseInt(r.substr(e,8),16)^0);return d.bitArray.clamp(t,i*4)}};d.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(r,e,t){var i="",n,s=0,o=d.codec.base64._chars,a=0,l=d.bitArray.bitLength(r);for(t&&(o=o.substr(0,62)+"-_"),n=0;i.length*6<l;)i+=o.charAt((a^r[n]>>>s)>>>26),s<6?(a=r[n]<<6-s,s+=26,n++):(a<<=6,s-=6);for(;i.length&3&&!e;)i+="=";return i},toBits:function(r,e){r=r.replace(/\s|=/g,"");var t=[],i,n=0,s=d.codec.base64._chars,o=0,a;for(e&&(s=s.substr(0,62)+"-_"),i=0;i<r.length;i++){if(a=s.indexOf(r.charAt(i)),a<0)throw new d.exception.invalid("this isn't base64!");n>26?(n-=26,t.push(o^a>>>n),o=a<<32-n):(n+=6,o^=a<<32-n)}return n&56&&t.push(d.bitArray.partial(n&56,o,1)),t}};d.codec.base64url={fromBits:function(r){return d.codec.base64.fromBits(r,1,1)},toBits:function(r){return d.codec.base64.toBits(r,1)}};d.codec.bytes={fromBits:function(r){var e=[],t=d.bitArray.bitLength(r),i,n;for(i=0;i<t/8;i++)(i&3)===0&&(n=r[i/4]),e.push(n>>>24),n<<=8;return e},toBits:function(r){var e=[],t,i=0;for(t=0;t<r.length;t++)i=i<<8|r[t],(t&3)===3&&(e.push(i),i=0);return t&3&&e.push(d.bitArray.partial(8*(t&3),i)),e}};d.hash.sha256=function(r){this._key[0]||this._precompute(),r?(this._h=r._h.slice(0),this._buffer=r._buffer.slice(0),this._length=r._length):this.reset()};d.hash.sha256.hash=function(r){return new d.hash.sha256().update(r).finalize()};d.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(r){typeof r=="string"&&(r=d.codec.utf8String.toBits(r));var e,t=this._buffer=d.bitArray.concat(this._buffer,r),i=this._length,n=this._length=i+d.bitArray.bitLength(r);if(n>9007199254740991)throw new d.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var s=new Uint32Array(t),o=0;for(e=512+i-(512+i&511);e<=n;e+=512)this._block(s.subarray(16*o,16*(o+1))),o+=1;t.splice(0,16*o)}else for(e=512+i-(512+i&511);e<=n;e+=512)this._block(t.splice(0,16));return this},finalize:function(){var r,e=this._buffer,t=this._h;for(e=d.bitArray.concat(e,[d.bitArray.partial(1,1)]),r=e.length+2;r&15;r++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(this._length|0);e.length;)this._block(e.splice(0,16));return this.reset(),t},_init:[],_key:[],_precompute:function(){var r=0,e=2,t,i;function n(s){return(s-Math.floor(s))*4294967296|0}for(;r<64;e++){for(i=!0,t=2;t*t<=e;t++)if(e%t===0){i=!1;break}i&&(r<8&&(this._init[r]=n(Math.pow(e,1/2))),this._key[r]=n(Math.pow(e,1/3)),r++)}},_block:function(r){var e,t,i,n,s=this._h,o=this._key,a=s[0],l=s[1],c=s[2],h=s[3],f=s[4],p=s[5],m=s[6],g=s[7];for(e=0;e<64;e++)e<16?t=r[e]:(i=r[e+1&15],n=r[e+14&15],t=r[e&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+r[e&15]+r[e+9&15]|0),t=t+g+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(m^f&(p^m))+o[e],g=m,m=p,p=f,f=h+t|0,h=c,c=l,l=a,a=t+(l&c^h&(l^c))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+a|0,s[1]=s[1]+l|0,s[2]=s[2]+c|0,s[3]=s[3]+h|0,s[4]=s[4]+f|0,s[5]=s[5]+p|0,s[6]=s[6]+m|0,s[7]=s[7]+g|0}};d.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:function(r){d.mode.ccm._progressListeners.push(r)},unListenProgress:function(r){var e=d.mode.ccm._progressListeners.indexOf(r);e>-1&&d.mode.ccm._progressListeners.splice(e,1)},_callProgressListener:function(r){var e=d.mode.ccm._progressListeners.slice(),t;for(t=0;t<e.length;t+=1)e[t](r)},encrypt:function(r,e,t,i,n){var s,o=e.slice(0),a,l=d.bitArray,c=l.bitLength(t)/8,h=l.bitLength(o)/8;if(n=n||64,i=i||[],c<7)throw new d.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&h>>>8*s;s++);return s<15-c&&(s=15-c),t=l.clamp(t,8*(15-s)),a=d.mode.ccm._computeTag(r,e,t,i,n,s),o=d.mode.ccm._ctrMode(r,o,t,a,n,s),l.concat(o.data,o.tag)},decrypt:function(r,e,t,i,n){n=n||64,i=i||[];var s,o=d.bitArray,a=o.bitLength(t)/8,l=o.bitLength(e),c=o.clamp(e,l-n),h=o.bitSlice(e,l-n),f;if(l=(l-n)/8,a<7)throw new d.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&l>>>8*s;s++);if(s<15-a&&(s=15-a),t=o.clamp(t,8*(15-s)),c=d.mode.ccm._ctrMode(r,c,t,h,n,s),f=d.mode.ccm._computeTag(r,c.data,t,i,n,s),!o.equal(c.tag,f))throw new d.exception.corrupt("ccm: tag doesn't match");return c.data},_macAdditionalData:function(r,e,t,i,n,s){var o,a,l,c=[],h=d.bitArray,f=h._xor4;if(o=[h.partial(8,(e.length?64:0)|i-2<<2|s-1)],o=h.concat(o,t),o[3]|=n,o=r.encrypt(o),e.length)for(a=h.bitLength(e)/8,a<=65279?c=[h.partial(16,a)]:a<=4294967295&&(c=h.concat([h.partial(16,65534)],[a])),c=h.concat(c,e),l=0;l<c.length;l+=4)o=r.encrypt(f(o,c.slice(l,l+4).concat([0,0,0])));return o},_computeTag:function(r,e,t,i,n,s){var o,a,l=d.bitArray,c=l._xor4;if(n/=8,n%2||n<4||n>16)throw new d.exception.invalid("ccm: invalid tag length");if(i.length>4294967295||e.length>4294967295)throw new d.exception.bug("ccm: can't deal with 4GiB or more data");for(o=d.mode.ccm._macAdditionalData(r,i,t,n,l.bitLength(e)/8,s),a=0;a<e.length;a+=4)o=r.encrypt(c(o,e.slice(a,a+4).concat([0,0,0])));return l.clamp(o,n*8)},_ctrMode:function(r,e,t,i,n,s){var o,a,l=d.bitArray,c=l._xor4,h,f=e.length,p=l.bitLength(e),m=f/50,g=m;if(h=l.concat([l.partial(8,s-1)],t).concat([0,0,0]).slice(0,4),i=l.bitSlice(c(i,r.encrypt(h)),0,n),!f)return{tag:i,data:[]};for(a=0;a<f;a+=4)a>m&&(d.mode.ccm._callProgressListener(a/f),m+=g),h[3]++,o=r.encrypt(h),e[a]^=o[0],e[a+1]^=o[1],e[a+2]^=o[2],e[a+3]^=o[3];return{tag:i,data:l.clamp(e,p)}}};d.misc.hmac=function(r,e){this._hash=e=e||d.hash.sha256;var t=[[],[]],i,n=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],r.length>n&&(r=e.hash(r)),i=0;i<n;i++)t[0][i]=r[i]^909522486,t[1][i]=r[i]^1549556828;this._baseHash[0].update(t[0]),this._baseHash[1].update(t[1]),this._resultHash=new e(this._baseHash[0])};d.misc.hmac.prototype.encrypt=d.misc.hmac.prototype.mac=function(r){if(this._updated)throw new d.exception.invalid("encrypt on already updated hmac called!");return this.update(r),this.digest(r)};d.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1};d.misc.hmac.prototype.update=function(r){this._updated=!0,this._resultHash.update(r)};d.misc.hmac.prototype.digest=function(){var r=this._resultHash.finalize(),e=new this._hash(this._baseHash[1]).update(r).finalize();return this.reset(),e};d.misc.pbkdf2=function(r,e,t,i,n){if(t=t||1e4,i<0||t<0)throw new d.exception.invalid("invalid params to pbkdf2");typeof r=="string"&&(r=d.codec.utf8String.toBits(r)),typeof e=="string"&&(e=d.codec.utf8String.toBits(e)),n=n||d.misc.hmac;var s=new n(r),o,a,l,c,h,f=[],p=d.bitArray;for(h=1;32*f.length<(i||1);h++){for(o=a=s.encrypt(p.concat(e,[h])),l=1;l<t;l++)for(a=s.encrypt(a),c=0;c<a.length;c++)o[c]^=a[c];f=f.concat(o)}return i&&(f=p.clamp(f,i)),f};d.prng=function(r){this._pools=[new d.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=r,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80};d.prng.prototype={randomWords:function(r,e){var t=[],i,n=this.isReady(e),s;if(n===this._NOT_READY)throw new d.exception.notReady("generator isn't seeded");for(n&this._REQUIRES_RESEED&&this._reseedFromPools(!(n&this._READY)),i=0;i<r;i+=4)(i+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),s=this._gen4words(),t.push(s[0],s[1],s[2],s[3]);return this._gate(),t.slice(0,r)},setDefaultParanoia:function(r,e){if(r===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new d.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=r},addEntropy:function(r,e,t){t=t||"user";var i,n,s,o=new Date().valueOf(),a=this._robins[t],l=this.isReady(),c=0,h;switch(i=this._collectorIds[t],i===void 0&&(i=this._collectorIds[t]=this._collectorIdNext++),a===void 0&&(a=this._robins[t]=0),this._robins[t]=(this._robins[t]+1)%this._pools.length,typeof r){case"number":e===void 0&&(e=1),this._pools[a].update([i,this._eventId++,1,e,o,1,r|0]);break;case"object":if(h=Object.prototype.toString.call(r),h==="[object Uint32Array]"){for(s=[],n=0;n<r.length;n++)s.push(r[n]);r=s}else for(h!=="[object Array]"&&(c=1),n=0;n<r.length&&!c;n++)typeof r[n]!="number"&&(c=1);if(!c){if(e===void 0)for(e=0,n=0;n<r.length;n++)for(s=r[n];s>0;)e++,s=s>>>1;this._pools[a].update([i,this._eventId++,2,e,o,r.length].concat(r))}break;case"string":e===void 0&&(e=r.length),this._pools[a].update([i,this._eventId++,3,e,o,r.length]),this._pools[a].update(r);break;default:c=1}if(c)throw new d.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(r){var e=this._PARANOIA_LEVELS[r!==void 0?r:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&new Date().valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(r){var e=this._PARANOIA_LEVELS[r||this._defaultParanoia];return this._strength>=e||this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new d.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(r,e){this._callbacks[r][this._callbackI++]=e},removeEventListener:function(r,e){var t,i,n=this._callbacks[r],s=[];for(i in n)n.hasOwnProperty(i)&&n[i]===e&&s.push(i);for(t=0;t<s.length;t++)i=s[t],delete n[i]},_bind:function(r){var e=this;return function(){r.apply(e,arguments)}},_gen4words:function(){for(var r=0;r<4&&(this._counter[r]=this._counter[r]+1|0,!this._counter[r]);r++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new d.cipher.aes(this._key)},_reseed:function(r){this._key=d.hash.sha256.hash(this._key.concat(r)),this._cipher=new d.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(r){var e=[],t=0,i;for(this._nextReseed=e[0]=new Date().valueOf()+this._MILLISECONDS_PER_RESEED,i=0;i<16;i++)e.push(Math.random()*4294967296|0);for(i=0;i<this._pools.length&&(e=e.concat(this._pools[i].finalize()),t+=this._poolEntropy[i],this._poolEntropy[i]=0,!(!r&&this._reseedCount&1<<i));i++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new d.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=t,t>this._strength&&(this._strength=t),this._reseedCount++,this._reseed(e)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(r){var e,t;try{e=r.x||r.clientX||r.offsetX||0,t=r.y||r.clientY||r.offsetY||0}catch{e=0,t=0}e!=0&&t!=0&&this.addEntropy([e,t],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(r){var e=r.touches[0]||r.changedTouches[0],t=e.pageX||e.clientX,i=e.pageY||e.clientY;this.addEntropy([t,i],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(r){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?this.addEntropy(window.performance.now(),r,"loadtime"):this.addEntropy(new Date().valueOf(),r,"loadtime")},_accelerometerCollector:function(r){var e=r.accelerationIncludingGravity.x||r.accelerationIncludingGravity.y||r.accelerationIncludingGravity.z;if(window.orientation){var t=window.orientation;typeof t=="number"&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(r,e){var t,i=d.random._callbacks[r],n=[];for(t in i)i.hasOwnProperty(t)&&n.push(i[t]);for(t=0;t<n.length;t++)n[t](e)}};d.random=new d.prng(6);(function(){function r(){try{return Zi("crypto")}catch{return null}}try{var e,t,i;if(typeof module<"u"&&module.exports&&(t=r())&&t.randomBytes)e=t.randomBytes(1024/8),e=new Uint32Array(new Uint8Array(e).buffer),d.random.addEntropy(e,1024,"crypto.randomBytes");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(i=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(i);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(i);else return;d.random.addEntropy(i,1024,"crypto.getRandomValues")}}catch(n){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(n))}})();d.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(r,e,t,i){t=t||{},i=i||{};var n=d.json,s=n._add({iv:d.random.randomWords(4,0)},n.defaults),o,a,l;if(n._add(s,t),l=s.adata,typeof s.salt=="string"&&(s.salt=d.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=d.codec.base64.toBits(s.iv)),!d.mode[s.mode]||!d.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||s.iv.length<2||s.iv.length>4)throw new d.exception.invalid("json encrypt: invalid parameters");return typeof r=="string"?(o=d.misc.cachedPbkdf2(r,s),r=o.key.slice(0,s.ks/32),s.salt=o.salt):d.ecc&&r instanceof d.ecc.elGamal.publicKey&&(o=r.kem(),s.kemtag=o.tag,r=o.key.slice(0,s.ks/32)),typeof e=="string"&&(e=d.codec.utf8String.toBits(e)),typeof l=="string"&&(s.adata=l=d.codec.utf8String.toBits(l)),a=new d.cipher[s.cipher](r),n._add(i,s),i.key=r,s.mode==="ccm"&&d.arrayBuffer&&d.arrayBuffer.ccm&&e instanceof ArrayBuffer?s.ct=d.arrayBuffer.ccm.encrypt(a,e,s.iv,l,s.ts):s.ct=d.mode[s.mode].encrypt(a,e,s.iv,l,s.ts),s},encrypt:function(r,e,t,i){var n=d.json,s=n._encrypt.apply(n,arguments);return n.encode(s)},_decrypt:function(r,e,t,i){t=t||{},i=i||{};var n=d.json,s=n._add(n._add(n._add({},n.defaults),e),t,!0),o,a,l,c=s.adata;if(typeof s.salt=="string"&&(s.salt=d.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=d.codec.base64.toBits(s.iv)),!d.mode[s.mode]||!d.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||!s.iv||s.iv.length<2||s.iv.length>4)throw new d.exception.invalid("json decrypt: invalid parameters");return typeof r=="string"?(a=d.misc.cachedPbkdf2(r,s),r=a.key.slice(0,s.ks/32),s.salt=a.salt):d.ecc&&r instanceof d.ecc.elGamal.secretKey&&(r=r.unkem(d.codec.base64.toBits(s.kemtag)).slice(0,s.ks/32)),typeof c=="string"&&(c=d.codec.utf8String.toBits(c)),l=new d.cipher[s.cipher](r),s.mode==="ccm"&&d.arrayBuffer&&d.arrayBuffer.ccm&&s.ct instanceof ArrayBuffer?o=d.arrayBuffer.ccm.decrypt(l,s.ct,s.iv,s.tag,c,s.ts):o=d.mode[s.mode].decrypt(l,s.ct,s.iv,c,s.ts),n._add(i,s),i.key=r,t.raw===1?o:d.codec.utf8String.fromBits(o)},decrypt:function(r,e,t,i){var n=d.json;return n._decrypt(r,n.decode(e),t,i)},encode:function(r){var e,t="{",i="";for(e in r)if(r.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new d.exception.invalid("json encode: invalid property name");switch(t+=i+'"'+e+'":',i=",",typeof r[e]){case"number":case"boolean":t+=r[e];break;case"string":t+='"'+escape(r[e])+'"';break;case"object":t+='"'+d.codec.base64.fromBits(r[e],0)+'"';break;default:throw new d.exception.bug("json encode: unsupported type")}}return t+"}"},decode:function(r){if(r=r.replace(/\s/g,""),!r.match(/^\{.*\}$/))throw new d.exception.invalid("json decode: this isn't json!");var e=r.replace(/^\{|\}$/g,"").split(/,/),t={},i,n;for(i=0;i<e.length;i++){if(!(n=e[i].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new d.exception.invalid("json decode: this isn't json!");n[3]!=null?t[n[2]]=parseInt(n[3],10):n[4]!=null?t[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?d.codec.base64.toBits(n[4]):unescape(n[4]):n[5]!=null&&(t[n[2]]=n[5]==="true")}return t},_add:function(r,e,t){if(r===void 0&&(r={}),e===void 0)return r;var i;for(i in e)if(e.hasOwnProperty(i)){if(t&&r[i]!==void 0&&r[i]!==e[i])throw new d.exception.invalid("required parameter overridden");r[i]=e[i]}return r},_subtract:function(r,e){var t={},i;for(i in r)r.hasOwnProperty(i)&&r[i]!==e[i]&&(t[i]=r[i]);return t},_filter:function(r,e){var t={},i;for(i=0;i<e.length;i++)r[e[i]]!==void 0&&(t[e[i]]=r[e[i]]);return t}};d.encrypt=d.json.encrypt;d.decrypt=d.json.decrypt;d.misc._pbkdf2Cache={};d.misc.cachedPbkdf2=function(r,e){var t=d.misc._pbkdf2Cache,i,n,s,o,a;return e=e||{},a=e.iter||1e3,n=t[r]=t[r]||{},i=n[a]=n[a]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):d.random.randomWords(2,0)},o=e.salt===void 0?i.firstSalt:e.salt,i[o]=i[o]||d.misc.pbkdf2(r,o,e.iter),{key:i[o].slice(0),salt:o.slice(0)}};d.bn=function(r){this.initWith(r)};d.bn.prototype={radix:24,maxMul:8,_class:d.bn,copy:function(){return new this._class(this)},initWith:function(r){var e=0,t;switch(typeof r){case"object":this.limbs=r.limbs.slice(0);break;case"number":this.limbs=[r],this.normalize();break;case"string":for(r=r.replace(/^0x/,""),this.limbs=[],t=this.radix/4,e=0;e<r.length;e+=t)this.limbs.push(parseInt(r.substring(Math.max(r.length-e-t,0),r.length-e),16));break;default:this.limbs=[0]}return this},equals:function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t;for(this.fullReduce(),r.fullReduce(),t=0;t<this.limbs.length||t<r.limbs.length;t++)e|=this.getLimb(t)^r.getLimb(t);return e===0},getLimb:function(r){return r>=this.limbs.length?0:this.limbs[r]},greaterEquals:function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t=0,i,n,s;for(i=Math.max(this.limbs.length,r.limbs.length)-1;i>=0;i--)n=this.getLimb(i),s=r.getLimb(i),t|=s-n&~e,e|=n-s&~t;return(t|~e)>>>31},toString:function(){this.fullReduce();var r="",e,t,i=this.limbs;for(e=0;e<this.limbs.length;e++){for(t=i[e].toString(16);e<this.limbs.length-1&&t.length<6;)t="0"+t;r=t+r}return"0x"+r},addM:function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,i=r.limbs;for(e=t.length;e<i.length;e++)t[e]=0;for(e=0;e<i.length;e++)t[e]+=i[e];return this},doubleM:function(){var r,e=0,t,i=this.radix,n=this.radixMask,s=this.limbs;for(r=0;r<s.length;r++)t=s[r],t=t+t+e,s[r]=t&n,e=t>>i;return e&&s.push(e),this},halveM:function(){var r,e=0,t,i=this.radix,n=this.limbs;for(r=n.length-1;r>=0;r--)t=n[r],n[r]=t+e>>1,e=(t&1)<<i;return n[n.length-1]||n.pop(),this},subM:function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,i=r.limbs;for(e=t.length;e<i.length;e++)t[e]=0;for(e=0;e<i.length;e++)t[e]-=i[e];return this},mod:function(r){var e=!this.greaterEquals(new d.bn(0));r=new d.bn(r).normalize();var t=new d.bn(this).normalize(),i=0;for(e&&(t=new d.bn(0).subM(t).normalize());t.greaterEquals(r);i++)r.doubleM();for(e&&(t=r.sub(t).normalize());i>0;i--)r.halveM(),t.greaterEquals(r)&&t.subM(r).normalize();return t.trim()},inverseMod:function(r){var e=new d.bn(1),t=new d.bn(0),i=new d.bn(this),n=new d.bn(r),s,o,a=1;if(!(r.limbs[0]&1))throw new d.exception.invalid("inverseMod: p must be odd");do for(i.limbs[0]&1&&(i.greaterEquals(n)||(s=i,i=n,n=s,s=e,e=t,t=s),i.subM(n),i.normalize(),e.greaterEquals(t)||e.addM(r),e.subM(t)),i.halveM(),e.limbs[0]&1&&e.addM(r),e.normalize(),e.halveM(),o=a=0;o<i.limbs.length;o++)a|=i.limbs[o];while(a);if(!n.equals(1))throw new d.exception.invalid("inverseMod: p and x must be relatively prime");return t},add:function(r){return this.copy().addM(r)},sub:function(r){return this.copy().subM(r)},mul:function(r){typeof r=="number"?r=new this._class(r):r.normalize(),this.normalize();var e,t,i=this.limbs,n=r.limbs,s=i.length,o=n.length,a=new this._class,l=a.limbs,c,h=this.maxMul;for(e=0;e<this.limbs.length+r.limbs.length+1;e++)l[e]=0;for(e=0;e<s;e++){for(c=i[e],t=0;t<o;t++)l[e+t]+=c*n[t];--h||(h=this.maxMul,a.cnormalize())}return a.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(r){r=new d.bn(r).normalize().trim().limbs;var e,t,i=new this._class(1),n=this;for(e=0;e<r.length;e++)for(t=0;t<this.radix&&(r[e]&1<<t&&(i=i.mul(n)),!(e==r.length-1&&r[e]>>t+1==0));t++)n=n.square();return i},mulmod:function(r,e){return this.mod(e).mul(r.mod(e)).mod(e)},powermod:function(r,e){if(r=new d.bn(r),e=new d.bn(e),(e.limbs[0]&1)==1){var t=this.montpowermod(r,e);if(t!=!1)return t}var i,n,s=r.normalize().trim().limbs,o=new this._class(1),a=this;for(i=0;i<s.length;i++)for(n=0;n<this.radix&&(s[i]&1<<n&&(o=o.mulmod(a,e)),!(i==s.length-1&&s[i]>>n+1==0));n++)a=a.mulmod(a,e);return o},montpowermod:function(r,e){r=new d.bn(r).normalize().trim(),e=new d.bn(e);var t,i,n=this.radix,s=new this._class(1),o=this.copy(),a,l,c,h=r.bitLength();for(a=new d.bn({limbs:e.copy().normalize().trim().limbs.map(function(){return 0})}),l=this.radix;l>0;l--)if((e.limbs[e.limbs.length-1]>>l&1)==1){a.limbs[a.limbs.length-1]=1<<l;break}if(h==0)return this;h<18?c=1:h<48?c=3:h<144?c=4:h<768?c=5:c=6;for(var f=a.copy(),p=e.copy(),m=new d.bn(1),g=new d.bn(0),v=a.copy();v.greaterEquals(1);)v.halveM(),(m.limbs[0]&1)==0?(m.halveM(),g.halveM()):(m.addM(p),m.halveM(),g.halveM(),g.addM(f));m=m.normalize(),g=g.normalize(),f.doubleM();var _=f.mulmod(f,e);if(!f.mul(m).sub(e.mul(g)).equals(1))return!1;var B=function(C){return A(C,_)},A=function(C,V){var x,re,N,S,Ve=(1<<l+1)-1;for(re=C.mul(V),N=re.mul(g),N.limbs=N.limbs.slice(0,a.limbs.length),N.limbs.length==a.limbs.length&&(N.limbs[a.limbs.length-1]&=Ve),N=N.mul(e),S=re.add(N).normalize().trim(),S.limbs=S.limbs.slice(a.limbs.length-1),x=0;x<S.limbs.length;x++)x>0&&(S.limbs[x-1]|=(S.limbs[x]&Ve)<<n-l-1),S.limbs[x]=S.limbs[x]>>l+1;return S.greaterEquals(e)&&S.subM(e),S},k=function(C){return A(C,1)};o=B(o),s=B(s);var R,T={},Y=(1<<c-1)-1;for(T[1]=o.copy(),T[2]=A(o,o),R=1;R<=Y;R++)T[2*R+1]=A(T[2*R-1],T[2]);var z=function(C,V){var x=V%C.radix;return(C.limbs[Math.floor(V/C.radix)]&1<<x)>>x};for(t=r.bitLength()-1;t>=0;)if(z(r,t)==0)s=A(s,s),t=t-1;else{for(var te=t-c+1;z(r,te)==0;)te++;var de=0;for(i=te;i<=t;i++)de+=z(r,i)<<i-te,s=A(s,s);s=A(s,T[de]),t=te-1}return k(s)},trim:function(){var r=this.limbs,e;do e=r.pop();while(r.length&&e===0);return r.push(e),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var r=0,e,t=this.placeVal,i=this.ipv,n,s,o=this.limbs,a=o.length,l=this.radixMask;for(e=0;e<a||r!==0&&r!==-1;e++)n=(o[e]||0)+r,s=o[e]=n&l,r=(n-s)*i;return r===-1&&(o[e-1]-=t),this.trim(),this},cnormalize:function(){var r=0,e,t=this.ipv,i,n,s=this.limbs,o=s.length,a=this.radixMask;for(e=0;e<o-1;e++)i=s[e]+r,n=s[e]=i&a,r=(i-n)*t;return s[e]+=r,this},toBits:function(r){this.fullReduce(),r=r||this.exponent||this.bitLength();var e=Math.floor((r-1)/24),t=d.bitArray,i=(r+7&-8)%this.radix||this.radix,n=[t.partial(i,this.getLimb(e))];for(e--;e>=0;e--)n=t.concat(n,[t.partial(Math.min(this.radix,r),this.getLimb(e))]),r-=this.radix;return n},bitLength:function(){this.fullReduce();for(var r=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>>=1)r++;return r+7&-8}};d.bn.fromBits=function(r){var e=this,t=new e,i=[],n=d.bitArray,s=this.prototype,o=Math.min(this.bitLength||4294967296,n.bitLength(r)),a=o%s.radix||s.radix;for(i[0]=n.extract(r,0,a);a<o;a+=s.radix)i.unshift(n.extract(r,a,s.radix));return t.limbs=i,t};d.bn.prototype.ipv=1/(d.bn.prototype.placeVal=Math.pow(2,d.bn.prototype.radix));d.bn.prototype.radixMask=(1<<d.bn.prototype.radix)-1;d.bn.pseudoMersennePrime=function(r,e){function t(a){this.initWith(a)}var i=t.prototype=new d.bn,n,s,o;for(o=i.modOffset=Math.ceil(s=r/i.radix),i.exponent=r,i.offset=[],i.factor=[],i.minOffset=o,i.fullMask=0,i.fullOffset=[],i.fullFactor=[],i.modulus=t.modulus=new d.bn(Math.pow(2,r)),i.fullMask=0|-Math.pow(2,r%i.radix),n=0;n<e.length;n++)i.offset[n]=Math.floor(e[n][0]/i.radix-s),i.fullOffset[n]=Math.floor(e[n][0]/i.radix)-o+1,i.factor[n]=e[n][1]*Math.pow(1/2,r-e[n][0]+i.offset[n]*i.radix),i.fullFactor[n]=e[n][1]*Math.pow(1/2,r-e[n][0]+i.fullOffset[n]*i.radix),i.modulus.addM(new d.bn(Math.pow(2,e[n][0])*e[n][1])),i.minOffset=Math.min(i.minOffset,-i.offset[n]);return i._class=t,i.modulus.cnormalize(),i.reduce=function(){var a,l,c,h=this.modOffset,f=this.limbs,p=this.offset,m=this.offset.length,g=this.factor,v;for(a=this.minOffset;f.length>h;){for(c=f.pop(),v=f.length,l=0;l<m;l++)f[v+p[l]]-=g[l]*c;a--,a||(f.push(0),this.cnormalize(),a=this.minOffset)}return this.cnormalize(),this},i._strongReduce=i.fullMask===-1?i.reduce:function(){var a=this.limbs,l=a.length-1,c,h;if(this.reduce(),l===this.modOffset-1){for(h=a[l]&this.fullMask,a[l]-=h,c=0;c<this.fullOffset.length;c++)a[l+this.fullOffset[c]]-=this.fullFactor[c]*h;this.normalize()}},i.fullReduce=function(){var a,l;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),l=this.limbs.length;l<this.modOffset;l++)this.limbs[l]=0;for(a=this.greaterEquals(this.modulus),l=0;l<this.limbs.length;l++)this.limbs[l]-=this.modulus.limbs[l]*a;return this.cnormalize(),this},i.inverse=function(){return this.power(this.modulus.sub(2))},t.fromBits=d.bn.fromBits,t};var be=d.bn.pseudoMersennePrime;d.bn.prime={p127:be(127,[[0,-1]]),p25519:be(255,[[0,-19]]),p192k:be(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:be(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:be(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:be(192,[[0,-1],[64,-1]]),p224:be(224,[[0,1],[96,-1]]),p256:be(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:be(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:be(521,[[0,-1]])};d.bn.random=function(r,e){typeof r!="object"&&(r=new d.bn(r));for(var t,i,n=r.limbs.length,s=r.limbs[n-1]+1,o=new d.bn;;){do t=d.random.randomWords(n,e),t[n-1]<0&&(t[n-1]+=4294967296);while(Math.floor(t[n-1]/s)===Math.floor(4294967296/s));for(t[n-1]%=s,i=0;i<n-1;i++)t[i]&=r.radixMask;if(o.limbs=t,!o.greaterEquals(r))return o}};typeof ArrayBuffer>"u"&&(function(r){"use strict";r.ArrayBuffer=function(){},r.DataView=function(){}})(void 0);d.codec.arrayBuffer={fromBits:function(r,e,t){var i,n,s,o,a;if(e=e??!0,t=t||8,r.length===0)return new ArrayBuffer(0);if(s=d.bitArray.bitLength(r)/8,d.bitArray.bitLength(r)%8!==0)throw new d.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(e&&s%t!==0&&(s+=t-s%t),o=new DataView(new ArrayBuffer(r.length*4)),n=0;n<r.length;n++)o.setUint32(n*4,r[n]<<32);if(i=new DataView(new ArrayBuffer(s)),i.byteLength===o.byteLength)return o.buffer;for(a=o.byteLength<i.byteLength?o.byteLength:i.byteLength,n=0;n<a;n++)i.setUint8(n,o.getUint8(n));return i.buffer},toBits:function(r){var e,t=[],i,n,s;if(r.byteLength===0)return[];n=new DataView(r),i=n.byteLength-n.byteLength%4;for(var e=0;e<i;e+=4)t.push(n.getUint32(e));if(n.byteLength%4!=0){s=new DataView(new ArrayBuffer(4));for(var e=0,o=n.byteLength%4;e<o;e++)s.setUint8(e+4-o,n.getUint8(i+e));t.push(d.bitArray.partial(n.byteLength%4*8,s.getUint32(0)))}return t},hexDumpBuffer:function(r){for(var e=new DataView(r),t="",i=function(s,o){return s=s+"",s.length>=o?s:new Array(o-s.length+1).join("0")+s},n=0;n<e.byteLength;n+=2)n%16==0&&(t+=`
`+n.toString(16)+"	"),t+=i(e.getUint16(n).toString(16),4)+" ";typeof console===void 0&&(console=console||{log:function(){}}),console.log(t.toUpperCase())}};typeof module<"u"&&module.exports&&(module.exports=d);typeof define=="function"&&define([],function(){return d});var y=d;function St(r,e){throw new Error(`unexpected ${r} identifier: ${e}`)}function ho(r){switch(r){case"SHA-1":return{name:r,hLen:20};case"SHA-256":return{name:r,hLen:32};case"SHA-384":return{name:r,hLen:48};case"SHA-512":return{name:r,hLen:64};default:St("Hash",r)}}function ne(r){return y.bn.fromBits(y.codec.bytes.toBits(Array.from(r)))}function ce(r,e){if(Math.ceil(r.bitLength()/8)>e)throw new Error(`number does not fit in ${e} bytes`);let t=new Uint8Array(e),i=new Uint8Array(y.codec.bytes.fromBits(r.toBits(void 0)));return t.set(i,e-i.length),t}function Nr(r,e){return ce(new y.bn(r),e)}function ie(r){let e=0;for(let n of r)e+=n.length;let t=new Uint8Array(new ArrayBuffer(e)),i=0;for(let n of r)t.set(n,i),i+=n.length;return t}function po(r,e){if(r.length!==e.length||r.length===0)throw new Error(`arrays of different length: ${r.length} - ${e.length}`);let t=r[Symbol.iterator](),i=e[Symbol.iterator]();return new Uint8Array(r.length).map(()=>t.next().value^i.next().value)}function go(r){r[3]++,r[3]==0&&(r[2]++,r[2]==0&&(r[1]++,r[1]==0&&r[0]++))}async function mo(r,e,t){let i=Math.ceil(t/r.hLen);if(i>Math.pow(2,32))throw new Error("mask too long");let n=new Uint8Array,s=new Uint8Array(4);for(let o=0;o<i;o++){let a=new Uint8Array(await crypto.subtle.digest(r.name,ie([e,s])));n=ie([n,a]),go(s)}return n.subarray(0,t)}async function Or(r,e,t,i=mo){let{hash:n,sLen:s}=t,o=ho(n),{hLen:a}=o,l=Math.ceil(e/8),c=new Uint8Array(await crypto.subtle.digest(n,r));if(l<a+s+2)throw new Error("encoding error");let h=crypto.getRandomValues(new Uint8Array(s)),f=ie([new Uint8Array(8),c,h]),p=new Uint8Array(await crypto.subtle.digest(n,f)),m=new Uint8Array(l-s-a-2),g=ie([m,Uint8Array.of(1),h]),v=await i(o,p,l-a-1),_=po(g,v);return _[0]&=255>>8*l-e,ie([_,p,Uint8Array.of(188)])}function ot(r,e){if(!e.greaterEquals(new y.bn(0))||e.greaterEquals(r.n))throw new Error("signature representative out of range");return e.powermod(r.e,r.n)}function zr(r,e){if(!e.greaterEquals(new y.bn(0))||e.greaterEquals(r.n))throw new Error("signature representative out of range");return e.powermod(r.d,r.n)}function Fr(r,e){try{r.inverseMod(e)}catch{return!1}return!0}function Dr(r,e){for(let i=0;i<128;i++){let n=ne(crypto.getRandomValues(new Uint8Array(e)));if(!(n.greaterEquals(r)||n.equals(0)))return n}throw new Error("reached maximum tries for random integer generation")}function wi(r,e){if(!(e.getLimb(0)&1)){if(!(r.getLimb(0)&1))throw new Error("inverseMod: The given number is not invertible.");let[t,i]=[BigInt(r.toString()),BigInt(e.toString())],[n,s]=[BigInt(1),BigInt(0)];for(;i!==0n;){let o=t/i;[t,i]=[i,t-o*i],[n,s]=[s,n-o*s]}if(t>1n)throw new Error("inverseMod: The given number is not invertible.");return n<0n&&(n+=BigInt(e.toString())),new y.bn(n.toString(16))}return r.inverseMod(e)}var jn="RSA-RAW";async function Vr(r,e){r.algorithm.name!==jn&&(r=await crypto.subtle.importKey("pkcs8",await crypto.subtle.exportKey("pkcs8",r),{...r.algorithm,name:jn},r.extractable,r.usages));let t=await crypto.subtle.sign({name:r.algorithm.name},r,e);return new Uint8Array(t)}function Kn(){let r="crypto.getRandomValues";for(;!y.random.isReady(void 0);)y.random.addEntropy(Array.from(crypto.getRandomValues(new Uint32Array(4))),128,r)}var F;(function(r){r[r.Deterministic=0]="Deterministic",r[r.Randomized=32]="Randomized"})(F||(F={}));var Re=class Re{constructor(e){b(this,"params");switch(this.params=e,e.prepareType){case F.Deterministic:case F.Randomized:return;default:St("PrepareType",e.prepareType)}}toString(){let e=this.params.hash.replace("-",""),t="PSS"+(this.params.saltLength===0?"ZERO":""),i=F[this.params.prepareType];return`RSABSSA-${e}-${t}-${i}`}prepare(e){let t=this.params.prepareType,i=crypto.getRandomValues(new Uint8Array(t));return ie([i,e])}async extractKeyParams(e,t){if(e.type!==t||e.algorithm.name!==Re.NAME)throw new Error(`key is not ${Re.NAME}`);if(!e.extractable)throw new Error("key is not extractable");let{modulusLength:i,hash:n}=e.algorithm,s=Math.ceil(i/8),o=n.name;if(o.toLowerCase()!==this.params.hash.toLowerCase())throw new Error(`hash is not ${this.params.hash}`);return{jwkKey:await crypto.subtle.exportKey("jwk",e),modulusLengthBits:i,modulusLengthBytes:s,hash:o}}async blind(e,t){let{jwkKey:i,modulusLengthBits:n,modulusLengthBytes:s,hash:o}=await this.extractKeyParams(e,"public");if(!i.n||!i.e)throw new Error("key has invalid parameters");let a=y.bn.fromBits(y.codec.base64url.toBits(i.n)),c={e:y.bn.fromBits(y.codec.base64url.toBits(i.e)),n:a},h={sLen:this.params.saltLength,hash:o},f=await Or(t,n-1,h),p=ne(f);if(!Fr(p,a))throw new Error("invalid input");let g=Dr(a,s),v;try{v=ce(g.inverseMod(a),s)}catch(k){throw new Error(`blinding error: ${k.toString()}`)}let _=ot(c,g),B=p.mulmod(_,a);return{blindedMsg:ce(B,s),inv:v}}async blindSign(e,t){if(this.params.supportsRSARAW)return Vr(e,t);let{jwkKey:i,modulusLengthBytes:n}=await this.extractKeyParams(e,"private");if(!i.n||!i.d||!i.e)throw new Error("key has invalid parameters");let s=y.bn.fromBits(y.codec.base64url.toBits(i.n)),o=y.bn.fromBits(y.codec.base64url.toBits(i.d)),a=y.bn.fromBits(y.codec.base64url.toBits(i.e)),l={n:s,d:o},c={n:s,e:a},h=ne(t),f=zr(l,h),p=ot(c,f);if(!h.equals(p))throw new Error("signing failure");return ce(f,n)}async finalize(e,t,i,n){let{jwkKey:s,modulusLengthBytes:o}=await this.extractKeyParams(e,"public");if(!s.n)throw new Error("key has invalid parameters");let a=y.bn.fromBits(y.codec.base64url.toBits(s.n));if(n.length!=o)throw new Error("unexpected input size");let l=ne(n);if(i.length!=o)throw new Error("unexpected input size");let h=ne(i).mulmod(l,a),f=ce(h,o),p={name:Re.NAME,saltLength:this.params.saltLength};if(!await crypto.subtle.verify(p,e,f,t))throw new Error("invalid signature");return f}static generateKey(e){return crypto.subtle.generateKey({...e,name:Re.NAME},!0,["sign","verify"])}generateKey(e){return Re.generateKey({...e,hash:this.params.hash})}verify(e,t,i){return crypto.subtle.verify({name:Re.NAME,saltLength:this.params.saltLength},e,t,i)}};b(Re,"NAME","RSA-PSS");var Pe=Re;var $n=6;function Gn(r,e=20){if(r.equals(1))return!1;if(r.equals(2)||r.equals(3))return!0;if((r.getLimb(0)&1)===0)return!1;let t=new y.bn(r).sub(1).normalize(),i=new y.bn(t),n=0;for(;(i.getLimb(0)&1)===0;)i=i.halveM(),n++;for(let s=0;s<e;s++){let a=y.bn.random(t,$n).powermod(i,r);if(!a.equals(1)&&!a.equals(t)){let l=1;for(;l<n&&!a.equals(t);){if(a=a.mulmod(a,r),a.equals(1))return!1;l++}if(!a.equals(t))return!1}}return!0}function bo(r,e=20){let t=e*r**4,i=new y.bn(2);for(let o=0;o<r;o++)i.doubleM();i.normalize();let n,s=0;do n=y.bn.random(i,$n),(n.getLimb(0)&1)==0&&(n=n.addM(1).normalize()),s++;while(!Gn(n,e)&&s<t);if(s===t)throw new Error(`generatePrime reached MAX_NUM_TRIES=${t}`);return n}function vi(r,e=20){let t=r**2,i=new y.bn(1),n,s=0;do n=bo(r-1,e).doubleM().addM(i).normalize(),s++;while(!Gn(n,e)&&s<t);if(s===t)throw new Error(`generateSafePrime reached MAX_NUM_TRIES=${t}`);return n}var Q=class Q{constructor(e){b(this,"params");switch(this.params=e,e.prepareType){case F.Deterministic:case F.Randomized:return;default:St("PrepareType",e.prepareType)}}toString(){let e=this.params.hash.replace("-",""),t="PSS"+(this.params.saltLength===0?"ZERO":""),i=F[this.params.prepareType];return`RSAPBSSA-${e}-${t}-${i}`}prepare(e){let t=this.params.prepareType,i=crypto.getRandomValues(new Uint8Array(t));return ie([i,e])}async extractKeyParams(e,t){if(e.type!==t||e.algorithm.name!==Q.NAME)throw new Error(`key is not ${Q.NAME}`);if(!e.extractable)throw new Error("key is not extractable");let{modulusLength:i,hash:n}=e.algorithm,s=Math.ceil(i>>3),o=n.name;if(o.toLowerCase()!==this.params.hash.toLowerCase())throw new Error(`hash is not ${this.params.hash}`);return{jwkKey:await crypto.subtle.exportKey("jwk",e),modulusLengthBits:i,modulusLengthBytes:s,hash:o}}async blind(e,t,i){let{jwkKey:n,modulusLengthBits:s,modulusLengthBytes:o,hash:a}=await this.extractKeyParams(e,"public");if(!n.n||!n.e)throw new Error("key has invalid parameters");let l=y.bn.fromBits(y.codec.base64url.toBits(n.n)),h={e:y.bn.fromBits(y.codec.base64url.toBits(n.e)),n:l},f=ie([new TextEncoder().encode("msg"),Nr(i.length,4),i,t]),p={sLen:this.params.saltLength,hash:a},m=await Or(f,s-1,p),g=ne(m);if(!Fr(g,l))throw new Error("invalid input");let _=Dr(l,o),B;try{B=ce(_.inverseMod(l),o)}catch(Y){throw new Error(`blinding error: ${Y.toString()}`)}let A=await this.derivePublicKey(h,i),k=ot(A,_),R=g.mulmod(k,l);return{blindedMsg:ce(R,o),inv:B}}async blindSign(e,t,i){let{jwkKey:n,modulusLengthBytes:s}=await this.extractKeyParams(e,"private");if(!n.n||!n.d||!n.p||!n.q)throw new Error("key has invalid parameters");let o=y.bn.fromBits(y.codec.base64url.toBits(n.n)),a=y.bn.fromBits(y.codec.base64url.toBits(n.d)),l=y.bn.fromBits(y.codec.base64url.toBits(n.p)),c=y.bn.fromBits(y.codec.base64url.toBits(n.q)),h={n:o,d:a,p:l,q:c},f=ne(t),{secretKey:p,publicKey:m}=await this.deriveKeyPair(h,i),g;if(this.params.supportsRSARAW){let{privateKey:_}=await Q.bigKeyPairToCryptoKeyPair({secretKey:p,publicKey:m},{modulusLength:s*8,publicExponent:new Uint8Array([1,0,1]),hash:this.params.hash},!0);g=ne(await Vr(_,t))}else g=zr(p,f);let v=ot(m,g);if(!f.equals(v))throw new Error("signing failure");return ce(g,s)}async finalize(e,t,i,n,s){let{jwkKey:o,modulusLengthBytes:a}=await this.extractKeyParams(e,"public");if(!o.e||!o.n)throw new Error("key has invalid parameters");let l=y.bn.fromBits(y.codec.base64url.toBits(o.e)),c=y.bn.fromBits(y.codec.base64url.toBits(o.n)),h={e:l,n:c};if(s.length!=a)throw new Error("unexpected input size");let f=ne(s);if(n.length!=a)throw new Error("unexpected input size");let m=ne(n).mulmod(f,c),g=ce(m,a),v=ie([new TextEncoder().encode("msg"),Nr(i.length,4),i,t]),_=await this.derivePublicKey(h,i),B=await crypto.subtle.importKey("jwk",{...o,e:y.codec.base64url.fromBits(_.e.toBits(0)),n:y.codec.base64url.fromBits(_.n.toBits(0))},{name:Q.NAME,hash:this.params.hash},!1,["verify"]),A={name:Q.NAME,saltLength:this.params.saltLength};if(!await crypto.subtle.verify(A,B,g,v))throw new Error("invalid signature");return g}static async generateKey(e,t=vi){Kn();let i,n;do{let f=t(e.modulusLength>>1),p=t(e.modulusLength>>1);i=typeof f=="bigint"?new y.bn(f.toString(16)):f,n=typeof p=="bigint"?new y.bn(p.toString(16)):p}while(i.equals(n));let s=i.sub(1).mul(n.sub(1)),o=new y.bn("0x"+Array.from(e.publicExponent).map(f=>f.toString(16).padStart(2,"0")).join("")),a=wi(o,s),l=i.mul(n),c={n:l,p:i,q:n,d:a},h={e:o,n:l};return Q.bigKeyPairToCryptoKeyPair({secretKey:c,publicKey:h},e,!0)}generateKey(e,t=vi){return Q.generateKey({...e,hash:this.params.hash},t)}async verify(e,t,i,n){let{jwkKey:s}=await this.extractKeyParams(e,"public");if(!s.e||!s.n)throw new Error("key has invalid parameters");let o=y.bn.fromBits(y.codec.base64url.toBits(s.e)),a=y.bn.fromBits(y.codec.base64url.toBits(s.n)),l={e:o,n:a},c=await this.derivePublicKey(l,n),h=await crypto.subtle.importKey("jwk",{...s,e:y.codec.base64url.fromBits(c.e.toBits(0)),n:y.codec.base64url.fromBits(c.n.toBits(0))},{name:Q.NAME,hash:this.params.hash},!1,["verify"]),f=ie([new TextEncoder().encode("msg"),Nr(n.length,4),n,i]);return crypto.subtle.verify({name:Q.NAME,saltLength:this.params.saltLength},h,t,f)}async derivePublicKey({n:e},t){let i=ie([new TextEncoder().encode("key"),t,new Uint8Array([0])]),n=ce(e,e.bitLength()>>3),s=e.bitLength()>>4,o=s+16,a=new Uint8Array(await crypto.subtle.deriveBits({name:"HKDF",hash:this.params.hash,info:new TextEncoder().encode("PBRSA"),salt:n},await crypto.subtle.importKey("raw",i,"HKDF",!1,["deriveBits"]),o*8));return a[0]&=63,a[s-1]|=1,{e:ne(a.slice(0,s)),n:e}}async deriveKeyPair(e,t){let i=new y.bn(e.p).sub(1).mul(new y.bn(e.q).sub(1)),n=await this.derivePublicKey({n:e.n},t),s=wi(n.e,i);return{secretKey:{...e,d:s},publicKey:n}}static async bigKeyPairToCryptoKeyPair({secretKey:e,publicKey:t},i,n){let s=e.n,o=t.e,a=e.p,l=e.q,c=e.d,h=c.mod(a.sub(1)),f=c.mod(l.sub(1)),p=l.inverseMod(a),m=await crypto.subtle.importKey("jwk",{alg:"PS384",ext:n,key_ops:["sign"],kty:"RSA",n:y.codec.base64url.fromBits(s.toBits(0)),e:y.codec.base64url.fromBits(o.toBits(0)),p:y.codec.base64url.fromBits(a.toBits(0)),q:y.codec.base64url.fromBits(l.toBits(0)),d:y.codec.base64url.fromBits(c.toBits(0)),dp:y.codec.base64url.fromBits(h.toBits(0)),dq:y.codec.base64url.fromBits(f.toBits(0)),qi:y.codec.base64url.fromBits(p.toBits(0))},{...i,name:Q.NAME},n,["sign"]),g=await crypto.subtle.importKey("jwk",{alg:"PS384",ext:n,key_ops:["verify"],kty:"RSA",n:y.codec.base64url.fromBits(s.toBits(0)),e:y.codec.base64url.fromBits(o.toBits(0))},{...i,name:Q.NAME},n,["verify"]);return{privateKey:m,publicKey:g}}};b(Q,"NAME","RSA-PSS");var Ue=Q;var Ie={RSABSSA_SHA384_PSS_Randomized:{name:"RSABSSA-SHA384-PSS-Randomized",hash:"SHA-384",saltLength:48,prepareType:F.Randomized},RSABSSA_SHA384_PSS_Deterministic:{name:"RSABSSA-SHA384-PSS-Deterministic",hash:"SHA-384",saltLength:48,prepareType:F.Deterministic},RSABSSA_SHA384_PSSZERO_Randomized:{name:"RSABSSA-SHA384-PSSZERO-Randomized",hash:"SHA-384",saltLength:0,prepareType:F.Randomized},RSABSSA_SHA384_PSSZERO_Deterministic:{name:"RSABSSA-SHA384-PSSZERO-Deterministic",hash:"SHA-384",saltLength:0,prepareType:F.Deterministic},RSAPBSSA_SHA384_PSS_Randomized:{name:"RSAPBSSA-SHA384-PSS-Randomized",hash:"SHA-384",saltLength:48,prepareType:F.Randomized},RSAPBSSA_SHA384_PSS_Deterministic:{name:"RSAPBSSA-SHA384-PSS-Deterministic",hash:"SHA-384",saltLength:48,prepareType:F.Deterministic},RSAPBSSA_SHA384_PSSZERO_Randomized:{name:"RSAPBSSA-SHA384-PSSZERO-Randomized",hash:"SHA-384",saltLength:0,prepareType:F.Randomized},RSAPBSSA_SHA384_PSSZERO_Deterministic:{name:"RSAPBSSA-SHA384-PSSZERO-Deterministic",hash:"SHA-384",saltLength:0,prepareType:F.Deterministic}},Ai={SHA384:{generateKey:r=>Pe.generateKey({...r,hash:"SHA-384"}),PSS:{Randomized:(r={supportsRSARAW:!1})=>new Pe({...Ie.RSABSSA_SHA384_PSS_Randomized,...r}),Deterministic:(r={supportsRSARAW:!1})=>new Pe({...Ie.RSABSSA_SHA384_PSS_Deterministic,...r})},PSSZero:{Randomized:(r={supportsRSARAW:!1})=>new Pe({...Ie.RSABSSA_SHA384_PSSZERO_Randomized,...r}),Deterministic:(r={supportsRSARAW:!1})=>new Pe({...Ie.RSABSSA_SHA384_PSSZERO_Deterministic,...r})}}},_i={SHA384:{generateKey:r=>Ue.generateKey({...r,hash:"SHA-384"}),PSS:{Randomized:(r={supportsRSARAW:!1})=>new Ue({...Ie.RSAPBSSA_SHA384_PSS_Randomized,...r}),Deterministic:(r={supportsRSARAW:!1})=>new Ue({...Ie.RSAPBSSA_SHA384_PSS_Deterministic,...r})},PSSZero:{Randomized:(r={supportsRSARAW:!1})=>new Ue({...Ie.RSAPBSSA_SHA384_PSSZERO_Randomized,...r}),Deterministic:(r={supportsRSARAW:!1})=>new Ue({...Ie.RSAPBSSA_SHA384_PSSZERO_Deterministic,...r})}}};var Me;(function(r){r[r.PSSZero=0]="PSSZero",r[r.PSS=48]="PSS"})(Me||(Me={}));var Bi=Me,yo={suite:{[Me.PSSZero]:Ai.SHA384.PSSZero.Deterministic,[Me.PSS]:Ai.SHA384.PSS.Deterministic},rsaParams:{name:"RSA-PSS",hash:"SHA-384"}},wo={suite:{[Bi.PSSZero]:_i.SHA384.PSSZero.Deterministic,[Bi.PSS]:_i.SHA384.PSS.Deterministic},rsaParams:{name:"RSA-PSS",hash:"SHA-384"}},se={value:2,name:"Blind RSA (2048)",Nk:256,Nid:32,publicVerifiable:!0,publicMetadata:!1,privateMetadata:!1,...yo},ue={value:55930,name:"Partially Blind RSA (2048-bit)",Nk:256,Nid:32,publicVerifiable:!0,publicMetadata:!0,privateMetadata:!1,...wo};function vo(r){let e=Pr(r);return crypto.subtle.importKey("spki",e,se.rsaParams,!0,["verify"])}async function Wn(r){return Ur(new Uint8Array(await crypto.subtle.exportKey("spki",r)))}async function Jn(r){return new Uint8Array(await crypto.subtle.digest("SHA-256",r))}var We=class r{constructor(e,t,i){b(this,"truncatedTokenKeyId");b(this,"blindedMsg");b(this,"tokenType");if(this.truncatedTokenKeyId=e,this.blindedMsg=t,t.length!==i.Nk)throw new Error("invalid blinded message size");this.tokenType=i.value}static deserialize(e,t){let i=0,n=new DataView(t.buffer,t.byteOffset,t.byteLength),s=n.getUint16(i);if(i+=2,s!==e.value)throw new Error("mismatch of token type");let o=n.getUint8(i);i+=1;let a=e.Nk,l=t.subarray(i,i+a);return i+=a,new r(o,l,e)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.truncatedTokenKeyId),e.push(t),t=this.blindedMsg.buffer.slice(this.blindedMsg.byteOffset,this.blindedMsg.byteOffset+this.blindedMsg.byteLength),e.push(t),new Uint8Array(J(e))}},Hr=class r{constructor(e,t){b(this,"request");b(this,"extensions");this.request=e,this.extensions=t}static deserialize(e){let t=We.deserialize(ue,e),i=xt.deserialize(e.slice(3+ue.Nk));return new r(t,i)}serialize(){let e=new Array,t=this.request.serialize();e.push(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength));let i=this.extensions.serialize();return e.push(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)),new Uint8Array(J(e))}},Je=class r{constructor(e){b(this,"blindSig");if(this.blindSig=e,e.length!==se.Nk)throw new Error(`blind signature has invalid size: ${e.length}`)}static deserialize(e){return new r(e.slice(0,se.Nk))}serialize(){return new Uint8Array(this.blindSig)}length(){return this.blindSig.length}},qr=class{constructor(e,t,i,n,s){b(this,"mode");b(this,"name");b(this,"privateKey");b(this,"publicKey");b(this,"params");b(this,"suite");this.mode=e,this.name=t,this.privateKey=i,this.publicKey=n,this.params=s,this.suite=o=>{if(o===void 0)return se.suite[this.mode](this.params);{let a=ue.suite[this.mode](this.params),l=o.serialize();return{blindSign:(c,h)=>a.blindSign(c,h,l),verify:(c,h,f)=>a.verify(c,h,f,l)}}}}async _issue(e,t){let i=await this.suite(t).blindSign(this.privateKey,e.blindedMsg);return new Je(i)}async tokenKeyID(){return Jn(await Wn(this.publicKey))}verify(e){return this.suite().verify(this.publicKey,e.authenticator,e.authInput.serialize())}},kt=class extends qr{async issue(e){return super._issue(e)}static generateKey(e,t){return se.suite[e]().generateKey(t)}},Ei=class extends qr{async issue(e){return super._issue(e.request,e.extensions)}static generateKey(e,t,i){return ue.suite[e]().generateKey(t,i)}},jr=class{constructor(e,t){b(this,"mode");b(this,"extensions");b(this,"finData");b(this,"suite");b(this,"tokenType");if(this.mode=e,this.extensions=t,this.extensions===void 0)this.tokenType=se,this.suite=se.suite[this.mode]();else{this.tokenType=ue;let i=ue.suite[this.mode](),n=this.extensions.serialize();this.suite={blind:(s,o)=>i.blind(s,o,n),finalize:(s,o,a,l)=>i.finalize(s,o,n,a,l)}}}async _createTokenRequest(e,t){let i=crypto.getRandomValues(new Uint8Array(32)),n=new Uint8Array(await crypto.subtle.digest("SHA-256",e.serialize())),s=await Jn(t),o=new $e(this.tokenType,this.tokenType.value,i,n,s),a=o.serialize(),l=await vo(t),{blindedMsg:c,inv:h}=await this.suite.blind(l,a),f=s[s.length-1],p=new We(f,c,this.tokenType);return this.finData={tokenInput:a,authInput:o,inv:h,pkIssuer:l},p}deserializeTokenResponse(e){return Je.deserialize(e)}async finalize(e){if(!this.finData)throw new Error("no token request was created yet");let t=await this.suite.finalize(this.finData.pkIssuer,this.finData.tokenInput,e.blindSig,this.finData.inv),i=new Ge(this.tokenType,this.finData.authInput,t);return this.finData=void 0,i}},Rt=class extends jr{async createTokenRequest(e,t){return super._createTokenRequest(e,t)}},xi=class extends jr{async createTokenRequest(e,t){let i=await super._createTokenRequest(e,t);if(!this.extensions)throw new Error("no extensions available");return new Hr(i,this.extensions)}},Kr=class{constructor(e,t,i){b(this,"mode");b(this,"originInfo");b(this,"extensions");b(this,"tokenType");b(this,"suite");if(this.mode=e,this.originInfo=t,this.extensions=i,this.extensions===void 0)this.suite=se.suite[this.mode](),this.tokenType=se;else{let n=ue.suite[this.mode](),s=this.extensions.serialize();this.suite={verify:(o,a,l)=>n.verify(o,a,l,s)},this.tokenType=ue}}async verify(e,t){return this.suite.verify(t,e.authenticator,e.authInput.serialize())}createTokenChallenge(e,t){return new Ke(this.tokenType.value,e,t,this.originInfo)}},Si=class extends Kr{},ki=class extends Kr{constructor(e,t,i){super(e,i,t)}};var Rs={};oi(Rs,{Client:()=>Dt,Issuer:()=>Ft,Origin:()=>ji,TokenRequest:()=>ut,TokenResponse:()=>tt,VOPRF:()=>L,keyGen:()=>Qo,verifyToken:()=>ea});var O=Xi(xs(),1);var ei=O.Oprf.Suite.P384_SHA384,zt=O.Oprf.getGroup(ei),Ss=O.Oprf.getHash(ei),Xo={suite:ei,group:zt,Ne:zt.eltSize(),Ns:zt.scalarSize(),Nk:O.Oprf.getOprfSize(ei),hash:Ss,dleqParams:{group:zt.id,hash:Ss,dst:new Uint8Array}},L={value:1,name:"VOPRF (P-384, SHA-384)",Nid:32,publicVerifiable:!1,publicMetadata:!1,privateMetadata:!1,...Xo};function Qo(){return(0,O.generateKeyPair)(L.suite)}async function ks(r){return new Uint8Array(await crypto.subtle.digest("SHA-256",r))}var ut=class r{constructor(e,t){b(this,"truncatedTokenKeyId");b(this,"blindedMsg");b(this,"tokenType");if(this.truncatedTokenKeyId=e,this.blindedMsg=t,t.length!==L.Ne)throw new Error("blinded message has invalid size");this.tokenType=L.value}static deserialize(e){let t=0,i=new DataView(e.buffer,e.byteOffset,e.byteLength),n=i.getUint16(t);if(t+=2,n!==L.value)throw new Error("mismatch of token type");let s=i.getUint8(t);t+=1;let o=L.Ne,a=e.subarray(t,t+o);return t+=o,new r(s,a)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.truncatedTokenKeyId),e.push(t),t=this.blindedMsg.buffer.slice(this.blindedMsg.byteOffset,this.blindedMsg.byteOffset+this.blindedMsg.byteLength),e.push(t),new Uint8Array(J(e))}},tt=class r{constructor(e,t){b(this,"evaluateMsg");b(this,"evaluateProof");if(this.evaluateMsg=e,this.evaluateProof=t,e.length!==L.Ne)throw new Error("evaluate_msg has invalid size");if(t.length!==2*L.Ns)throw new Error("evaluate_proof has invalid size")}static deserialize(e){let t=0,i=L.Ne,n=new Uint8Array(e.slice(t,t+i));t+=i,i=2*L.Ns;let s=new Uint8Array(e.slice(t,t+i));return new r(n,s)}serialize(){return new Uint8Array(J([this.evaluateMsg.buffer.slice(this.evaluateMsg.byteOffset,this.evaluateMsg.byteOffset+this.evaluateMsg.byteLength),this.evaluateProof.buffer.slice(this.evaluateProof.byteOffset,this.evaluateProof.byteOffset+this.evaluateProof.byteLength)]))}length(){return this.evaluateMsg.length+this.evaluateProof.length}};function ea(r,e){let t=new O.VOPRFServer(L.suite,e),i=r.authInput.serialize();return t.verifyFinalize(i,r.authenticator)}var Ft=class{constructor(e,t,i){b(this,"name");b(this,"privateKey");b(this,"publicKey");b(this,"vServer");this.name=e,this.privateKey=t,this.publicKey=i,this.vServer=new O.VOPRFServer(L.suite,this.privateKey)}async issue(e){let t=L.group.desElt(e.blindedMsg),i=new O.EvaluationRequest([t]),n=await this.vServer.blindEvaluate(i);if(n.evaluated.length!==1)throw new Error("evaluation is of a non-single element");let s=n.evaluated[0].serialize();if(typeof n.proof>"u")throw new Error("evaluation has no DLEQ proof");let o=n.proof.serialize();return new tt(s,o)}tokenKeyID(){return ks(this.publicKey)}verify(e){let t=e.authInput.serialize();return this.vServer.verifyFinalize(t,e.authenticator)}},Dt=class{constructor(){b(this,"finData")}async createTokenRequest(e,t){let i=crypto.getRandomValues(new Uint8Array(32)),n=new Uint8Array(await crypto.subtle.digest("SHA-256",e.serialize())),s=await ks(t),o=new $e(L,L.value,i,n,s),a=o.serialize(),l=new O.VOPRFClient(L.suite,t),[c,h]=await l.blind([a]);if(h.blinded.length!==1)throw new Error("created a non-single blinded element");let f=h.blinded[0].serialize(),p=s[s.length-1],m=new ut(p,f);return this.finData={vClient:l,authInput:o,finData:c},m}deserializeTokenResponse(e){return tt.deserialize(e)}async finalize(e){if(!this.finData)throw new Error("no token request was created yet");let t=O.DLEQProof.deserialize(zt.id,e.evaluateProof),i=L.group.desElt(e.evaluateMsg),n=new O.Evaluation(O.Oprf.Mode.VOPRF,[i],t),[s]=await this.finData.vClient.finalize(this.finData.finData,n),o=new Ge(L,this.finData.authInput,s);return this.finData=void 0,o}},ji=class{constructor(e){b(this,"originInfo");b(this,"tokenType",L);this.originInfo=e}async verify(e,t){let i=new O.VOPRFServer(L.suite,t),n=e.authInput.serialize();return i.verifyFinalize(n,e.authenticator)}createTokenChallenge(e,t){return new Ke(this.tokenType.value,e,t,this.originInfo)}};var ta="/.well-known/private-token-issuer-directory",ft;(function(r){r.PRIVATE_TOKEN_ISSUER_DIRECTORY="application/private-token-issuer-directory",r.PRIVATE_TOKEN_REQUEST="application/private-token-request",r.PRIVATE_TOKEN_RESPONSE="application/private-token-response",r.ARBITRARY_BATCHED_TOKEN_REQUEST="application/private-token-generic-batch-request",r.ARBITRARY_BATCHED_TOKEN_RESPONSE="application/private-token-generic-batch-response"})(ft||(ft={}));async function ra(r){let e=`https://${r}`,t=`${e}${ta}`,i=await fetch(t);if(i.status!==200)throw new Error(`issuerConfig: no configuration was found at ${t}`);let s=(await i.json())["issuer-request-uri"];try{return new URL(s),s}catch{return`${e}${s}`}}async function ia(r,e,t=new Headers){t.append("Content-Type",ft.PRIVATE_TOKEN_REQUEST),t.append("Accept",ft.PRIVATE_TOKEN_RESPONSE);let i=await fetch(e,{method:"POST",headers:t,body:r});if(i.status!==200){let o=await i.text();throw new Error(`tokenRequest failed with code:${i.status} response:${o}`)}let n=i.headers.get("Content-Type");if(!n||n.toLowerCase()!==ft.PRIVATE_TOKEN_RESPONSE.toString())throw new Error(`tokenRequest: response "Content-Type" header is not valid "${n}" is different from "${ft.PRIVATE_TOKEN_RESPONSE} header`);return new Uint8Array(await i.arrayBuffer())}async function Ts(r,e){let t=await ra(e.challenge.issuerName),i=await r.createTokenRequest(e.challenge,e.tokenKey),n=await ia(i.serialize(),t),s=r.deserializeTokenResponse(n),o=await r.finalize(s);return new Mr(o)}var Cs={};oi(Cs,{BatchedTokenRequest:()=>ni,Client:()=>Wi,GenericBatchTokenResponse:()=>Vt,Issuer:()=>Gi,OptionalTokenResponse:()=>ht,TokenRequest:()=>ii});var na=63,sa=16383,oa=1073741823,aa=2147483647,la=0,Ls=aa,ti=63,Ki=(r,e)=>{let t=r.getUint8(e);e+=1;let n=1<<(t>>6),s=t&ti;for(let o=0;o<n-1;o+=1)s=(s<<8)+r.getUint8(e),e+=1;return{value:s,usize:n}};var $i=(r,e=ca(r))=>{if(r>Ls)throw new Error("Number is too big");let t=new Uint8Array(e),i=255;switch(e){case 1:t[0]=0|r&ti;break;case 2:t[0]=64|r>>8&ti,t[1]=r&i;break;case 4:t[0]=128|r>>24&ti,t[1]=r>>16&i,t[2]=r>>8&i,t[3]=r&i;break;case 8:t[0]=192,t[4]=r>>24&i,t[5]=r>>16&i,t[6]=r>>8&i,t[7]=r&i;break;default:throw new Error("Invalid length")}return t},ca=r=>{if(r<la)throw new Error("Cannot encode negative numbers");if(r>Ls)throw new Error("Number is too big");return r>oa?8:r>sa?4:r>na?2:1};var ri={ABSENT:0,PRESENT:1},ii=class r{constructor(e){b(this,"tokenRequest");this.tokenRequest=e}static deserialize(e){let t=Ji(e);switch(t.value){case ee.VOPRF.value:return new r(ut.deserialize(e));case ee.BLIND_RSA.value:return new r(We.deserialize(t,e));default:throw new Error("Token Type not supported")}}serialize(){return this.tokenRequest.serialize()}get tokenType(){return this.tokenRequest.tokenType}get truncatedTokenKeyId(){return this.tokenRequest.truncatedTokenKeyId}get blindMsg(){return this.tokenRequest.blindedMsg}},ni=class r{constructor(e){b(this,"tokenRequests");this.tokenRequests=e}static deserialize(e){let t=0,i=new DataView(e.buffer,e.byteOffset,e.byteLength),{value:n,usize:s}=Ki(i,t);if(t+=s,n+t!==e.length)throw new Error("provided bytes does not match its encoded length");let o=[];for(;t<e.length;){let a=Ji(e.subarray(t)),l=Ps(a),c=e.subarray(t,t+l);t+=l,o.push(ii.deserialize(c))}return new r(o)}serialize(){let e=new Array,t=0;for(let n of this.tokenRequests){let s=n.serialize();e.push(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),t+=s.length}let i=$i(t);return new Uint8Array(J([i,...e]))}[Symbol.iterator](){let e=0,t=this.tokenRequests;return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},ht=class r{constructor(e,t){b(this,"tokenType");b(this,"tokenResponse");this.tokenType=e,this.tokenResponse=t}static deserialize(e){if(e.length===0)throw new Error("OptionalTokenResponse MUST be of length strictly greater than 0");switch(e[0]){case ri.ABSENT:return new r(1,null);case ri.PRESENT:{if(e.length<3)throw new Error("OptionalTokenResponse PRESENT requires at least 3 bytes");let t=e[1]<<8|e[2];if(t!==ee.VOPRF.value&&t!==ee.BLIND_RSA.value)throw new Error(`unsupported token type: ${t}`);let i=e.slice(3),n=t===ee.VOPRF.value?tt.deserialize(i):Je.deserialize(i);return new r(t,n)}default:throw new Error("OptionalTokenResponse MUST start with either 0x00 or 0x01")}}serialize(){if(this.tokenResponse===null)return new Uint8Array([ri.ABSENT]);let e=this.tokenResponse.serialize(),t=new Uint8Array(3+e.length);return t[0]=ri.PRESENT,t[1]=this.tokenType>>8&255,t[2]=this.tokenType&255,t.set(e,3),t}length(){return this.tokenResponse===null?1:3+this.tokenResponse.length()}},Vt=class r{constructor(e){b(this,"tokenResponses");this.tokenResponses=e}static deserialize(e){let t=0,i=new DataView(e.buffer,e.byteOffset,e.byteLength),{value:n,usize:s}=Ki(i,t);if(t+=s,n+t!==e.length)throw new Error("provided bytes does not match its encoded length");let o=[];for(;t<e.length;){let a=ht.deserialize(e.subarray(t));t+=a.length(),o.push(a)}return new r(o)}serialize(){let e=new Array,t=0;for(let n of this.tokenResponses){let s=n.serialize();e.push(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),t+=s.length}let i=$i(t);return new Uint8Array(J([i,...e]))}[Symbol.iterator](){let e=0,t=this.tokenResponses;return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},Gi=class{constructor(...e){b(this,"issuers");this.issuers={1:[],2:[]};for(let t of e)t instanceof Ft?this.issuers[1].push(t):t instanceof kt&&this.issuers[2].push(t)}async issuer(e,t){if(![ee.VOPRF.value,ee.BLIND_RSA.value].includes(e))throw new Error("unsupported token type");let i=this.issuers[e];for(let n of i){let s=await n.tokenKeyID();if(s[s.length-1]==t)return n}throw new Error("no issuer found provided the truncated token key id")}async issue(e){let t=[];for(let i of e){let n=i.tokenType;try{let o=await(await this.issuer(n,i.truncatedTokenKeyId)).issue(i.tokenRequest);t.push(new ht(n,o))}catch(s){console.log(s),t.push(new ht(n,null))}}return new Vt(t)}tokenKeyIDs(e){return Promise.all(this.issuers[e].map(t=>t.tokenKeyID()))}async verify(e){let{tokenType:t,tokenKeyId:i}=e.authInput,n=i[i.length-1];return(await this.issuer(t,n)).verify(e)}[Symbol.iterator](){let e=0,t=[...this.issuers[1],...this.issuers[2]];return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},Wi=class{createTokenRequest(e){return new ni(e)}deserializeTokenResponse(e){return Vt.deserialize(e)}};var Al={convertEncToRSASSAPSS:Ur,convertRSASSAPSSToEnc:Pr},ee={BLIND_RSA:se,PARTIALLY_BLIND_RSA:ue,VOPRF:L};async function _l(r){let e=Ir.parse(r);if(e.length===0)return null;let t=e[0],i;switch(t.challenge.tokenType){case ee.VOPRF.value:i=new Dt;break;case ee.BLIND_RSA.value:i=new Rt(Me.PSS);break;default:return console.log(`unrecognized or non-supported token type in the challenge: ${t.challenge.tokenType}`),null}let n=new TextEncoder,s=await Ts(i,t);return pe.stringify(n.encode(s.toString()))}function Ps(r){switch(r.value){case ee.VOPRF.value:return 3+L.Ne;case ee.BLIND_RSA.value:return 3+se.Nk;case ee.PARTIALLY_BLIND_RSA.value:return 3+ue.Nk;default:throw new Error(`unrecognized or non-supported token type: ${r.value}`)}}function Ji(r){let t=new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0),i=Object.values(ee).find(n=>n.value===t);if(i===void 0)throw new Error(`unrecognized or non-supported token type: ${t}`);return i}export{st as AUTH_SCHEME_NAME,$e as AuthenticatorInput,Mr as AuthorizationHeader,yi as Extension,xt as Extensions,ft as MediaType,ta as PRIVATE_TOKEN_ISSUER_DIRECTORY,ee as TOKEN_TYPES,Ge as Token,Ke as TokenChallenge,Ir as WWWAuthenticateHeader,Ts as fetchToken,Cs as genericBatched,ra as getIssuerUrl,_l as header_to_token,Rs as privateVerif,Yn as publicVerif,ia as sendTokenRequest,Ps as tokenEntryToSerializedLength,Ji as tokenRequestToTokenTypeEntry,Al as util};
/*! Bundled license information:

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

pvutils/build/utils.es.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.es.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)
*/
